Ultimate network insights ‚Äì Advances in network telemetry
Frank Brockners
DNAC‚Äô18 - November 16, 2018

Network Monitoring‚Ä¶ An Unlikely Target for Radical Innovation
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

CLI SNMP syslog

Too Slow Incomplete Device-Specific Hard to Operationalize
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

‚ÄúFree the data‚Äù
Network Telemetry Paradigm
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Where Data Is Created
sensing & measurement

Where Data Is Useful

As Much Data As Fast As Useful As Easy
As Possible

storage & analysis

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Three Enablers for Telemetry
Don‚Äôt Pull: Push! Analytics-Ready Data Data-Model Driven
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Three Enablers Map to Three Parts of Telemetry

Sensor-Group
‚Ä¢ "What" ‚Ä¢ Data Models

Destination-Group

Subscription

‚Ä¢ "Where/How" ‚Ä¢ Analytics-Ready

‚Ä¢ "How Often" ‚Ä¢ Push, Not Pull

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Data Models Define What You Want to Stream
telemetry model-driven sensor-group SGROUP1 sensor-path Cisco-IOS-XR-infra-statsd-oper: infrastatistics/interfaces/interface/latest/ge neric-counters
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Model-Driven Means You Can Work With Models Offline
https://github.com/YangModels/yang/tree/master/vendor/cisco/xr
Telemetry only cares about operational (*-oper.yang) models, not config (*‚Äìcfg.yang) or action (*-act.yang). ‚Ä¢ IOS-XR 5.3.0: 36 published *-oper*.yang models ‚Ä¢ IOS-XR 5.3.4: 66 published *-oper*.yang models ‚Ä¢ IOS-XR 6.0.1: 288 published *-oper*.yang models ‚Ä¢ IOS-XR 6.2.1: 445 published *-oper*.yang models ‚Ä¢ IOS-XR 6.5.1: 456 published *-oper*.yang models
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

There Are Many Tools To Explore What‚Äôs In A Model

$ pyang -f tree Cisco-IOS-XR-infra-statsd-oper.yang --tree-path infra-statistics/interfaces/interface/latest/generic-
counters

module: Cisco-IOS-XR-infra-statsd-oper +--ro infra-statistics +--ro interfaces +--ro interface* [interface-name] +--ro latest +--ro generic-counters +--ro packets-received? +--ro bytes-received? +--ro packets-sent? +--ro bytes-sent? +--ro multicast-packets-received?
‚Ä¶

uint64 uint64 uint64 uint64 uint64

Or try the Advanced Netconf Explorer ANX: https://github.com/cisco-ie/anx
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Common Sensor Paths: System and Interfaces

Data Interface Oper State
Interface Data Rate
Interfaces Stats
Optics Ports Info Uptime Info CPU State Memory Info Processes Memory NCS5500 NPU Stats NCS5500 NPU Resources

Model
Cisco-IOS-XR-pfi-im-cmd-oper:interfaces/interface-xr/interface Cisco-IOS-XR-infra-statsd-oper:infrastatistics/interfaces/interface/latest/data-rate Cisco-IOS-XR-infra-statsd-oper:infrastatistics/interfaces/interface/latest/generic-counters Cisco-IOS-XR-controller-optics-oper:optics-oper/optics-ports/opticsport/optics-Info Cisco-IOS-XR-shellutil-oper:system-time/uptime Cisco-IOS-XR-wdsysmon-fd-oper:system-monitoring/cpu-utilization Cisco-IOS-XR-nto-misc-oper:memory-summary/nodes/node/summary Cisco-IOS-XR-procmem-oper:processes-memory/nodes Cisco-IOS-XR-fretta-bcm-dpa-npu-stats-oper:dpa/stats/nodes/node Cisco-IOS-XR-fretta-bcm-dpa-hw-resourcesoper:dpa/stats/nodes/node/hw-resources-datas/hw-resources-data

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Common Sensor Paths: Protocols

Data

Model

Cisco-IOS-XR-ethernet-lldp-

LLDP Info

oper:lldp/nodes/node/neighbors/summaries/summary

IPv4 RIB Info

Cisco-IOS-XR-ip-rib-ipv4-oper:rib/vrfs/vrf/afs/af/safs/saf/ip-rib-route-tablenames/ip-rib-route-table-name/routes/route

Cisco-IOS-XR-ip-rib-ipv6-oper:ipv6-rib/vrfs/vrf/afs/af/safs/saf/ip-rib-route-

IPv6 RIB Info

table-names/ip-rib-route-table-name/routes/route

Cisco-IOS-XR-ip-rib-ipv4-oper:rib/vrfs/vrf/afs/af/safs/saf/ip-rib-route-table-

BGP IPv4 Routes Info names/ip-rib-route-table-name/protocol/bgp/as/information

Cisco-IOS-XR-ip-rib-ipv6-oper:ipv6-rib/vrfs/vrf/afs/af/safs/saf/ip-rib-route-

BGP IPv6 Routes Info table-names/ip-rib-route-table-name/protocol/bgp/as/information

Cisco-IOS-XR-ipv4-bgp-oper:bgp/instances/instance/instance-

BGP IPv4 Neighbor active/default-vrf/neighbors/neighbor

MPLS-TE Tunnels Cisco-IOS-XR-mpls-te-oper:mpls-te/tunnels/summary

RSVP Interface Info Cisco-IOS-XR-ip-rsvp-oper:rsvp/interface-briefs/interface-brief

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Where and How Do You Want to Stream It
telemetry model-driven destination-group DGROUP address family ipv4 192.168.1.1 port 2104 ---- and/or ---address family ipv6 2001:db8::1 port 2104 encoding self-describing-gpb protocol tcp
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Encoding Impacts Efficiency, Scale and Your Collector

DATA
‚ÄúEncode‚Äù

‚ÄúDecode‚Äù
DATA

Encodings for Telemetry
‚Ä¢ Compact GPB ‚Ä¢ Self-describing GPB ‚Ä¢ JSON (XR 6.3.1)

Encoding (or ‚Äúserialization‚Äù) translates data (objects, state) into a format that can be transmitted across the network. When the receiver decodes (‚Äúdeserializes‚Äù) the data, it has a semantically identical copy of the original data.

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Tie It All Together With A Subscription
telemetry model-driven subscription SUB1 sensor-group-id SGROUP1 sample-interval 30000 destination-id DGROUP1
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

ANX: https://github.com/cisco-ie/anx

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

ANX: https://github.com/cisco-ie/anx

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

ANX: https://github.com/cisco-ie/anx

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

ANX: https://github.com/cisco-ie/anx

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Where does the data go?
¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Platform for Network Data Analytics: PNDA.io

ODL Logstash OpenBPM pmacct Telemetry

Data Distribution

Processing
Real -time

Query
SQL Query

Visualisation and Exploration
Data Exploration

Stream
Batch

OLAP Cube
Search /
Lucene

Metric Visualisation
Event Visualisation

File Store

NoSQL

Time Series

PNDA Applications Unmanaged
App Unmanaged
App
PNDA Managed App
PNDA Managed App

PNDA Plugins

Platform Services: Installation, Mgmt, Security, Data Privacy

App Packaging and Mgmt

PNDA Producer API

PNDA Consumer API

‚Ä¢ Simple, scalable open data platform
‚Ä¢ Provides a common set of services for developing analytics applications
‚Ä¢ Accelerates the process of developing big data analytics applications whilst significantly reducing the TCO
‚Ä¢ PNDA provides a platform for convergence of network data analytics

Observe (SNMP, Syslog Streaming Telemetry)

Probe (ping, traceroute)

But what about my live user traffic?

¬© 2018 Cisco and/or its affiliates. All rights reserved. Cisco Public

Let‚Äôs assume you‚Äôre interested in the behavior of your live user-data traffic. What is the best source of information?
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Well‚Ä¶ probably the live user-data traffic itself.
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Speed control by police car

‚ÄúOn-Board Unit‚Äù

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Let‚Äôs add meta-data to the customer traffic, so that we can observe the customer traffic itself
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Hdr IOAM Payload

1

42

2

Hdr IOAM Payload

5

17

7

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Observe (SNMP, Syslog Streaming Telemetry)

Probe (ping, traceroute)

In-situ OAM (per packet telemetry)

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Analyze when a packet enters and exists the network‚Ä¶
B A
D C
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

‚Ä¶at what rate packets arrive at a particular hop‚Ä¶
B A
D C
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

... what path a packet takes ‚Ä¶
B A
D C
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

... whether the packet takes the path it is supposed to take (because of TE, NSH, SR)‚Ä¶
B A
D C
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

‚Ä¶how long the packet spends at each hop, and which node is experiencing congestion‚Ä¶
B A
D C
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

... or which underlay nodes a VXLAN-GPE tunnel traverses.

A

A

B

A

A

B

B

C

C

D

VXLAN-GPE tunnel

A

D

B

C

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Hdr Payload

3
A 2
1 C
Hdr

A1 Payload

B
4 5
Hdr C4 A1 Payload

B6 C4 A1
6 IPFIX
D
Hdr B6 C4 A1 Payload

Hdr Payload

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM Specification

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM data fields are defined in a protocol independent way
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM data fields can be carried in various protocols
IPv6 VXLAN-GPE
NSH Segment-Routing v6
GRE ...
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM is standardized by the IETF...
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Latest IETF Drafts
‚Ä¢ In-situ OAM Authors: Cisco, Comcast, Facebook, JPMC, Bell Canada, Mellanox, Marvell, Barefoot, Huawei, rtBrick
‚Ä¢ In-situ OAM data types: draft-ietf-ippm-ioam-data-04 ‚Ä¢ Encapsulations:
‚Ä¢ VXLAN-GPE: draft-brockners-ippm-ioam-vxlan-gpe-00 ‚Ä¢ NSH: draft-ietf-sfc-ioam-nsh-00 ‚Ä¢ Geneve: draft-brockners-ippm-ioam-geneve-01 ‚Ä¢ Ethertype (GRE, Geneve, ...): draft-weis-ippm-ioam-eth-00 ‚Ä¢ SRv6: draft-ali-spring-ioam-srv6-00 ‚Ä¢ SR-MPLS: draft-gandhi-spring-ioam-sr-mpls-00
‚Ä¢ In-situ OAM transport: Proof-of-transit: draft-ietf-sfc-proof-of-transit-01
‚Ä¢ Raw export of IOAM data: draft-spiegel-ippm-ioam-rawexport-01
‚Ä¢ In-situ OAM manageability
‚Ä¢ draft-zhou-ippm-ioam-yang-01

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

In-situ OAM Data Fields Overview

‚Ä¢ Per node scope ‚Ä¢ Hop-by-Hop information processing
‚Ä¢ Hop Limit ‚Ä¢ Node_ID (long/short) ‚Ä¢ Ingress Interface ID (long/short) ‚Ä¢ Egress Interface ID (long/short) ‚Ä¢ Timestamp
‚Ä¢ Wall clock (seconds, nanoseconds) ‚Ä¢ Transit delay ‚Ä¢ Queue length ‚Ä¢ Opaque data ‚Ä¢ Namespace specific data (long/short)
Two transport options: ‚Ä¢ Pre-allocated array (SW friendly) ‚Ä¢ Incrementally grown array (HW friendly)

‚Ä¢ Set of nodes scope ‚Ä¢ Hop-by-Hop information processing
‚Ä¢ Service Chain Validation (Random, Cumulative)
‚Ä¢ Edge to Edge scope ‚Ä¢ Edge-to-Edge information processing
‚Ä¢ Sequence Number
Note: IOAM data fields use a dedicated namespace. IOAM data fields are layer independent and can be filled by any node capable of filling-in IOAM data fields.

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

... and running IOAM code exists.
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM Implementation
‚Ä¢ Dataplane Implementation:
‚Ä¢ Open-Source:
‚Ä¢ FD.io/VPP (see fd.io) ‚Ä¢ Linux Kernel (PoC for 4.12 )
‚Ä¢ IOS (ISR-G2) ‚Äì PI31 (CCO: End of July/16)
‚Ä¢ Silicon vendors supporting IOAM
‚Ä¢ Cisco, Broadcom (Trident T3), Netronome (Agilo), Barefoot (Tofino), Mellanox
‚Ä¢ Controller Implementation:
‚Ä¢ OpenDaylight (Carbon release)
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

VPP Implementation: CPU cycles per feature group
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

One more thing...
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM can create a lot of data for you... ... How to deal with all this data?
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

IOAM data filtering
‚Ä¢ If added to every packet, IOAM can create a lot of additional information
‚Ä¢ Overall amount of information can be too much to export from the decapsulating node
‚Ä¢ Triggered IOAM ‚Ä¢ Selected Flows for IOAM ‚Ä¢ Sampling of IOAM data ‚Ä¢ Pre-Processing of IOAM data on the switch/router

Export to analytics subsystem
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

A few example use-cases
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

Overlay-

Underlay

Correlation for

1

VXLAN-GPE in

the smart fabric

¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

2

B

A

3 C

D

Ongoing customer centric reporting of network SLA/Health
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

Rapid Failure Isolation: Probing with IOAM loopback
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

2 1

B

C

3

A

4

F

D

E

5

Micro-Service Selection: M-Anycast
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

Proof of Transit (POT)
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

Controller Secret

B

A

C

Verifier

X

POT: Leverage Shamir‚Äôs Secret Sharing ‚ÄúA polynomial as secret‚Äù

‚Ä¢ Each service is given a point on the curve
‚Ä¢ When the packet travels through each service it collects these points
‚Ä¢ A verifier can reconstruct the curve using the collected points
‚Ä¢ Operations done over a finite field (mod prime) to protect against differential analysis
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Confidential

‚ÄúSecret‚Äù: 3Ì†µÌ±•2 + 3Ì†µÌ±• + 10

(3,46) (2,28) (1,16)

B

3Ì†µÌ±•2 + 3Ì†µÌ±• + 10

A
X

C Verifier

IOAM: Try a simple example yourself?
https://github.com/CiscoDevNet/iOAM/blob/master/scripts/vpp_sandbox/exampl e/simple-ip6/Readme.md
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

More Information:
https://xrdocs.io/telemetry/ https://github.com/CiscoDevNet/iOAM
http://pnda.io/
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

Thank You
¬© 2017 Cisco and/or its affiliates. All rights reserved. Cisco Public

