Expanding a LoRaWAN network for cost efficiency improvement
Master‚Äôs Thesis By
Eva Jurado Cort√©s Department of Electrical and Information Technology
Faculty of Engineering, LTH, Lund University SE-221 00 Lund, Sweden
2018

Abstract
LoRaWAN is a new technology whose presence in Smart Cities is increasing. It provides benefits to daily life, however, battery consumption of end-devices is one of the limiting factors that must be recognized. The lower the consumption, the better the network quality.
The battery life of a specified end-device depends on the power needed for the transmission. To improve it, the distance from every end-device to the gateway should be minimum. Optimizing this distance, the overall consumption decreases and the global network performance improves, reducing the economic cost. The number of gateways in the network is another factor that changes the consumption, however, in this network, this number is fixed.
In the network deployed in Lund, a new gateway is going to be introduced. The aim of this thesis is to find the optimal location for this new gateway in order to reduce the end-devices‚Äô consumption. The aim has been achieved by deploying an optimization algorithm over the power consumption in the network. Considering some difficulties to place the gateway in the resulting location, the best location to place the new gateway has been obtained by applying the optimization algorithm over a list of existing and accessible locations.

Acknowledgments
Firstly, this Master‚Äôs thesis would not exist without the support and guidance of my supervisors at Sensefarm Daniel Lundell and Anders Hedberg. Also, I want to express my gratitude to both universities involved in my master‚Äôs thesis: Lund University and Technical University of Madrid. Especially, to my supervisor Bj√∂rn Landfeldt from Lunds Tekniska H√∂gskola for all the recommendations.
Eva Jurado Cort√©s

Contents
Abstract ........................................................................................................................................2 Acknowledgments ........................................................................................................................3 Contents .......................................................................................................................................4 List of figures ................................................................................................................................7 List of tables .................................................................................................................................8 List of equations ...........................................................................................................................9 List of acronyms .........................................................................................................................10 Popular Science Summary ..........................................................................................................11 1. INTRODUCTION ..................................................................................................................12
Background.................................................................................................................12 Project aims................................................................................................................12 Approach ....................................................................................................................13 Limitations ..................................................................................................................13 Thesis outline .............................................................................................................14 Related work ..............................................................................................................14 Advancements and outcome......................................................................................14 Resources ...................................................................................................................15 2. THEORETICAL REVIEW ........................................................................................................16 LoRaWAN ...................................................................................................................16 2.1.1. Network architecture ................................................................................................. 16 2.1.2. Frames ........................................................................................................................ 17 2.1.3. Adaptive Data Rate..................................................................................................... 18 2.1.4. Device classes ............................................................................................................. 20 2.1.5. Security ....................................................................................................................... 21 2.1.6. Specifications .............................................................................................................. 21 2.1.7. Comparison with other technologies for LPWAN...................................................... 22 2.1.8. Applications ................................................................................................................ 23 2.1.9. Battery life .................................................................................................................. 23 Channel model ...........................................................................................................24 Optimization theory ...................................................................................................24 3. IMPLEMENTATION..............................................................................................................26 Gateways‚Äô information ...............................................................................................26 Optimization ...............................................................................................................26

3.2.1. Process overview ........................................................................................................ 26 3.2.2. Measurements data extraction.................................................................................. 26 3.2.3. Data preparation ........................................................................................................ 28 3.2.4. Calculation of relevant values over the data ............................................................. 30 3.2.5. Deployment of the optimization ................................................................................ 31
Results ........................................................................................................................33 3.3.1. GPS algorithm ............................................................................................................. 33 3.3.2. Matlab execution........................................................................................................ 35
Procedure overview ...................................................................................................37 Considerations ............................................................................................................37 Implementation with spreading factor data measurements ......................................38 3.6.1. Results......................................................................................................................... 39 4. EVALUATION.......................................................................................................................40 Test 1 ..........................................................................................................................40 Test 2 ..........................................................................................................................42 New approach: list of locations ..................................................................................43 4.3.1. Methodology .............................................................................................................. 43 4.3.2. Results......................................................................................................................... 44 4.3.3. Methodology testing .................................................................................................. 44 5. CONCLUSIONS ....................................................................................................................49 6. ANNEXES.............................................................................................................................50 Related work on channel models ...............................................................................50 Optimization theory ...................................................................................................52 6.2.1. Graphical optimization ............................................................................................... 52 Mathematical approach to optimization ....................................................................53 6.3.1. Optimal points ............................................................................................................ 53 6.3.2. Optimization problems classification......................................................................... 53 6.3.3. Convex optimization................................................................................................... 53 6.3.4. Lagrangian................................................................................................................... 54 6.3.5. Simple heuristics......................................................................................................... 54 Comparison with other optimization methodologies used in Matlab ........................58 6.4.1. fminsearch .................................................................................................................. 58 6.4.2. fseminf ........................................................................................................................ 58 6.4.3. fsolve........................................................................................................................... 59 6.4.4. fmincon ....................................................................................................................... 59 6.4.5. Kuhn-Tucker equations............................................................................................... 59

7. REFERENCES .......................................................................................................................60

List of figures
Figure 1: LoRaWAN network [16] ...............................................................................................12 Figure 2: Protocol layers [16] .....................................................................................................16 Figure 3: Network architecture of LoRaWAN [16]......................................................................17 Figure 4: LoRa frames [19] .........................................................................................................18 Figure 5: Time on air [18] ...........................................................................................................19 Figure 6: LoRa parameters [20] ..................................................................................................20 Figure 7: Device classes [1].........................................................................................................21 Figure 8: Security topology [16] .................................................................................................21 Figure 9: Battery life [24]............................................................................................................23 Figure 10: Wirnet Station [27] ....................................................................................................26 Figure 11: Map of measurements ..............................................................................................27 Figure 12: Maximum reach ........................................................................................................27 Figure 13: Interest area coverage...............................................................................................30 Figure 14: GPS algorithm first step .............................................................................................33 Figure 15: GPS algorithm Successful poll result..........................................................................34 Figure 16: GPS algorithm Refine mesh result .............................................................................35 Figure 17: Field Test Device [40] ................................................................................................38 Figure 18: Optimal location change ...........................................................................................39 Figure 19: Test 1 gateway placement.........................................................................................40 Figure 20: Test 1 locations..........................................................................................................41 Figure 21: Red values ‚Äì Spreading factor 12 ..............................................................................42 Figure 22: Map representation of P-hus Parking........................................................................45 Figure 23: Map with the gateway at LTH E-huset.......................................................................46 Figure 24: Sensefarm map..........................................................................................................47 Figure 25: Damgarden parking coverage....................................................................................48 Figure 26: Building Information Models software [55] ..............................................................53

List of tables
Table 1: Relation SF - bandwidth - coding rate - bit rate - sensitivity [19]..................................19 Table 2: LoRa specifications .......................................................................................................21 Table 3: Relation SF - transmitted power ...................................................................................22 Table 4: Comparison with other technologies for LPWAN [16] [22]...........................................22 Table 5: Positioning values in degrees........................................................................................29 Table 6: Positioning values in meters .........................................................................................29 Table 7: Gateways' height ..........................................................................................................29 Table 8: Terrain types.................................................................................................................29 Table 9: Gateways - height - n ....................................................................................................30 Table 10: Interest area division ..................................................................................................31 Table 11: Iterations ....................................................................................................................36 Table 12: Amount of bad measurements in each region ...........................................................36 Table 13: Amount of bad measurements in each region ...........................................................37 Table 14: B variance and standard deviation .............................................................................38 Table 15: B values in each region ...............................................................................................39 Table 16: B values in each region ...............................................................................................39 Table 17: Test 1 results ..............................................................................................................40 Table 18: Relation spreading factor and RSSI values ..................................................................41 Table 19: Minimum and maximum RSSI values..........................................................................42 Table 20: Spreading Factor distribution .....................................................................................43 Table 21: List of possible locations in Lund ................................................................................43 Table 22: Spreading factor distribution at P-hus Parking ...........................................................45 Table 23: Initial spreading factor distribution at the P-hus Parking region ................................45 Table 24: Spreading factor distribution LTH E-huset ..................................................................46 Table 25: Initial spreading factor distribution at the LTH E-huset region ...................................46 Table 26: Spreading factor distribution at Sensefarm facilities ..................................................47 Table 27: Initial spreading factor distribution at Sensefarm region ...........................................47 Table 28: Damgarden parking spreading factor distribution......................................................48 Table 29: Initial spreading factor distribution at Damgarden region..........................................48 Table 30: Oulu and Dortmund measurements [6]......................................................................50 Table 31: Path loss values ..........................................................................................................51 Table 32: Relation SF - bandwidth - coding rate - bit rate - transmitted power - sensitivity maximum path loss - maximum distance ...................................................................................51 Table 33: Comparison between optimization techniques ..........................................................59

List of equations
Equation 1: Spreading factor ......................................................................................................18 Equation 2: Data rate .................................................................................................................19 Equation 3: Path loss ..................................................................................................................24 Equation 4: Expected path loss ..................................................................................................24 Equation 5: Optimization function and constraints....................................................................25 Equation 6: Distance ‚Äì law of cosines ........................................................................................28 Equation 7: Euclidean distance ..................................................................................................28 Equation 8: Degree to kilometers conversion in Lund [30] ........................................................28 Equation 9: n value.....................................................................................................................29 Equation 10: Path loss ‚Äì B value.................................................................................................30 Equation 11: Path loss in natural units .......................................................................................32 Equation 12: Path loss with distance equation ..........................................................................32 Equation 13: Objective function.................................................................................................32 Equation 14: n value at 23.5 m...................................................................................................32 Equation 15: Expected path loss at Oulu....................................................................................50 Equation 16: Path loss ................................................................................................................50 Equation 17: Path loss Oulu .......................................................................................................51 Equation 18: Path loss Dortmund ..............................................................................................51 Equation 19: Sensitivity upper limit ...........................................................................................51 Equation 20: Path loss upper limit .............................................................................................51 Equation 21: Maximum distance................................................................................................51 Equation 22: convex set .............................................................................................................53 Equation 23: convex set condition .............................................................................................54 Equation 24: Lagragian ...............................................................................................................54 Equation 25: Dual Lagrange function .........................................................................................54 Equation 26: Optimization with equality constraints .................................................................56 Equation 27: Lagrange multipliers method ................................................................................56 Equation 28: Equations for Lagrange multipliers method ..........................................................56 Equation 29: Optimization with inequality constraints ..............................................................56 Equation 30: Kuhn-Tucker conditions ........................................................................................56 Equation 31: Kuhn-Tucker problem ...........................................................................................57 Equation 32: Lagrangian solution for Kuhn-Tucker problem ......................................................57 Equation 33: Kuhn-Tucker conditions ........................................................................................57 Equation 34: Kuhn-Tucker conditions ........................................................................................57 Equation 35: Interior point method ...........................................................................................58 Equation 36: Ì†µÌ∞∫Ì†µÌ±ó(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)) definition using the interior point method ..........................................58 Equation 37: Interior point method including Ì†µÌ∞∫Ì†µÌ±ó(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)) ..........................................................58 Equation 38: fseminf optimization problem formulation...........................................................59

List of acronyms

LoRa LoRaWAN LPWAN ADR SNR RSSI IoT NB-IoT FSK MAC IP CRC CSS SF CR BW LTE Cat WSN PL EPL OS GPRS EDGE 3G IFC

Long Range Long Range Wide Area Network Low Power Wide Area Network Adaptive Data Rate Signal to Noise Ratio Received Signal Strength Indicator Internet of Things Narrow Band Internet of Things Frequency Shift Keying Media Access Protocol Internet Protocol Cyclic Redundant Check Chirp Spread Spectrum Spreading Factor Coding Rate Bandwidth Long Term Evolution Category Wireless Sensor Network Path Loss Expected Path Loss Operative System General Packet Radio Service Enhanced Data Rates for GSM Evolution Third Generation The Industry Foundation Classes

Popular Science Summary
LoRaWAN is a specification developed to connect devices within an Internet of Things network that are wirelessly connected. The main scope of this technology is to simplify the connectivity among devices. The devices used, mainly sensors, are connected to the Internet through gateways that, at the same time, are connected to servers. The communication with the enddevices can be unidirectional or bidirectional depending on the application. This communication utilizes LoRa technology to connect the device and the gateway. Also, the communication between the gateway and the server can use any other type of technology. [1] Each end-device could have a different frequency channel and a different data rate. The data rate variability depends on the device‚Äôs location and on the messages‚Äô duration; this may vary from 0.3 kbps to 50 kbps. The system uses an Adaptive Data Rate (ADR) scheme in order to handle these changing data rates. As it uses spread spectrum techniques, it ensures that each device‚Äôs channel does not interfere with each other. This technology has three security layers at different levels which protect the data transferred through these networks: Unique Network key (EUI64), Unique Application key (EUI64), and Device specific key (EUI128). [2] There are three defined classes of end-devices: Class A, Class B, and Class C. Class A focuses on covering bidirectional communications where the uplink communication has higher priority. The end-device decides when to send information depending on its needs. Right after this uplink communication is created, two downlink windows are able to be used. Only the end-device can initiate the communication, thus it saves energy. For this reason, Class A is the class type that consumes the lowest amount of energy, and is the one discussed in this thesis. Class B reserves some windows to the downlink in order to send beacons that allow the server to send messages to devices that are mostly asleep. Class C provides constant capability of receiving information as it always keeps the window open. Only when it is necessary to transmit information, it closes the window. As a result, Class C has the highest power consumption of the three classes. [1] [2]

1. INTRODUCTION
Background
LoRaWAN is a Low Power Wide Area Network (LPWAN) which means that end-nodes should consume minimal power in order to reduce the maintenance cost of end-nodes. However, when deploying a gateway, it has a varying distance to every sensor. For example, a sensor far away needs to send information consuming more battery power compared to a sensor closer to the gateway. In LoRaWAN, a feature called Adaptive Data Rate is used, which can reconfigure sensors to a higher or lower data rate when sending. Considering Sensefarm‚Äôs data, a message containing the same information can take from 40 ms to 1.4 seconds to transmit. Figure 1 shows a typical LoRaWAN network.
Figure 1: LoRaWAN network [16] Battery replacement is costly, especially inside apartments which have significant administration overhead in the range of 600 SEK/entrance following Sensefarm‚Äôs data. It might be cost effective to put gateways in certain locations as it increases the sensors‚Äô battery life by increasing the linkbudget (reducing the power consumed) and reducing transmission times. It is important to note that as the number of sensors is expected to increase over time, the cost of maintaining them will also increase. However, there are no methods which can minimize the maintenance costs by placing the gateways of a network at appropriate locations. To do that, one has to determine the optimum gateways‚Äô placement. By determining the optimum gateways‚Äô location, the sensors‚Äô battery life will increase; it is known as reducing the gateway load.
Project aims
The main aim is to save the sensors' batteries. This is done by increasing the SNR at the gateways, which leads to a lower spreading factor. With a lower spreading factor, the data rate increases, and the needed time for sending the message and the power consumed decrease; this is the main challenge. To get these results, the modelling of a wireless sensor network has to be known. Previous works on this field are considered and it is explained in more detail throughout the thesis. The data collected in the city of Lund is used to develop the optimization. There is an open platform (Lunds Open City Sensor Network) which provides information about RSSI, SNR,

bandwidth, frequency, size, code rate, spreading factor and location of the three, distinct gateways, and of the measurements done through the city. Considering this data and the channel model, an SNR expression is optimized.
SNR depends on the noise, which is a random variable and cannot be modified, and the received power. The received power depends on the transmitted power, which is a fixed value dependant on the spreading factor used, and the path loss. Thus, maximizing the SNR is the same as minimizing the path loss.
If the optimization procedure would need more time than the settled time for the optimization, it is possible to apply approximation methodologies that define an error margin in which the optimization solution (in this case, the gateway‚Äôs position) is as close to the best solution as possible.
After applying the optimization procedure, the result is the addition of a new gateway in the optimal location. A portable gateway and a power level measurement tool is used to go to the location, establish the gateway, and take measurements around the city. When the resulting location is not accessible (walls, buildings, etc.), a suboptimal location is analysed. The gateway to add is an outdoor gateway as it provides more coverage than an indoor gateway.
The aim of this Master‚Äôs thesis will consist on finding the optimal location of a new outdoor gateway in Lund Open City Sensor Network by applying optimization techniques [section 2.3].
Approach
The thesis project is based on a theoretical study, a software implementation, and a testing phase. The initial phase has been the proper documentation for the theoretical part. It consisted of studying relevant material in statistics (optimization) and wireless sensor networks (a deep understanding of the LoRaWAN technology and the channel modelling).
The next step was to develop the optimization methodology using Matlab as a tool. In this step, the optimization methods that Matlab provides was researched.
The testing phase consisted of checking the measurements taken on the city when the gateway is placed at the resulting optimal location.
Limitations
The used channel model, which is widely applied in the literature [5] and [6], is considered the best approach to the estimation of the path losses in a LoRaWAN network. The lack of stability of the environment does not calculate the exact path loss results but it is the best approach to the channel estimation as shown in [5] and [6].
Another difficulty is the gateway‚Äôs placement. The optimization gets an optimal location but this location may not always be accessible. A potential solution to this issue is applying the optimization over a list of possible locations that are accessible and finding the best gateway location among these options.

Thesis outline
This thesis is divided in eight chapters. The first chapter covers an introduction to the thesis and to the work. The second chapter provides an overview about the theory used. Chapter 3 develops the optimization implementation using all the knowledge acquired in previous chapters. Chapter 4 evaluates the results of placing the new gateway in different locations and faces a new way to approach the research. Chapter 5 provides a conclusion for the thesis. Chapter 6 has the thesis‚Äô annexes and chapter 7 contains the references to the bibliography used.
Related work
As the network is a wireless sensor network with LPWAN, mobile communications channel models such as Hata or SUI cannot be used in this scenario. Because there has been some research on this topic, it has been established that the best way to model a LPWAN with LoRaWAN technology is by using a log-normal definition for the path losses based on [5] and [6] experiments. Studies [5] and [6] are more similar to Lund‚Äôs scenario, they were developed in Oulu (Finland) and Dortmund (Germany). They are similar scenarios because they are sub-urban areas and they have used LoRa technology as well. [7] uses a log-normal model too, but it applies a mathematical approach, which is useful to consider.
Further research supports the idea of using log-normal distributions. In [8], the use of a one slope with two slopes log-normal model is compared in a wireless sensor network. There is a tendency to use larger number of slopes in the model when the environment has worse propagating properties (urban, indoor, buildings, etc.).
A similar technology that is used in IoT scenarios is NB-IoT. One of the most relevant differences is that LoRaWAN uses unlicensed spectrum meanwhile NB-IoT connects to an operator network through licensed spectrum. The advantage that LoRaWAN has compared to NB-IoT is that it does not need a mobile operator to work; nevertheless, it uses a proprietary modulation (LoRa) which may complicate its development. [9]
There is a deep research on the optimization field applied to sensor networks, for example [10] studies how to distribute the gateways over surface in order to connect underwater sensors. [11], [12] and [13] analyse how to distribute the gateways in a non-LoRaWAN network to make it more efficient. [14] and [15] get a similar approach as they optimize the gateway‚Äôs placement in a wireless sensor network; however, as it is an ordinary wireless sensor network, it sends the information by several hops. The sensors do not directly send the information to the gateway because they cannot reach it, so they send the data to other sensors jumping from one sensor to another until the gateway is reached. [14] and [15] optimize the gateway‚Äôs placement by minimizing the number of hops. This is not a problem in LoRaWAN networks as they directly reach the gateway due to the large coverage of LoRaWAN networks.
Advancements and outcome
The advancement of this Master‚Äôs thesis is the development of a methodology that can be implemented over any LoRaWAN wireless sensor network to get a better, overall performance.

The outcome of this Master‚Äôs thesis is a detailed study on the improvement of a current IoT network by reducing the power consumed on its devices that use LoRaWAN technology.
Resources
The work of the Master‚Äôs thesis has been done at the Sensefarm office in Lund. Sensefarm is a company focusing on sustainability in agriculture and green cities, which achieves it with sensor network technology. It is a star-up with 6 employees.
A workstation was provided to work in the company facilities as well as to use their prior research. All the sensors, gateways and technology that Sensefarm has deployed in Lund has been accessible in order to test the studies and to verify the procedures.

2. THEORETICAL REVIEW
Chapter 2 makes an overview of the three main concepts used in this thesis: the type of network (LoRaWAN ‚Äì section 2.1), the channel analysis for the communication (section 2.2) and the way of getting the results (optimization theory ‚Äì section 2.3).
LoRaWAN
LoRa is the physical layer used in LoRaWAN networks. It uses Frequency Shift Keying (FSK) modulation in order to achieve low power consumption, and it uses Chirp Spread Spectrum in order to cover a large area. The biggest outcome from LoRa is its capability of long communication ranges because its link budget is higher than most other technologies. LoRa is used in Low Power Wide Area Networks (LPWAN) because it reaches long distances consuming low power. Thus, it is mainly used in IoT applications where the end-devices in the network only transmit small, infrequent, information amounts. Hence, this technology extends their battery life. [16] LoRaWAN is a MAC (Media Access Protocol) protocol used when the LoRa physical layer is applied. [16] [17]. Figure 2 shows LoRa distribution in the protocol layers.
Figure 2: Protocol layers [16]
2.1.1. Network architecture
The network architecture generally used in LoRaWAN is a mesh network architecture with a star topology. It consists of end-devices that are connected to some gateways with one hop (no repeaters needed) and these gateways are connected to a server through another technology (IP, Ethernet, WiFi, etc.). This allows for the access of a long-range network. [16][18] This is shown in Figure 3.

Figure 3: Network architecture of LoRaWAN [16]
In a LoRaWAN network, one node transmits the information to more than one gateway. Every gateway sends all the information received to the server (even if it is repeated), and the server is responsible for filtering repeated content.
In IoT applications, since the gateways receive loads of data from a large number of sensors, they have high capacity to manage it. High capacity is attained by applying Adaptive Data Rate (ADR) and having multichannel transceivers at the gateway. The number of concurrent channels, the time on air, the payload length and the way that nodes transmit are all factors affecting this capacity. [16]
2.1.2. Frames
The frames in LoRaWAN at the physical layer are constituted by a preamble (approximately 12.25 Ì†µÌ±áÌ†µÌ±†, it carries out synchronization functions and defines the modulation used), a header (it includes a Header Cyclic Redundant Check (CRC), consists of 20 bits in total, and it has a coding rate of 4/8 to be more reliable while the rest of the frame has another coding rate), the payload (from 51 Bytes to 222 Bytes), and a CRC field. [18] [19] These fields are easier to identify in Figure 4.

Figure 4: LoRa frames [19]
2.1.3. Adaptive Data Rate
LoRa uses Chirp Spread Spectrum (CSS) modulation in order to avoid interference, Doppler Effect, and multipath. [18] This means that the signals are orthogonal to each other. A spreading factor change results in a data rate change. The spread factor can be changed in order to get better data rates for transmissions where the link is better. Hence, the transceivers can manage receiving different data rates in different channels. [16]
The spread factor is defined as:
Ì†µÌ±ÜÌ†µÌ∞π = log2(Ì†µÌ†µÌ±ÖÌ±ÖÌ†µÌ†µÌ±†Ì±ê)
Equation 1: Spreading factor where Ì†µÌ±ÖÌ†µÌ±† is the symbol rate and Ì†µÌ±ÖÌ†µÌ±ê is the chip rate. [18]
A data rate change is also translated in a change on the Time on Air of the information sent. Lowering the spreading factor means increasing the data rate and it means lowering the Time on Air. If a node needs less Time on Air, this time is available for other nodes to transmit. If the Time on Air is low, it results in battery consumption savings. This capability of changing the spreading factor, and consequently the data rate and the Time on Air is the Adaptive Data Rate (ADR). Adaptive Data Rate works with symmetrical uplink and downlink conditions. [16]
Figure 5 shows an example of how much the Time on Air can change using different spreading factors.

Figure 5: Time on air [18] The relation between the data rate and the spreading factor is shown in Equation 2:

Ì†µÌ±ÜÌ†µÌ∞π

Ì†µÌ±ÜÌ†µÌ∞π √ó Ì†µÌ∞µÌ†µÌ±ä

Ì†µÌ±ÖÌ†µÌ±è = Ì†µÌ±áÌ†µÌ±† Ì†µÌ∞∂Ì†µÌ±Ö = 2Ì†µÌ±ÜÌ†µÌ∞π Ì†µÌ∞∂Ì†µÌ±Ö

Equation 2: Data rate
Where CR is the rate of the forward error correction code (4/5, 4/6, 4/7 or 4/8) and Ì†µÌ±áÌ†µÌ±† is the symbol duration.

Equation 1 shows that as the spreading factor increases, the data rate decreases; however, at the same time the sensitivity is higher. Table 1 shows some examples of these relations between spreading factor, channel bandwidth, coding rate, bit rate and sensitivity:

Spreading factor 12 11 10 9 8 7 7

Bandwidth (kHz) 125 125 125 125 125 125 250

Coding rate 4/6 4/6 4/5 4/5 4/5 4/5 4/5

Bit rate (bps) 250 440 980 1760 3125 5470 11000

Sensitivity (dBm) -137 -136 -134 -131 -128 -125 -122

Table 1: Relation SF - bandwidth - coding rate - bit rate - sensitivity [19]

Figure 6 shows how LoRa parameters vary altogether.

Figure 6: LoRa parameters [20] Thanks to LoRa properties, a LoRaWAN network can increase its size and capacity using the Adaptive Data Rate feature. If a capacity increase is needed, the addition of gateways would solve this issue. [16]
2.1.4. Device classes
There are three defined classes of end-devices used for different applications.
Class A covers bidirectional communications, but the uplink communication has higher priority. The end-device decides when to send information depending on its needs. [1][2] This is known as ALOHA mode. Here, the device transmits the uplink as soon as information is to be sent, does not have to wait for a certain time slot, and has priority over downlink messages. [19] Right after this uplink communication is established, there are two downlink windows. The communication can only be initiated by the end-device, thus it saves energy. Class A is the class type which consumes the lowest power.
Class B reserves some windows to the downlink data in order to send beacons that allows the server to send messages to mostly asleep devices. A device is sleeping when it is not taking measurements, sending information or waiting to receive it.
Class C provides constant capability of receiving information as it always keeps the window open. Only when it is necessary to transmit information, it closes the window. Class C has the highest power consumption of the three classes. [1] [2]
Figure 7 compares the main features of the three class types and how they vary regarding battery lifetime and downlink latency.

Figure 7: Device classes [1]
2.1.5. Security
LoRaWAN uses two security layers: one for the network (Network Session Key ‚Äì NwkSKey) to authenticate the node, and one for the application (Application Session Key ‚Äì AppSKey) to save user‚Äôs application data. [16] The security protocol is based on the 802.15.4 protocol (AES-128). [20] Both security layers are shown in Figure 8.

Figure 8: Security topology [16]

2.1.6. Specifications
Depending on the region, there are different specifications on LoRa. As this master‚Äôs thesis is done in Lund, the analysis uses European specifications:

Frequency band Channels Channel Bandwidth uplink Channel Bandwidth downlink Transmitted power uplink (maximum) Transmitted power downlink (maximum) Spreading Factor uplink Data rate Link Budget uplink Link Budget downlink

867-869 MHz 10 125/250 kHz 125 kHz 14 dBm 14 dBm 7 ‚Äì 12 250 bps ‚Äì 50 kbps 155 dB 155 dB

Table 2: LoRa specifications

Of the ten channels, eight are used to transmit information, one is used with high data rate at 11 kbps, and the last is used with FSK at 50 kbps. [16] The eight channels dedicated to transmit information are used uplink, another is used downlink to provide responses from the gateway to the device, and the other is used to transmit a device‚Äôs request to the gateway uplink. [19]

The transmitted power varies depending on the spreading factor and bit rate used. As the spreading factor decreases by steps of 1, the transmitted power also does by steps of 2dB. Table 3 shows this relation.

SF Bandwidth (kHz) 12 125 11 125 10 125 9 125 8 125 7 125 7 250

Transmitted power Maximum transmitted power Maximum transmitted power ‚Äì 2dB Maximum transmitted power ‚Äì 4dB Maximum transmitted power ‚Äì 6dB Maximum transmitted power - 8dB Maximum transmitted power ‚Äì 10dB Maximum transmitted power ‚Äì 12dB

Transmitted power (dBm) 14 12 10 8 6 4 2

Table 3: Relation SF - transmitted power

Specifically, the steps are of 2.15 dB as it is referred to a half-wave dipole but it is always referred as 2dB. [21]

2.1.7. Comparison with other technologies for LPWAN
Table 4 compares LoRaWAN with Narrow-Band IoT, LTE Cat-1, LTE Cat-M, NB-LTE and SigFox. LoRaWAN data rate is not the highest, however, the type of applications that use LoRaWAN do not require high data rates. Its batteries last longer than other technologies, it saves more power, and it is more immune against interferences. [16] [22] Its main competitor is NB-IoT. Comparing them, LoRa is focused on lower-cost, high-volume applications, whereas NB-IoT is focused on high-value applications in which it is possible to pay more in order to get a better quality of service. [23]

Modulation
Bandwidth Data rate
Maximum Output power Link budget Battery Power efficiency Interference immunity Security Range

LoRaWAN SS Chirp
125 ‚Äì 500 kHz 290 bps ‚Äì 50 kbps 20 dBm

NB-IoT UNB / GFSK / BPSK 100 Hz 100 bps
20 dBm

LTE Cat-1 OFDMA

LTE Cat-M OFDMA

NB-LTE OFDMA

SigFox GFSK / DBPSK

20 MHz 10 Mbps
23 ‚Äì 46 dBm

1.4 ‚Äì 20 MHz 200 kbps ‚Äì 1 Mbps 23 ‚Äì 30 dBm

200 kHz 20 kbps
20 dBm

100 bps

154 dB 105 months Very high
Very high

151 dB 90 months Very high
Low

130 dB Low Medium

146 dB 18 months Medium
Medium

150 dB
Medium / High Low

146 dB 7 to 8 years Very high
Yes

Yes

No

Yes

2 ‚Äì 5 km urban 1.5 km

15km sub-

urban

urban

20 ‚Äì 40 km

45 km rural rural

Yes

Yes

35 km 2G

200 km 3G

and 4G

Yes 3 ‚Äì 10 km urban 30 ‚Äì 50 km rural

Table 4: Comparison with other technologies for LPWAN [16] [22]

Some other competitors are: Ingenu and Weightless. Ingenu uses the 2.4 GHz band, and its main feature is its high data rate up to 624 kbps for uplink and 156 kbps for downlink; however, its range extends up to 6 kilometres, and it consumes more energy because of the band used. The Weightless Special Interest Group has developed three standards: Weightless-W, Weightless-N and Weightless-P. Weightless-W uses the whitespaces left by television (470 ‚Äì 790 MHz), its data rates go from 1 kbps to 1 Mbps and its battery lasts from 3 to 5 years. Weightless-P covers multiple band frequencies and its battery life ranges from 3 to 8 years. [18] (These last three standards are not included in the table).
2.1.8. Applications
The use of LoRa is widespread in several environments due to its versatility and great coverage. These applications can include, but are not limited to the following: parking management, air pollution monitoring, asset tracking, agriculture processing, cattle tracking, energy management and sustainability, fall detection, fire detection, fleet management, fleet tracking, home security, indoor air quality, industrial temperature monitoring, liquid presence detection, stolen vehicles location, medical refrigerators, precision farming, predictive maintenance, radiation leak detection, shipment quality, smart home asset tracking, smart lighting, smart parking, tank flow monitoring, waste management, water flow monitoring, water management and protection or wireless gas level monitoring. [19]
2.1.9. Battery life
This thesis is focused on decreasing power consumption. Figure 9 shows a battery consumption approach in a cycle measured by a digital oscilloscope. The process starts by waking up the enddevice, taking the measurements, transmitting the information to the gateway, waiting to check if the gateway sends information back and, finally, returning to sleep. The transmission to the gateway is the step that consumes the most power; the bigger the spreading factor, the higher the consumption. Therefore, the main objective is improving this part of the transmission. [24]
Figure 9: Battery life [24]

Channel model
As it is a Wireless Sensor Network (WSN) of a Low Power Wide Area Network (LPWAN), mobile communication channel models such as Hata or SUI cannot be used with LoRaWAN technology. There has been some previous research on this topic, the main conclusion obtained from them is that the best way to model a LoRaWAN network is using a log-normal definition of the path losses. [5] [6]
The log-normal definition can use one or more slopes. The use of more slopes leads to results that are more accurate. This is necessary when there is a difficult propagation environment such as in urban areas, indoor propagation, hills and buildings, etc. Thus, it is going to be considered the one slope definition as Lund is a sub-urban area without indoor propagation and it is flat.
There are some studies already done to estimate the channel model in a network that uses LoRaWAN. Their definition of the measured path loss is shown in Equation 3.
Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = |Ì†µÌ±ÖÌ†µÌ±ÜÌ†µÌ±ÜÌ†µÌ∞º|(Ì†µÌ±ëÌ†µÌ∞µ) + Ì†µÌ±ÜÌ†µÌ±ÅÌ†µÌ±Ö(Ì†µÌ±ëÌ†µÌ∞µ) + Ì†µÌ±ÉÌ†µÌ±áÌ†µÌ±ã(Ì†µÌ±ëÌ†µÌ∞µ) + Ì†µÌ∞∫Ì†µÌ±ÖÌ†µÌ±ã(Ì†µÌ±ëÌ†µÌ∞µ)
Equation 3: Path loss Where RSSI is the Received Signal Strength Indicator,Ì†µÌ±ÉÌ†µÌ±áÌ†µÌ±ã is the transmitted power and Ì†µÌ∞∫Ì†µÌ±ÖÌ†µÌ±ã is the received gain. [5]
Equation 3 is generalized by the expression of the expected path loss [6] which is shown in Equation 4.
Ì†µÌ±ë Ì†µÌ∞∏Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = Ì†µÌ∞µ + 10Ì†µÌ±õ log10(Ì†µÌ±ë0)
Equation 4: Expected path loss Where B is the path loss at the reference distance of d0, n is the path loss exponent, d is the distance in kilometres and Ì†µÌ±ë0 is the reference distance of 1 km.
As a reference, through EPL equation, the free space equation that comes from Friis formula can be computed with n=2 and B will vary depending on the frequency used; for 868 MHz, B is 91.22. However, as the free space conditions are just ideal and not real, these values can only be considered as a reference. [5]
A more complete channel model analysis can be found in the section 6.1.
Optimization theory
Optimization consists of reaching the optimal solution of a problem where cost and profit are the variables considered. The objective is to reduce the cost and to increase the profit which means increasing the difference profit ‚Äì cost.
Following a mathematical approach, optimization is the process of getting the best solution under certain circumstances. The objective is to minimize a negative effect or to maximize a positive effect. These effects are mathematically represented by a function (objective function) that depends on some design variables. These design variables may have some restrictions; hence, the optimization process is defined as the process of looking for the maximum or

minimum value of the objective function and its variables‚Äô values where the maximum or minimum values are reached.
The general optimization problem structure is shown in Equation 5.
min Ì†µÌ±ì(Ì†µÌ±•)
Ì†µÌ±•
Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) ‚â§ 0 Ì†µÌ±ó = 1, 2, ‚Ä¶ Ì†µÌ±ö
‚ÑéÌ†µÌ±ò(Ì†µÌ±•) = 0 Ì†µÌ±ò = 1, 2, ‚Ä¶ Ì†µÌ±ù
Equation 5: Optimization function and constraints In Equation 5, the components that are defined are: Ì†µÌ±ì(Ì†µÌ±•), Ì†µÌ±•, Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) and ‚ÑéÌ†µÌ±ò(Ì†µÌ±•).
Ì†µÌ±ì(Ì†µÌ±•) is the objective function to be minimized that depends on n variables, and it can be linear or not.
x is the design vector, an n-component vector that contains the variables of Ì†µÌ±ì(Ì†µÌ±•): Ì†µÌ±• = [Ì†µÌ±•1, Ì†µÌ±•2, ‚Ä¶ , Ì†µÌ±•Ì†µÌ±õ] Ì†µÌ±á
Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) defines the inequality constraints and ‚ÑéÌ†µÌ±ò(Ì†µÌ±•) defines the equality constraints. Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) and ‚ÑéÌ†µÌ±ò(Ì†µÌ±•) may be more than one or they may not be present. The set of values from x that satisfy all the restrictions is known as possible region or possible set, thus, the solution has to be a vector x that is in this region.
The goal is to find the vector x where the function Ì†µÌ±ì(Ì†µÌ±•) reaches its minimum. This is a general way of expressing an optimization problem. If it were a maximization problem, it would consist of minimizing the negative version of the objective function. Similarly, if the inequalities had the opposite sign, it would acquire the same structure using the negative expression of the constraint. [26]
An optimization analysis of the problem in this thesis can be found in annex 6.2 and a continuation of the mathematical approach in annex 6.3.

3. IMPLEMENTATION
Chapter 3 starts providing information about the gateways used in the network and continues with the explanation of the optimization implementation.
Gateways‚Äô information
The three gateways used are the Wirnet Station from Kerlink, this device is shown in Figure 10.
It is designed for outdoor usage, has a gain of 3dB, and it can reach up to -141 dBm of sensitivity, which is lower than the minimum sensitivity with a spreading factor 12. Also, it operates in 868 MHz band for bidirectional communications, has embedded, remote and open low power communication stations, an open development framework (Linux OS), and it can connect to the network by GPRS/EDGE/3G or Ethernet. [27]

Optimization

Figure 10: Wirnet Station [27]

3.2.1. Process overview
The following steps have been followed in order to proceed with the optimization; they are going to be explained in detail from section 3.2.2 to section 3.2.5:
- Measurements data extraction from the environment under study - Data preparation to be analysed - Relevant values‚Äô calculation over the data - Deployment of the optimization

3.2.2. Measurements data extraction
To proceed with the optimization, there are some previous steps to follow. First, all the data obtained from measurements have been sorted out in Excel: EUI (measurement identifier), latitude (of the measurement), longitude (of the measurement), RSSI, SNR, time and gateway connection (identifier).

A coloured dot indicates each measurement. Figure 11 shows the three gateways coverage in which the worst measurements are shown by a red dot. When the RSSI is higher than -102.6 dBm there is a green dot, when the RSSI is between -102.6 dBm and -106.6 dBm there is a yellow dot, and when the RSSI is equal to or below -106.6 dBm there is a red dot. These values have been defined by the developers of the tool that displays the taken measurements.

Figure 11: Map of measurements It is easy to identify where the gateways are located as there is a dense, green area around them. In the north, this is the Vattentornet gateway, in the west, this is the Kristallen gateway and, in the south, this is the Rabyvagen gateway. Figure 12 shows the maximum reach of the gateways, the network catches up to 22 km and the outskirts of Malm√∂.
Figure 12: Maximum reach
3.2.2.1 Analysis of measurements with a low signal strength
There is a certain area in the central-north portion of the map mainly covered in red. Although the Vattentornet gateway is not too far from there, this gateway has been placed on the eastern tower area. The gateway‚Äôs antenna is omnidirectional but it does not have line of sight with this area due to the dome over the tower. Therefore, this northern area is not properly covered either by the Vattentornet gateway or by the Kristallen gateway. In the north east, the accumulation of measurements with a low signal strength is caused by shadowing due to Elite Hotel Ideon. It is the only building in this area that is taller than the tower and avoids further propagation.

In the south, there are more areas with low signal strength. The gateway placed in Rabyvagen has not a large coverage, it gets bad measurements nearby its location. It has a lower height than the other gateways, 20.35 m and in front of it there is a taller building which absorbs the majority of the radiation avoiding the gateway to connect with further points.

3.2.3. Data preparation
In order to estimate the channel, the values of B and n (path loss coefficient) from Equation 4 for every taken measurement have been calculated. Firstly, the path loss (PL(dB)) and the distance (d) are calculated.

3.2.3.1 Path loss The path loss is obtained from Equation 3, where RSSI and SNR are measured values, Ì†µÌ±ÉÌ†µÌ±áÌ†µÌ±ã is always 14 dBm as all the measurements have been taken with spreading factor 12 and the gain of the gateway is 3 dB [27].

3.2.3.2 Distance The distance requires more complex operations than the path loss as the positioning data given is the latitude and longitude. The equation needed to obtain the distance between two points knowing their latitudes and longitudes is the law of cosines expressed in Equation 6.

Ì†µÌ±ë = acos(Ì†µÌ±†Ì†µÌ±ñÌ†µÌ±õÌ†µÌºë1 ‚àó Ì†µÌ±†Ì†µÌ±ñÌ†µÌ±õÌ†µÌºë2 + Ì†µÌ±êÌ†µÌ±úÌ†µÌ±†Ì†µÌºë1 ‚àó Ì†µÌ±êÌ†µÌ±úÌ†µÌ±†Ì†µÌºë2 ‚àó Ì†µÌ±êÌ†µÌ±úÌ†µÌ±†‚àÜŒª) ‚àó R
Equation 6: Distance ‚Äì law of cosines Where Ì†µÌºë1 and Ì†µÌºë2 are both points‚Äô latitudes, ‚àÜŒª is the difference between both point‚Äôs longitudes and R is the Earth radius Ì†µÌ±Ö = 6,371 Ì†µÌ±òÌ†µÌ±ö being d the total distance. [28]

Even though, the distance expression depends on sines and cosines and an expression that uses trigonometric functions cannot be easily minimized; the solution is to apply the Euclidean distance expression. This change does not have a great impact over the result as the area under study can be considered flat and there is no need to consider the Earth curvature. Equation 7 shows the Euclidean distance expression. [29]

Ì†µÌ±ëÃÖ = ‚àö(Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö ‚àí Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä)2 + (Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö ‚àí Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä)2
Equation 7: Euclidean distance Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö and Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö are the measurement coordinates in the city and Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä and Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä the gateway coordinates (being a scalar) in meters. d is the distance from the measurement to the gateway.

To get the coordinates in meters, the equivalence between degrees and meters has been used:

1¬∫ = 111.32 km at the Equator, as Lund is between 55¬∫ and 56¬∫.

One degree in Lund for the distance in the east-west direction is:

1¬∫

=

Ì†µÌ±Ö

‚àó

(sin

(56Ì†µÌºã)
180

‚àí

sin

(55Ì†µÌºã))
180

=

63.05

Ì†µÌ±òÌ†µÌ±ö

Equation 8: Degree to kilometers conversion in Lund [30]

In order to calculate the distance between a measurement and the gateway, the Euclidean distance equation is applied and it only uses the data in meters, the coordinates have to be converted from degrees to meters. This coordinates‚Äô definition in meters is only applied to calculate distances among points, hence it is not representative over a map because coordinates (longitude and latitude) are expressed in degrees.

An example is included to see that there is not as a large of a difference between the two methodologies:

Latitude (¬∫) Longitude (¬∫) Gateway latitude (¬∫) Gateway longitude (¬∫)

55.71243

13.21483

55.71174

13.20399

Y (km) 6201.90807

X (km) 1471.0752

Y Gateway (km) 6201.831676

Table 5: Positioning values in degrees

X Gateway (km) 1469.869057

d XY (km) d (km) 0.604303 0.68378

Table 6: Positioning values in meters

3.2.3.3 Path loss exponent - n The n estimation follows Equation 9.

Ì†µÌ±ê Ì†µÌ±õ = Ì†µÌ±é ‚àí Ì†µÌ±è ‚àó ‚ÑéÌ†µÌ∞∫Ì†µÌ±ä + ‚ÑéÌ†µÌ∞∫Ì†µÌ±ä

Equation 9: n value
where ‚ÑéÌ†µÌ∞∫Ì†µÌ±ä is the gateway‚Äôs height and the values a, b and c are variables that depend on the type of terrain. Terrain type A is for hilly areas with moderate to high tree density, terrain type B is for intermediate conditions, and terrain type C is for flat areas with light tree densities. [31]

Table 7 contains the current gateways‚Äô heights in the network and Table 8 shows the constant values a, b, and c from Equation 9 at every terrain type.

Gateway's names lund-kristallen [32] lund-rabyvagen [32] lund-vattentornet [33]

Height (m) 26.66
20.356 34

Table 7: Gateways' height

Terrain type A

Terrain type B

Terrain type C

a

4.6

4

3.6

b

0.0075

0.0065

0.005

c

12.6

17.1

20

Table 8: Terrain types

The terrain type in Lund is B because the terrain is between hilly and flat and the tree density is medium. Table 9 shows the n values of the gateways applying Equation 9.

Gateway's names lund-kristallen lund-rabyvagen lund-vattentornet

Height (m) 26.66
20.356 34

n 4.46812 4.70773 4.28194

Table 9: Gateways - height - n
The path loss exponent can be estimated in several ways, it also depend on the type of city. However, as Lund is a sub-urban area and the range for sub-urban areas is from 3 to 5, the results fit these requirements. [34]

3.2.3.4 B value

With the path loss value, the distance and the path loss exponent (n), the B parameter for the

path loss equation of every measurement is obtained with Equation 10.

Ì†µÃÖÃÖÌ±ÉÌ†µÃÖÌ∞øÃÖ(ÃÖÌ†µÃÖÌ±ëÃÖÌ†µÃÖÌ∞µÃÖ)ÃÖ

=

Ì†µÃÖÌ∞µ

+

10Ì†µÌ±õ

Ì†µÌ±ëÃÖ log10(Ì†µÌ±ë0)

‚Üí

Ì†µÃÖÌ∞µ

=

ÃÖÌ†µÃÖÌ±ÉÌ†µÃÖÌ∞øÃÖ(ÃÖÃÖÌ†µÌ±ëÃÖÌ†µÃÖÌ∞µÃÖÃÖ)

‚àí

10Ì†µÌ±õ

log10

Ì†µÌ±ëÃÖ (Ì†µÌ±ë0)

Equation 10: Path loss ‚Äì B value

3.2.4. Calculation of relevant values over the data
In this section, the procedure of data collection and processing before the optimization is carried out. All the calculations in this section have been performed using R.

3.2.4.1 Step 1 Figure 11 shows that the areas with poorer coverage are a central zone and the road 102. As the central zone covers the city center and more populated areas, the objective is to improve this region. The area of interest is limited in the north by Norra Ringen (55.7211¬∫ latitude), in the south by an area close to Sodra v√§gen (55.694606¬∫ latitude), to the west by the central station (13.1885¬∫ longitude), and to the east by the Rabyvagen gateway (13.201396¬∫ longitude) as shown in Figure 13.

Figure 13: Interest area coverage From Figure 13, it is possible to get the central point of the interest area 55.7078¬∫, 13.194948¬∫. This value is going to be useful further afield to start the optimization iterations in that point.
From the area in Figure 13, named from now on as interest area, the green and yellow points are not going to be considered in the optimization, as the goal is to improve the worse cases (red points).

3.2.4.2 Step 2 Following Equation 10, the B value of each path has been estimated, from each measurement to the gateway that it was connected. Nevertheless, if a new gateway is placed, the path loss will not be the same, as each end-device would be connected to a different gateway with a different location, different path losses and different gateway‚Äôs height. Channel estimation is a procedure that cannot be accurately predicted, but it is possible to estimate it based on previous data.
The approach followed in this thesis in order to estimate the channel has consisted in dividing the interest area to improve in 16 small regions, and the B factor in each small area has been estimated as an average of the previous measurements of B in that area. For example, if there are two measurements in region 1, the average of these two values is the B value for every measurement in region 1. As a result, it generates a vector of 16 values of B called BP.
3.2.4.3 Step 3 The new gateway has been considered to be placed in one of the four central areas to have more or less an equal distance to every location. The structure is represented in Table 10.
1234
5678
9 10 11 12
13 14 15 16
Table 10: Interest area division The path losses are different regarding the gateway location, thus the B value will vary considering both the gateway and the measurement location.
To clarify the procedure followed, an example is included to explain the way to obtain the new B values vector, Bp. If the measurement were placed in region 5 and the gateway were placed in region 6, the new B value would be the average between the B value in 5 and 6. If the measurement were located in region 14 and the gateway were placed in region 6 too, the B value would be the average between the B value in 6, 10 and 14.
The collected measurements show RSSI values that reach up to -119 dBm.
3.2.5. Deployment of the optimization
3.2.5.1 Methodology used Once all the data has been arranged, the next step is to deploy the optimization. It is run in Matlab. Despite the initial idea of using the toolbox ‚Äòcvx‚Äô [4], it has been tested that it does not allow to implement optimizations with vector information, hence, the function ‚Äòpatternsearch‚Äô has been used to minimize the objective function. [36] There are other functions in Matlab that allow to minimize functions, however, ‚Äòpatternsearch‚Äô is the one that fits better the requirements as it allows to introduce constraints and it can consider all the measurements for the optimization. The feasibility of other options is going to be analysed in section 6.4.

3.2.5.2 Objective function definition The goal is to minimize the network path losses, thus the objective function is the product of all the path losses of every measurement in natural units. It has been used natural units instead of the expression in decibels due to the unfeasibility of minimizing logarithmic expressions. Equation 11 is the path loss expression used in natural units, it represents the path loss between every measurement and the gateway to which it is connected.

Ì†µÃÖÃÖÌ±ÉÌ†µÃÖÌ∞øÃÖ(ÃÖÃÖÌ†µÌ±ëÃÖÌ†µÃÖÌ∞µÃÖÃÖ)

=

Ì†µÃÖÌ∞µ

+

10Ì†µÌ±õ

Ì†µÌ±ëÃÖ log10(Ì†µÌ±ë0)

‚Üí

Ì†µÌ±ÉÌ†µÌ∞ø

=

10Ì†µÃÖÃÖÌ∞µÃÖ(ÃÖÌ†µÃÖÌ±ëÃÖÌ†µÃÖÌ∞µÃÖ)ÃÖ/10

‚àó

Ì†µÌ±ëÃÖÌ†µÌ±õ

Equation 11: Path loss in natural units Equation 12 results as the Equation 7 and Equation 11 combination.

ÃÖÌ†µÃÖÌ±ÉÃÖÌ†µÃÖÌ∞ø = 10Ì†µÃÖÃÖÌ∞µÃÖ(ÃÖÌ†µÃÖÌ±ëÃÖÌ†µÃÖÌ∞µÃÖ)ÃÖ/10 ‚àó ((Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö ‚àí Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä)2 + (Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö ‚àí Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä)2)Ì†µÌ±õ/2
Equation 12: Path loss with distance equation
The optimization design variables are the location coordinates of the new gateway (Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä and Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä). The goal is to determine the value of Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä and Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä that minimize the objective function value. The optimization tests which the value of the optimization function is in every point in the study area. From all these values, it takes the lowest one as its optimal point (minimum value).

Equation 13 shows the final objective function, the path loss is multiplied by every measurement location.

Ì†µÌ±ôÌ†µÌ±íÌ†µÌ±õÌ†µÌ±îÌ†µÌ±°‚Ñé(Ì†µÃÖÃÖÌ±•ÃÖÌ†µÃÖÌ±öÃÖ)

min
Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä,Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä

‚àè

10Ì†µÃÖÃÖÌ∞µÃÖÌ†µÃÖÌ±É(Ì†µÌ±ëÌ†µÌ∞µ)(Ì†µÌ±ò)/10 ‚àó ((Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö(Ì†µÌ±ò) ‚àí Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä)2 + (Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö(Ì†µÌ±ò) ‚àí Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä)2)Ì†µÌ±õ/2

Ì†µÌ±ò=1

Equation 13: Objective function Equation 13 components are:

Ì†µÃÖÃÖÌ∞µÃÖÌ†µÃÖÌ±É is the vector of the 16 values of averaged B then, Ì†µÃÖÃÖÌ∞µÃÖÌ†µÃÖÌ±É(Ì†µÌ±ëÌ†µÌ∞µ)(Ì†µÌ±ò) is a constant value and it gets the BP value used at the measurement k.

Ì†µÌ±•Ì†µÌ∞∫Ì†µÌ±ä Ì†µÌ±éÌ†µÌ±õÌ†µÌ±ë Ì†µÌ±¶Ì†µÌ∞∫Ì†µÌ±ä are the new gateway coordinates to be determined (a constant value).
Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö and Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö are both vectors, Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö(Ì†µÌ±ò) and Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö(Ì†µÌ±ò) are constant coordinates values of the measurement k, all the measurements create the vectors Ì†µÃÖÌ±•ÃÖÌ†µÃÖÃÖÌ±ö and Ì†µÃÖÃÖÌ±¶Ì†µÃÖÃÖÌ±ö .
n is a constant value that does not vary. Its value will depend on the new gateway height. As the height cannot be known beforehand, it has been estimated that the new gateway is going to be placed over a 5-floor building. The height of a 5-floor building has been calculated with the tool [36] and it is 23.5 m. Equation 14 shows the n value for the new gateway estimation.
Ì†µÌ±õ = 4 ‚àí 0.0065 ‚àó ‚Ñé + 17.1 = 4.5749
‚Ñé
Equation 14: n value at 23.5 m

Results
Matlab provides algorithms for optimization; the selected algorithm for this application is patternsearch. The selection has been made based on its possibility of minimizing constrained problems (the new gateway has to be placed inside Lund, which limits/constrains the region) and it allows considering large amounts of data. Section 6.4 compares patternsearch with other algorithms providing support to consider patternsearch as the best algorithm to optimize this network. 3.3.1. GPS algorithm Patternsearch is a technique that requires the discretization of the space study. In the current scenario, this technique applies GPS algorithm, where the mesh represents the area under study (Lund). The iterative algorithm takes into account the Lund area, and the process reduces the area until it reaches a single point, being this point the solution of the considered problem. The mesh size value shows the degree of reduction being mesh size 1 the whole area. [37] The process is started at the initial point. In this experiment, the initial point is the central point of the interest area as it is more likely to have an optimal result centred in the area under study. In each iteration, the algorithm considers a set of points inside the mesh area called mesh points. The mesh points are equidistant points to the initial point and their distance to the initial point varies as the mesh size does. Figure 14 shows the initial structure of this methodology. The mesh points (in red) are equidistant points from the initial point covering the area under study, in this example, it is the whole circumference (mesh size 1).
Figure 14: GPS algorithm first step

The first step calculates the value of the objective function at the initial point and at the mesh points. The algorithm polls the mesh points by computing their objective function values. The poll may be successful or not. If the poll is successful (Successful poll), an objective function value lower than the value of the objective function for the initial point has been found at one of the mesh points. For the next iteration, the point that has obtained a lower value of the objective function is used as the new initial point and the mesh size is doubled. Doubling the mesh size makes the next set of mesh points to be chosen equidistantly to the new initial point, but at double the distance compared to the previous distance. The area considered is increased by the square root of two. Figure 15 shows that if one of the mesh points reaches a lower path loss value than the initial point path loss, this mesh point is the new initial point for the next iteration and the new area under study (blue circumference) is double the previous area but centred in the new initial point.
Figure 15: GPS algorithm Successful poll result If the poll is not successful, it is necessary to refine the mesh (Refine Mesh). Under this circumstance, none of the mesh points get a lower objective function value than at the initial point. For the next iteration, the size of the mesh is reduced to the half and the procedure is repeated until it reaches a Successful poll. The new set of mesh points for the next iteration is at half distance from the initial point. The initial point remains the same.

Figure 16 shows how the new area under study is reduced to the half (blue circumference), the new set of mesh points are over the new area limits, and the initial point remains the same for the next iteration.
Figure 16: GPS algorithm Refine mesh result The procedure continues until the stopping criteria is satisfied, these conditions are:
- The mesh size reaches the Mesh tolerance (10-6). - The number of maximum iterations is reached (100 * number of variables -> 200). - The total number of function evaluations is reached (100 * number of variables -> 200). - The time limitation is reached (set to infinite). These conditions are set by default with the values between brackets, but can be changed. In this experiment, they have been settled to default values. [37] A comparison with other Matlab functions for optimization can be found in the annex 6.4. 3.3.2. Matlab execution The iteration process stops after 36 iterations because the mesh tolerance has been reached. The result obtained in the optimization satisfies all the constraints, being the solution of the optimization algorithm 55.7018¬∫, 13.1952¬∫. Table 11 shows the iteration evolution in the optimization. It can be seen how the objective function value decreases and how the mesh size is doubled when there are Successful poll events. Nevertheless, it can be seen that the mesh size is reduced to the half when there is a Refine mesh event. Initially, the algorithm considers the whole area under study, but after the first Successful poll event it is reduced to the half around the new initial point. The refinements are more accurate as the iterations advance because the mesh size is progressively reduced limiting the area to poll. Thus, the selection of the initial point is influential in the solution as the result of the

optimization is near the initial point. It is confirmed that the central point is 55.70123¬∫, 13.197125¬∫, and it is at 190 m from the solution of the optimization algorithm.

Iteration 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36

f(x) 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 3.13231e+179 5.43941e+170 5.43941e+170 5.43941e+170 5.43941e+170 2.09851e+168 2.09851e+168 2.09851e+168 2.09851e+168 6.89953e+165 6.89953e+165 6.89953e+165 6.89953e+165 6.87273e+163 6.87273e+163 6.87273e+163 6.87273e+163 3.20995e+163 3.20995e+163 3.38149e+161 3.38149e+161 3.38149e+161 4.44822e+160 4.44822e+160 4.44822e+160 4.45181e+159 4.45181e+159 4.45181e+159

Mesh size 1 0.5 0.25 0.125 0.0625 0.03125 0.01563 0.007813 0.003906 0.001953 0.003906 0.001953 0.0009766 0.0004883 0.0009766 0.0004883 0.0002441 0.0001221 0.0002441 0.0001221 6.104e-05 3.052e-05 6.104e-05 3.052e-05 1.526e-05 7.629e-06 1.526e-05 7.629e-06 1.526e-05 7.629e-06 3.815e-06 7.629e-06 3.815e-06 1.907e-06 3.815e-06 1.907e-06 9.537e-07

Method
Refine mesh Refine mesh Refine mesh Refine mesh Refine mesh Refine mesh Refine mesh Refine mesh Refine mesh Successful Poll Refine Mesh Refine Mesh Refine Mesh Successful Poll Refine Mesh Refine Mesh Refine Mesh Successful Poll Refine Mesh Refine Mesh Refine Mesh Successful Poll Refine Mesh Refine Mesh Refine Mesh Successful Poll Refine Mesh Successful Poll Refine Mesh Refine Mesh Successful Poll Refine Mesh Refine Mesh Successful Poll Refine Mesh Refine Mesh

Table 11: Iterations

Table 12 and Table 13 show the amount of worse (red) measurements distributed in the 16 regions.

B1 B2 B3 B4 B5 B6 B7 B8 B9 B10 B11 B12 B13 B14 B15 B16 2115199324 5 8 2 2 9 4
Table 12: Amount of bad measurements in each region
2115

1993

2458

2294

Table 13: Amount of bad measurements in each region
Seeing this distribution, since the red measurements in our dataset are concentrated in the middle and South-Eastern region, a central location for a new access point is reasonable.

Procedure overview
In order to clarify all the necessary steps to find the optimal location, the list below summarizes the process:
- Obtaining the measurements‚Äô data in Excel: location of the measurements, its signal level (RSSI), and its SNR.
- Definition for each measurement: its gateway location (where the gateway is in relation to the connected measurement) and the gateway height, the transmitted power, the path loss exponent (which has been calculated, considering a sub-urban environment), the gateway gain, the measured path loss, the distance to the gateway, and the B estimation.
- R script execution. It selects the interest area where the worse measurements are, it defines the 16 regions, and the BP vector value (vector with the averaged B value in each region).
- Matlab script execution. It deploys the optimization using the script resulting from the R execution and gets the optimal location.

Considerations
In the whole procedure, some assumptions have been taken into account.

- The path loss exponent (n) is obtained from a formula that depends on the terrain type and the height. The terrain type has been estimated to be the one of a sub-urban area, however, it is not possible to get a more accurate value. The new gateway height cannot be determined before knowing the optimization result; the obtained value is valid at the estimated height.
- It is not possible to perfectly measure the environment effect in a channel. The B value has been calculated based on it and it cannot have an accurate result either.
- In order to simplify the procedure, the averaged B value has been considered instead of real measurements. To get an idea of how representative the measurements are in each area, the variance and the standard deviation have been calculated. They are shown in Table 14.

Variance

Standard deviation Standard deviation (dB)

B1 5.724877

2.39

3.78397901

B2 0

0

-

B3 0

0

-

B4 86.894058 9.32

9.69415912

B5 0

0

-

B6 39.297785 6.26

7.96574333

B7 46.241767 6.8

8.32508913

B8 65.375655 8.08

B9 47.714835 6.9

B10 10.59466

3.25

B11 27.596423 5.25

B12 15.012056 3.87

B13 53.052222 7.28

B14 40.967405 6.4

B15 164.733305 12.83

B16 16.570736 4.07

9.07411361 8.38849091 5.11883361 7.20159303 5.87710965 8.62131379 8.06179974 11.0822666 6.09594409

Table 14: B variance and standard deviation
The smaller the standard deviation, the closer these values are to the mean. Hence, it is possible to test how accurate the B value estimation is in each region. If the standard deviation is low, all the values in the area can be approximated to the mean, however, if not, the approximation would be incongruous. [39] The zero values on the variance are because there is only one measurement in that region. As region 15 is the one with the highest standard deviation, this area should be covered by the gateway in Rabyvagen, but its coverage is worse than the others and it leaves this area improperly attended.

Implementation with spreading factor data
measurements
In the previous analysis in this chapter, the spreading factor was fixed to 12, then, the transmitted power was always 14 dBm. Some new measurements have been taken considering the possibility of variable spreading factor. From now on, the new measurements taken in the city considering the spreading factor data are going to be used. The location of the three gateways remains the same.

The device used to take the new measurements is a Field Test Device from Adeunis for LoRaWAN which measures the RSSI, SNR, and spreading factor in a certain location for uplink and downlink. [40] The majority of these measurements have been taken in the interest area. This device is shown in Figure 17.

The minimum RSSI reached has been -121 dBm. The data extraction procedure, the optimization implementation technique, and the minimization function (patternsearch) remain the same.

Figure 17: Field Test Device [40]

Section 3.6.1 shows the optimization results defining the best location to place a new gateway in Lund considering the possibility that the LoRaWAN network applies the Adaptive Data Rate functionality changing the value of the spreading factors when the measurements are taken.

3.6.1. Results
The iteration process stops after 56 iterations because the mesh tolerance has been reached. The result obtained in the optimization satisfies all the constraints, being the solution of the optimization algorithm 55.7021¬∫, 13.1933¬∫. The procedure followed is analogous as in section 3.3.2. The distance from the result of the optimization to the initial point is bigger, 261 m, which explains why it has taken more iterations to converge to a solution. Table 15 and Table 16 show the amount of worse (red) measurements distribution in the 16 regions. B1 B2 B3 B4 B5 B6 B7 B8 B9 B10 B11 B12 B13 B14 B15 B16 - - - 6 3 16 10 7 10 64 37 38 10 2 - -
Table 15: B values in each region ---6 3 16 10 7 10 64 37 38 10 2 - Table 16: B values in each region Figure 18 shows the comparison between the previously calculated optimal location (marked in red) and the new one (marked with a green dot). Both results are around the same area.
Figure 18: Optimal location change

4. EVALUATION
In this chapter, the gateway coverage in two locations is evaluated. The procedure followed is as follows:
- Checking where it is possible to access in the optimal location surroundings - Going to the location - Placing the gateway - Going around the city and taking some measurements
Test 1
In the first trial, the gateway is in M√•rtenstorget at street level over a parking meter machine (55.701513¬∫, 13.195974¬∫). This gateway‚Äôs placement is shown in Figure 19.

Figure 19: Test 1 gateway placement The measurements that have been connected to this gateway are shown in Table 17.

RSSI (dBm) SNR (dB) SF Measurement Latitude (¬∫) Measurement Longitude (¬∫)

-106

-3.5 7

55.7057667

13.2008333

-107

-10.2 10

55.7021667

13.2008333

-106

-2.5 10

55.7014333

13.2006667

-107

-14 12

55.7004167

13.2

-108

-11 12

55.70045

13.2011667

-110

-10.8 8

55.6994833

13.1995

-107

-4.8 12

55.7038667

13.1943333

-108

-8.5 10

55.7042333

13.1945

-105

-5.5 7

55.70545

13.1951667

-106

-7.2 8

55.70835

13.197

Table 17: Test 1 results
Figure 20 shows the location of the measurements from Table 17 in a map. Despite the gateway being placed at ground level, it has reached a latitude of 55.708315¬∫ to the north and

55.699416¬∫ to the south. The measurements taken inside M√•rtenstorget with direct line of sight with the gateway were connected to Kristallen gateway. At ground level, there are more interfering obstacles in the propagation than over a building, and therefore the measurements are the result of interferences, reflections, shadowing and constructive/destructive signals.
Looking at the RSSI values, four of them are not below -106.6 dBm. This means that it has not improved the measurements to higher RSSI values.

Figure 20: Test 1 locations
Table 18 shows the amount of green, yellow and red RSSI values in relation to the spreading factor, the majority of the values are using spreading factor 7.

SF7 GREEN YELLOW
RED

SF8 38 22 71

SF9 1 4 7

SF10

SF11

SF12

1

3

2

3

0

6

3

2

4

10

2

7

Table 18: Relation spreading factor and RSSI values
The worst red values with spreading factor 12 are located in the limiting areas shown in Figure 21.

Figure 21: Red values ‚Äì Spreading factor 12
Table 19 shows the minimum and maximum RSSI values for each spreading factor. It reflects that before reaching -120 dBm, the spreading factor is increased and for spreading factor 12, the measurement is not taken for lower RSSI values.

Minimum RSSI Maximum RSSI

SF7

SF8

SF9

SF10

SF11

SF12

-118

-113

-115

-117

-108

-117

-91

-99

-102

-93

-85

-99

Table 19: Minimum and maximum RSSI values

Placing a gateway at ground level can sometimes provide further coverage than expected but it is not a useful location as it cannot uniformly cover and improve the whole Lund‚Äôs central area.

Test 2
The second test has been developed placing the gateway in the same location (M√•rtenstorget), but at higher height. A drone was used to place the gateway at 25 m because there were no accessible buildings in that square. This procedure took longer due to the limiting factor of the drone batteries duration.

Table 20 shows the distribution of the 71 measurements taken. The results show that the majority of measurements are using SF7 (64.8% of measurements) and only 12 of the connections were not to the new gateway. The furthest point measured has been 340 m away to the south and it had spreading factor 7, which means that it may be possible to cover southern areas increasing in one or two units the spreading factor value. The coverage with spreading factor 7 allows to reduce the power consumed in the network.

green yellow

SF7

SF8

16

1

SF9 0 0

SF10

SF11

SF12

0

0

0

4

0

1

0

0

red

29

4

0

11

2

3

Table 20: Spreading Factor distribution
Comparing the measurements from Table 20 with the ones taken at the same area before adding the gateway, there were only five measurements in the same region: four of them with spreading factor 7, and one with spreading factor 9. Comparing the measurements only with five previous measurements cannot support or validate the algorithm.

In section 4.3, some more measurements have been taken considering different gateway locations and making possible to compare the results of Test 2 with those ones. It will allow to support the validity of the methodology.

New approach: list of locations
While evaluating the results, the biggest issue faced was the accessibility to the optimal location or to somewhere in the surroundings. The proposed solution to this problem is to find the optimal location among a list of possible locations. This list can be as long as desired and it should contain locations that are reachable.

Table 21 shows the created list for Lund.

Location M√•rtenstorget LTH E-huset Sensefarm M√•rtenstorget Damg√•rden parking P-hus Parking

Latitude 55.701513 55.711103 55.716515 55.701513 55.699239 55.700877

Longitude 13.195974 13.210414 13.224933 13.195974 13.199903 13.191446

Height 2
23.5083333 23.5083333
25 20.44 23.5083333

Table 21: List of possible locations in Lund The heights have been estimated using the tool [39].

4.3.1. Methodology
To apply the methodology used in this section over Lund, the steps to follow are:

1. Display the list of locations in an Excel file with the structure:

Location

Latitude

Longitude

Height

2. Create a file with the measured network values with the structure:
eui Latitude Longitude RSSI SNR Time Gateway Gateway Gateway connection height (m)

Gateway latitude

Gateway Gateway Power

Environment (urban,

longitude gain

transmitted sub-urban, rural)

max lat min lat max long min long

eui is an identifier for the measurement (it adds no information to the calculus) and latitude and longitude are the geographical coordinates where the measurement has been taken. RSSI and SNR are signal features and Time is the instant when the measurement was taken (it adds no information to the calculations). Gateway and

Gateway connection are the identifier and the gateway name; Gateway height, latitude, longitude and gain are the data relative to the gateway to which the measurement has been connected. The Power transmitted is the one that the measuring device sends and the Type of environment can be chosen from urban, sub-urban or rural depending on the scenario. Max lat., min lat., max long and min long are the geographical limits of the area that is going to be studied. 3. The R script calculates the optimal location applying the same methodology and algorithms used in chapter 3, for the new gateway among the list of options.
The last script will provide the result telling which the optimal location is among the list. This procedure can be applied over whichever place and not only in Lund. Section 4.3.2 show the optimization results of this procedure.
4.3.2. Results
After applying the methodology from chapter 3, which considers the one slope log-normal and the GPS algorithm, among previous options, the result of the optimization is that the best place to locate the gateway is M√•rtenstorget at 25m, followed by P-hus Parking, LTH E-huset, Sensefarm, Damg√•rden parking , and finally M√•rtenstorget at 2m.
The height is the feature with higher impact to consider when placing a gateway as it provides more visibility. The optimal location is the highest one being also the one obtained at the previous simulations. Among P-hus Parking, LTH E-huset and Sensefarm, P-hus Parking is more centric and closer to the worse recorded measurements, which will provide a better coverage. Then, the second closer to the center is LTH E-huset, and it is the third best option followed by Sensefarm facilities. Damg√•rden parking is not tall which explains why it is not providing better results; despite being nearer to where there is a higher concentration of bad measurements.
4.3.3. Methodology testing
4.3.3.1 M√•rtenstorget at 25 m These results have been shown in section 4.2. The key factor is that 64.8% of the measurements are using spreading factor 7 in the central area of Lund where mostly all the bad measurements are. This location is the best, following the optimization criteria, to place a new gateway. However, as it does not provide enough measurements to validate the methodology, it cannot be chosen as a solution and the second solution, P-hus Parking, from the methodology explained in section 4.3.1 may be considered as the best result.
4.3.3.2 P-hus Parking In Figure 22, the gateway location is shown in red and, in blue are defined the points that are more in the north, south, east and west. The gateway has covered all the city centre and southern areas of Lund which explains why this is the second best option where to place a new gateway in the network.

Figure 22: Map representation of P-hus Parking
From Table 22, the 50.77 % of the measurements use spreading factor 7. The majority of the measurements with spreading factor 12 were taken at S√∂dra Esplanaden, which is the furthest area covered at the south. Some other measurements with spreading factor 12 were taken at the northern covered area because the cathedral has a great shadowing effect.

green yellow red

SF7

SF8

18

1

14

SF9 0 2 2

SF10 0 0 1

SF11 1 2 5

SF12

0

0

0

0

2

17

Table 22: Spreading factor distribution at P-hus Parking
Table 23 shows the results from the measurements without the placement of the P-hus parking gateway. Of the collected measurement, 40% use spreading factor 7. Consequently, there has been an improvement of 10.77% in the use of spreading factor 7. As explained in the references [16] and [18], the use of a lower spreading factor reduces the necessary power to transmit information, and thereby, the overall power consumption is reduced.

green yellow red

SF7

SF8

0

0

36

SF9 0 0 9

SF10

SF11

0

0

0

0

6

17

SF12

0

0

0

0

7

15

Table 23: Initial spreading factor distribution at the P-hus Parking region

4.3.3.3 LTH E-huset In Figure 23, the gateway location is in red. As it is far from the central area of Lund, it cannot fully cover the city center. In blue are shown the measurements obtained more to the west and

south. It covers a wide area considering how far it is located, however, it is not enough, especially because the highest accumulation of worse measurements is located in the southern areas.

Figure 23: Map with the gateway at LTH E-huset Table 24 shows that 40.49% of the total measurements are using spreading factor 7.

green yellow red

SF7

SF8

5

10

34

SF9 0 0 3

SF10

SF11

0

1

1

3

6

17

SF12

0

0

0

2

5

34

Table 24: Spreading factor distribution LTH E-huset
Table 25 shows the results from the measurements without the placement of the LTH E-huset gateway. It shows that 36.67% of the total measurements are using spreading factor 7. There has been an improvement of 2.61% in the number of measurements applying spreading factor 7.

green yellow red

SF7

SF8

SF9

0

0

0

0

33

12

SF10

SF11

0

0

0

0

9

15

SF12

0

0

0

0

6

15

Table 25: Initial spreading factor distribution at the LTH E-huset region

4.3.3.4 Sensefarm The gateway has been placed at the rooftop of Sensefarm‚Äôs facilities (shown in red in Figure 24). The more southern point (shown in blue) is a bit up in the north compared to the interest area, and this gateway does not really cover the city centre, just northern areas. This topology can only cover a portion of the interest area.

Figure 24: Sensefarm map
Table 26 shows the spreading factors‚Äô distribution in the interest area of central and southern Lund. Despite this gateway is placed at the same height as LTH E-huset and P-hus Parking, it is further from the interest area to improve, the results then are not better. In the surroundings of this location, the results can reach spreading factor 7, but this area is not the one to be improved. Here, 39.4 % of the measurements are using spreading factor 7.

green yellow red

SF7

SF8

13

0

2

SF9 2 0 0

SF10

SF11

SF12

1

4

2

2

1

1

0

0

0

1

0

9

Table 26: Spreading factor distribution at Sensefarm facilities
Table 27 shows the results from the measurements without the placement of the Sensefarm gateway. It shows that 38% of the total measurements are using spreading factor 7. There has been an improvement of 1.47% in the number of measurements with spreading factor 7.

green yellow red

SF7

SF8

SF9

SF10

SF11

SF12

0

0

0

0

0

0

0

0

0

0

0

0

80

43

29

41

7

10

Table 27: Initial spreading factor distribution at Sensefarm region

4.3.3.5 Damg√•rden parking In Figure 25, the gateway location is marked in red. The lines in orange and the two blue points are the locations where this gateway uses spreading factor 7. The coverage is limited to the areas with line of sight. The green point shows the furthest point that this gateway covers. This gateway‚Äôs location undercovers the city centre as it barely reaches it.

Figure 25: Damgarden parking coverage
Table 28 shows the spreading factors‚Äô distribution. The great majority of measurements at spreading factor 7 are at line of sight, only the two blue points and the measurements at Arkivgatan do not have line of sight. There is a total of 40.32% of spreading factor 7 measurements.

green yellow red

SF7

SF8

17

3

5

SF9 0 0 5

SF10

SF11

1

0

1

1

3

10

SF12

1

0

1

2

1

11

Table 28: Damgarden parking spreading factor distribution
Table 29 shows the results from the measurements without the placement of the Damgarden parking gateway. 55.77% of the measurements use spreading factor 7. Consequently, there has been a 15.45% improvement in the use of spreading factor 7. Despite the improvement being high, the coverage is worse than the previous gateway locations coverage. It does not consist of the city center, hence this possibility is discarded.

green yellow red

SF7

SF8

0

0

29

SF9 0 0 8

SF10

SF11

SF12

0

0

0

0

0

0

0

0

2

7

1

5

Table 29: Initial spreading factor distribution at Damgarden region

4.3.3.6 M√•rtenstorget at 2 m These results have been shown in section 4.1. The key factor is that the measurements are irregular as there are more interfering elements (buildings, cars, trees, people,etc.) in the line of sight of the antenna‚Äôs gateway. Thus, it is not a trustworthy solution.

5. CONCLUSIONS
This thesis has optimized the gateways‚Äô location in the LoRaWAN network in Lund. LoRaWAN is a LPWAN; hence, one of its main benefits is the low power consumption. The goal of this thesis has been to reduce its power consumption even more.
It has been possible to calculate an optimal location for a new possible gateway location in an existing network. Nevertheless, due to external causes, the accessibility to that exact location has not been attainable. The solution to overcome this issue has been selecting the best location to place that new gateway from a list of possible and accessible locations. Calculating the best location to place a new gateway in a network considering a list of possible locations allows this methodology to be applied over any scenario. It makes this solution a general way to approach the same problem over another network, it can be extrapolated by creating a list of possible locations. Nevertheless, the solution could be conditioned to the initial point set.
Further research could be done by introducing more data visualization, developing a tool to measure how the power consumption varies with the change of the spreading factor, increasing the number of gateways at street level, or testing if another channel model would get a more accurate environment estimation. The already developed code and the further research possibilities could be developed in a free-licensed software as it was suggested when I presented the previous work in the Low Power conference in Malm√∂. The most suitable options would be Python because it is generally integrated with web applications, or R because it provides a great variety of graphical sources. Both are state of art programming languages in statistics, data analysis and databases [41].
An analogous research could be done by analysing the feasibility of deploying the gateways indoor in LoRaWAN networks. Nevertheless, before carrying out the study, one should bear in mind that while indoor gateways provide better coverage, and seem to be cheaper (an outdoor gateway costs between 500 ‚Ç¨ and 1500 ‚Ç¨, whereas an indoor gateway costs between 300 ‚Ç¨ and 500 ‚Ç¨, according to Sensefarm‚Äôs data), they require a higher number of devices in comparison with outdoor gateways. Finding a trade-off between the number of indoor gateways and its price could be a feasible solution. For the concerning analysis, the channel model is different than for outdoor scenarios. According to [3], the most suitable model to use for this study would be the four slopes log-normal model.

6. ANNEXES
Chapter 6 contains additional information that broadens the concepts explained during the thesis.

Related work on channel models
The Lee propagation model has been analysed in order to see if it fits better than the log-normal model as it has been tested over LoRaWAN networks. The Lee model results are valid for urban environments. As Lund is considered a sub-urban area, this model is not an option to feature the channel. [42]

Research in the cities of Oulu (Finland) and Dortmund (Germany) are similar to Lund‚Äôs research. The results obtained from [5] and [6] of these cities at 868 MHz are in Table 30.

Oulu

Dortmund

n

2.32

2.65

B

128.95

132.25

Table 30: Oulu and Dortmund measurements [6]

Lund‚Äôs population is around 89,000 inhabitants [43], Oulu‚Äôs population is 193,902 inhabitants [44], and Dortmund‚Äôs population is 580,000 inhabitants [45]. Considering the population level and as both Lund and Oulu are flat cities, sub-urban areas, and are not far from the sea, the channel model that is going to be more similar to estimate the path losses in Lund is the one from Oulu. Equation 15 shows the path loss expression for Oulu.

Ì†µÌ±ë Ì†µÌ∞∏Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = 128.95 + 10 √ó 2.32 √ó log10(Ì†µÌ±ë0)
Equation 15: Expected path loss at Oulu These last two examples are more closely related to Lund‚Äôs study due to similar environment conditions. However, the majority of studies consider that the expression that models the path losses is Equation 16.

Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = Ì†µÌ±ÉÌ†µÌ∞ø(1Ì†µÌ±ö)(Ì†µÌ±ëÌ†µÌ∞µ) + 10 √ó Ì†µÌ±õ √ó log10(Ì†µÌ±ë(Ì†µÌ±ö)) + Ì†µÌ±ã
Equation 16: Path loss Where X is a zero-mean Gaussian random variable with a certain standard deviation that represents the shadowing effect and the Ì†µÌ±ÉÌ†µÌ∞ø(1Ì†µÌ±ö) value is the path loss at 1m.

Equation 16 differs from Equation 4 on the distance units and on the constant value B. Actually, this is just a different way of expressing the same because B includes the shadowing effect in its value. Equation 17 and 18 show the Oulu and Dortmund values as in Equation 16.

Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = Ì†µÌ±ÉÌ†µÌ∞ø(1Ì†µÌ±ö)(Ì†µÌ±ëÌ†µÌ∞µ) + 10 √ó Ì†µÌ±õ √ó log10(Ì†µÌ±ë(Ì†µÌ±ö)) + Ì†µÌ±ã Ì†µÌ±ë (Ì†µÌ±òÌ†µÌ±ö)
= 128.95 + 10 √ó 2.32 √ó log10 ( Ì†µÌ±ë0 ) ‚Üí Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = 59.35 + 10 √ó 2.32 √ó log10(Ì†µÌ±ë(Ì†µÌ±ö)) + Ì†µÌ±ã

Equation 17: Path loss Oulu
Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = Ì†µÌ±ÉÌ†µÌ∞ø(1Ì†µÌ±ö)(Ì†µÌ±ëÌ†µÌ∞µ) + 10 √ó Ì†µÌ±õ √ó log10(Ì†µÌ±ë(Ì†µÌ±ö)) + Ì†µÌ±ã Ì†µÌ±ë (Ì†µÌ±òÌ†µÌ±ö)
= 132.25 + 10 √ó 2.65 √ó log10 ( Ì†µÌ±ë0 ) ‚Üí Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) = 52.75 + 10 √ó 2.65 √ó log10(Ì†µÌ±ë(Ì†µÌ±ö)) + Ì†µÌ±ã

Equation 18: Path loss Dortmund
Other studies with one slope have been developed in different environment applying Equation 16 and they are shown in Table 31.

Flat open yard and sandy dunes with bushes, 2.4 GHz [46] Ground plain (flat) [47] University yard surrounded by buildings [47] Curved grass park [47] Snowy floor, antenna of 1m and 2.425 GHz [48] Plaza, antenna of 1m and 2.4 GHz [49] Sidewalk, antenna of 1m and 2.4 GHz [49] Grassland, antenna of 1m and 2.4 GHz [49]

Ì†µÌ±ÉÌ†µÌ∞ø(1Ì†µÌ±ö)(Ì†µÌ±ëÌ†µÌ∞µ) 40.15
66.76 42.86 40.36 40.51

n 3.684 3.12 3.57 3.69 1.26 1.86 1.99 1.9

œÉ (dB) 11.5 1.83 3.27 1.42 2.97 3.25 2.45 3.02

Table 31: Path loss values

Equations 19 to 21 show the maximum distance calculation.

Ì†µÌ±ÜÌ†µÌ±íÌ†µÌ±õÌ†µÌ±†Ì†µÌ±ñÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±£Ì†µÌ±ñÌ†µÌ±°Ì†µÌ±¶ ‚â§ Ì†µÌ±áÌ†µÌ±üÌ†µÌ±éÌ†µÌ±õÌ†µÌ±†Ì†µÌ±öÌ†µÌ±ñÌ†µÌ±°Ì†µÌ±°Ì†µÌ±íÌ†µÌ±ë Ì†µÌ±ùÌ†µÌ±úÌ†µÌ±§Ì†µÌ±íÌ†µÌ±ü ‚àí Ì†µÌ±ÉÌ†µÌ±éÌ†µÌ±°‚Ñé Ì†µÌ±ôÌ†µÌ±úÌ†µÌ±†Ì†µÌ±†Ì†µÌ±íÌ†µÌ±†

Equation 19: Sensitivity upper limit Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ) ‚â§ Ì†µÌ±ÉÌ†µÌ±áÌ†µÌ±ã(Ì†µÌ±ëÌ†µÌ∞µÌ†µÌ±ö) ‚àí Ì†µÌ±Ü(Ì†µÌ±ëÌ†µÌ∞µÌ†µÌ±ö) ‚Üê Ì†µÌ±ÄÌ†µÌ±éÌ†µÌ±•Ì†µÌ±ñÌ†µÌ±öÌ†µÌ±¢Ì†µÌ±ö Ì†µÌ±ùÌ†µÌ±éÌ†µÌ±°‚Ñé Ì†µÌ±ôÌ†µÌ±úÌ†µÌ±†Ì†µÌ±†
Equation 20: Path loss upper limit Ì†µÌ±ÄÌ†µÌ±éÌ†µÌ±•Ì†µÌ±ñÌ†µÌ±öÌ†µÌ±¢Ì†µÌ±ö Ì†µÌ±ëÌ†µÌ±ñÌ†µÌ±†Ì†µÌ±°Ì†µÌ±éÌ†µÌ±õÌ†µÌ±êÌ†µÌ±í (Ì†µÌ±òÌ†µÌ±ö) = 10(Ì†µÌ±öÌ†µÌ±éÌ†µÌ±•Ì†µÌ±ÉÌ†µÌ∞ø(Ì†µÌ±ëÌ†µÌ∞µ)‚àíÌ†µÌ∞µ)/(10‚àóÌ†µÌ±õ)

Equation 21: Maximum distance
Where B is 128.95 and n is 2.32 for Oulu. Conversely, if Equation 4 is applied without considering the shadowing effect, the result would be the same, but in meters. Table 32 calculates the maximum communication distance for each spreading factor in Oulu.

SF Bandwidth Coding Bit rate Transmitted

(kHz)

rate (bps) power (dBm)

Sensitivity Maximum

Maximum

(dBm)

path loss (dB) distance (km)

12

125

4/6 244,14

14

-137

151

8,92135938

11

125

4/6 447,59

12

-136

148

6,62400558

10

125

4/5 976,56

10

-134

144

4,45355578

9

125

4/5 1757,81

8

-131

139

2,71137542

8

125

4/5

3125

6

-128

134

1,6507162

7

125

4/5 5468,75

4

-125

129

1,0049748

7

250

4/5 10937,5

2

-122

124

0,61184009

Table 32: Relation SF - bandwidth - coding rate - bit rate - transmitted power - sensitivity maximum path loss - maximum distance

Optimization theory
There are mainly two types of optimization algorithms: deterministic and probabilistic algorithms. In deterministic algorithms, the output has a relation with the input; otherwise, if there is no actual relation between input and output, it is a probabilistic algorithm. [50]
Optimization has been used over networks to improve the congestion as it affects the general network‚Äôs performance, the efficiency, and its delivery time. For these types of applications, genetic algorithms and particle swarm optimization have been used. [50]
To understand these optimization types, firstly, it is going to be described the optimization classification. Optimization algorithms can be classified as:
- Iterative: it repeats the algorithms several times until it reaches the solution. - Stochastic: it follows a probabilistic rule. - Deterministic. - Population based: it works with a set of solutions and it looks for improving them.
The two population based algorithms used the most are: swarm intelligence algorithms and evolutionary algorithms, for example Genetic Algorithms. [51]
Genetic algorithms are search algorithms based on the natural genetics where the strongest population elements are the ones that survive over the others. These algorithms have been created to analyse the natural processes while expressing them through software. [52]
Particle swarm optimization is another optimization technique that adjust each point movement considering previous experiences. [53] It can be applied over continuous nonlinear functions. [54]
As the network under study does not have to optimize the network‚Äôs congestion, population based algorithms are not applied to it, they can be exclusively applied over congestion‚Äôs optimizations.
6.2.1. Graphical optimization In order to optimize the gateway‚Äôs location, as explained in Section 1.6, a number of optimization methods have been considered but none of them was applicable to this scenario: a LPWAN with LoRaWAN technology. In [55], a graphical analysis has been developed for an indoor environment using Building Information Models (BIM) that provides a way to exchange information from buildings and it is shared by The Industry Foundation Classes (IFC). Its way of representing a building is shown in Figure 26. Rendering a map model of a whole city in a software programme would be technically unfeasible, hence this option has been discarded.

Figure 26: Building Information Models software [55]
Mathematical approach to optimization
6.3.1. Optimal points
An optimal point is one where the objective function has a minimum; there are two types of optimal points:
-Global optima: the function value in global optima is below or equal to any other point in the function.
-Local optima: the function value in local optima is below or equal to any other point in a limited region of the function. [26]
6.3.2. Optimization problems classification
Regarding the type of optimization, the problems can be classified as local optimization problems or global optimization problems. The difference is the type of optimal values that are necessary to achieve: local or global.
Regarding the existence of restrictions, the problems can be classified as with or without restrictions.
Regarding the nature of the objective function and the restriction functions, the problems can be classified as linear or not linear.
Regarding the nature of the optimization, the problems can be classified as deterministic when the problem parameters are fixed or as stochastic when the problem parameters are expressed with random variables. [26]
6.3.3. Convex optimization
The convex property can be applied over functions and sets. A set S is convex if for two x and y points of S, there is another point z that is from S too and that satisfies Equation 22.
Ì†µÌ±ß = Ì†µÌªºÌ†µÌ±• + (1 ‚àí Ì†µÌªº)Ì†µÌ±¶ Ì†µÌ±ìÌ†µÌ±úÌ†µÌ±ü 0 ‚â§ Ì†µÌªº ‚â§ 1
Equation 22: convex set

A function is convex when its domain S is a convex set and when, for two points x and y from S, Equation 23 is satisfied.
Ì†µÌ±ì(Ì†µÌªºÌ†µÌ±• + (1 ‚àí Ì†µÌªº)Ì†µÌ±¶) ‚â§ Ì†µÌªºÌ†µÌ±ì(Ì†µÌ±•) + (1 ‚àí Ì†µÌªº)Ì†µÌ±ì(Ì†µÌ±¶) Ì†µÌ±ìÌ†µÌ±úÌ†µÌ±ü 0 ‚â§ Ì†µÌªº ‚â§ 1
Equation 23: convex set condition A convex optimization problem has to have a convex objective function, inequality convex functions, and affine equality constraints. It is useful to consider a problem convex, as there are several optimization methodologies, and algorithms that allow solving these problems. [26]

6.3.4. Lagrangian
Considering the general structure of an optimization problem, there is a way to express all the functions that take part in the optimization (Ì†µÌ±ì(Ì†µÌ±•), Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) and ‚ÑéÌ†µÌ±ò(Ì†µÌ±•) ) in one through the lagrangian expressed in Equation 24.

Ì†µÌ±ö

Ì†µÌ±ù

Ì†µÌ∞ø(Ì†µÌ±•, Œª, Ì†µÌ±£) = Ì†µÌ±ì(Ì†µÌ±•) + ‚àë ŒªÌ†µÌ±óÌ†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) + ‚àë vÌ†µÌ±ò‚ÑéÌ†µÌ±ò(Ì†µÌ±•)

Ì†µÌ±ó=1

Ì†µÌ±ò=1

Equation 24: Lagragian
The values ŒªÌ†µÌ±ó and vÌ†µÌ±ò are the Lagrange multipliers associated to Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) and ‚ÑéÌ†µÌ±ò(Ì†µÌ±•) and Œª and Ì†µÌ±£ are known as dual variables or Lagrange multipliers vectors associated to the optimization problem.

The dual Lagrange function is the minimum value of the Lagrange function in the x variable and it is shown in Equation 25.

Ì†µÌ±ë(Œª, Ì†µÌ±£) = min Ì†µÌ∞ø(Ì†µÌ±•, Œª, Ì†µÌ±£)
Ì†µÌ±•
Equation 25: Dual Lagrange function If Œª ‚â• 0, and Ì†µÌ±ù‚àó is the function value at the optimal point, the following condition is satisfied: Ì†µÌ±ë(Œª, Ì†µÌ±£) ‚â§ Ì†µÌ±ù‚àó

The dual Lagrange function provides an inferior level of the optimal value Ì†µÌ±ù‚àó as a function of Œª and Ì†µÌ±£. [26]

6.3.5. Simple heuristics
The application of a certain simple heuristic depends on the type of optimization problem considered: unconstrained optimization, optimization with equality constraints or optimization with inequality constraints.
6.3.5.1. Unconstrained optimization

6.3.5.1.1. Direct solution
For this heuristic, if the function has a local minimum or maximum at Ì†µÌ±•0 and the function‚Äôs gradient in this point exists, it satisfies: ‚àáÌ†µÌ±ì(Ì†µÌ±•0) = 0. This is a necessary condition and the resulting values of Ì†µÌ±•0 are the stationary points.

A sufficient condition is that Ì†µÌ±•0 is a local minimum or maximum if the hessian of f(x) is positive definite for a strong local minimum and negative definite for a strong local maximum.
To solve an optimization problem using the direct solution, the necessary condition is applied to get the stationary points. Over the stationary points, the sufficient condition is also applied in order to get the local minimums, local maximums, and saddle points (the rest of the stationary points that are not local minimums or maximums).
6.3.5.1.2. Direction search method
This is an iterative process, a design vector is proposed and it is applied to an iterative process until it close enough to the local minimum or maximum. The steps to follow are:
- Selection of the initial vector design: Ì†µÌ±•0. - Selection of the vector that indicates the search direction: Ì†µÌ±ëÌ†µÌ±ñ - Selection of the size of the step for the direction: ŒªÌ†µÌ±ñ. For that, the function Ì†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ + ŒªÌ†µÌ±ñdÌ†µÌ±ñ)
is minimized, it only depends on ŒªÌ†µÌ±ñ. - Update of the design vector: Ì†µÌ±•Ì†µÌ±ñ+1 = Ì†µÌ±•Ì†µÌ±ñ + ŒªÌ†µÌ±ñdÌ†µÌ±ñ - If the convergence condition is satisfied, the design vector is Ì†µÌ±•Ì†µÌ±ñ+1. - If the convergence condition is not satisfied, i=i+1 and the process is repeated.
6.3.5.1.3. Gradient descent method
In this methodology, the search direction is Ì†µÌ±ëÌ†µÌ±ñ = ‚àí‚àáÌ†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ). It is a simple procedure, but the convergence speed is low. The process to follow is similar to the direction search method:
- Selection of the initial vector design: Ì†µÌ±•0. - Calculation of the vector that indicates the search direction: Ì†µÌ±ëÌ†µÌ±ñ = ‚àí‚àáÌ†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ). - Selection of the size of the step for the direction: ŒªÌ†µÌ±ñ. For that, the function Ì†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ + ŒªÌ†µÌ±ñdÌ†µÌ±ñ)
is minimized, it only depends on ŒªÌ†µÌ±ñ. - Update of the design vector: Ì†µÌ±•Ì†µÌ±ñ+1 = Ì†µÌ±•Ì†µÌ±ñ + ŒªÌ†µÌ±ñdÌ†µÌ±ñ - If the convergence condition is satisfied, the design vector is Ì†µÌ±•Ì†µÌ±ñ+1 - If the convergence condition is not satisfied, i=i+1 and the process is repeated.
6.3.5.1.4. Newton method
As it has happened with the gradient descent method, it has the same basis as the direction search method but the search direction is Ì†µÌ±ëÌ†µÌ±ñ = ‚àí[‚àá2Ì†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ)]‚àí1‚àáÌ†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ).
- Selection of the initial vector design: Ì†µÌ±•0. - Calculation of the vector that indicates the search direction: Ì†µÌ±ëÌ†µÌ±ñ = ‚àí[‚àá2Ì†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ)]‚àí1‚àáÌ†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ). - Selection of the size of the step for the direction: ŒªÌ†µÌ±ñ. For that, the function Ì†µÌ±ì(Ì†µÌ±•Ì†µÌ±ñ + ŒªÌ†µÌ±ñdÌ†µÌ±ñ)
is minimized, it only depends on ŒªÌ†µÌ±ñ. - Update of the design vector: Ì†µÌ±•Ì†µÌ±ñ+1 = Ì†µÌ±•Ì†µÌ±ñ + ŒªÌ†µÌ±ñdÌ†µÌ±ñ - If the convergence condition is satisfied, the design vector is Ì†µÌ±•Ì†µÌ±ñ+1 - If the convergence condition is not satisfied, i=i+1 and the process is repeated.
In all of these methods, the convergence condition is satisfied when the sufficient and necessary conditions of the direct solution are satisfied or at least, they are close enough.

6.3.5.2. Optimization with equality constraints These methods are applied when the problem scenario looks like Equation 26.

min Ì†µÌ±ì(Ì†µÌ±•)
Ì†µÌ±•
‚ÑéÌ†µÌ±ò(Ì†µÌ±•) = 0 Ì†µÌ±ò = 1, 2, ‚Ä¶ Ì†µÌ±ù Equation 26: Optimization with equality constraints

6.3.5.2.1. Lagrange multipliers method
In this method, the lagrangian definition is shown in Equation 27.

Ì†µÌ±ù
Ì†µÌ∞ø(Ì†µÌ±•, Œª) = Ì†µÌ±ì(Ì†µÌ±•) + ‚àë ŒªÌ†µÌ±ò‚ÑéÌ†µÌ±ò(Ì†µÌ±•)
Ì†µÌ±ò=1

Equation 27: Lagrange multipliers method
The necessary condition is applied over the lagrangian as if it were an unconstrained problem. Equation 28 is used to get the possible solutions.

Ì†µÌ±ù

Ì†µÌºïÌ†µÌ∞ø(Ì†µÌ±•, Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

Œª)

=

Ì†µÌºïÌ†µÌ±ì(Ì†µÌ±•) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

+

‚àë
Ì†µÌ±ó=1

ŒªÌ†µÌ±ó

Ì†µÌºï‚ÑéÌ†µÌ±ó(Ì†µÌ±•) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

=

0,

Ì†µÌ±ñ

=

1,

2,

‚Ä¶

,

Ì†µÌ±õ

Ì†µÌºïÌ†µÌ∞ø(Ì†µÌ±•, Œª) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ = ‚ÑéÌ†µÌ±ó(Ì†µÌ±•) = 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ù

Equation 28: Equations for Lagrange multipliers method
The sufficient condition is applied over ‚àá2Ì†µÌ∞ø(Ì†µÌ±•‚àó, Œª‚àó). If it is positive definite, the points Ì†µÌ±•‚àó Ì†µÌ±éÌ†µÌ±õÌ†µÌ±ë Œª‚àóare the solution.

6.3.5.3. Optimization with inequality constraints The scenario in this situation is represented in Equation 29.

min Ì†µÌ±ì(Ì†µÌ±•)
Ì†µÌ±•
Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) ‚â§ 0 Ì†µÌ±ó = 1, 2, ‚Ä¶ Ì†µÌ±ö

Equation 29: Optimization with inequality constraints

6.3.5.3.1. Kuhn-Tucker conditions
The main idea for facing these kind of problems consists on transforming the inequality problem in an equality problem and then apply the Lagrange multipliers method. To transform the inequality constraint, an auxiliary variable is added and it is represented in Equation 30.
Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) + Ì†µÌ±¶Ì†µ2Ì±ó = 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö

Equation 30: Kuhn-Tucker conditions The problem to be solved now is expressed in Equation 31.

min Ì†µÌ±ì(Ì†µÌ±•)
Ì†µÌ±•
Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) + Ì†µÌ±¶Ì†µ2Ì±ó = 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö

Equation 31: Kuhn-Tucker problem Equation 32 calculates the lagrangian considering the Equation 31.

Ì†µÌ±ù
Ì†µÌ∞ø(Ì†µÌ±•, Ì†µÌ±¶, Œª) = Ì†µÌ±ì(Ì†µÌ±•) + ‚àë ŒªÌ†µÌ±ò(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) + Ì†µÌ±¶Ì†µ2Ì±ó )
Ì†µÌ±ò=1

Equation 32: Lagrangian solution for Kuhn-Tucker problem The necessary conditions are expressed in Equation 33.

Ì†µÌ±ù

Ì†µÌºïÌ†µÌ∞ø(Ì†µÌ±•, Ì†µÌ±¶, Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

Œª)

=

Ì†µÌºïÌ†µÌ±ì(Ì†µÌ±•) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

+

‚àë
Ì†µÌ±ó=1

ŒªÌ†µÌ±ó

Ì†µÌºïÌ†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

=

0,

Ì†µÌ±ñ

=

1,

2,

‚Ä¶

,

Ì†µÌ±õ

Ì†µÌºïÌ†µÌ∞ø(Ì†µÌ±•, Ì†µÌ±¶, Ì†µÌºïŒªÌ†µÌ±ó

Œª)

=

Ì†µÌ±îÌ†µÌ±ó (Ì†µÌ±•)

+

Ì†µÌ±¶Ì†µ2Ì±ó

=

0,

Ì†µÌ±ó

=

1,

2,

‚Ä¶

,

Ì†µÌ±ö

Ì†µÌºïÌ†µÌ∞ø(Ì†µÌ±•, Ì†µÌ±¶, Œª) Ì†µÌºïyÌ†µÌ±ó = 2ŒªÌ†µÌ±óÌ†µÌ±¶Ì†µÌ±ó = 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö

Equation 33: Kuhn-Tucker conditions Equation 33 can also be expressed as Equation 34.

Ì†µÌ±ù

Ì†µÌºïÌ†µÌ±ì(Ì†µÌ±•) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

+

‚àë
Ì†µÌ±ó=1

ŒªÌ†µÌ±ó

Ì†µÌºïÌ†µÌ±îÌ†µÌ±ó (Ì†µÌ±•) Ì†µÌºïÌ†µÌ±•Ì†µÌ±ñ

=

0,

Ì†µÌ±ñ

=

1,

2,

‚Ä¶

,

Ì†µÌ±õ

ŒªÌ†µÌ±óÌ†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) = 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö

Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) ‚â§ 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö

ŒªÌ†µÌ±ó ‚â• 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö

Equation 34: Kuhn-Tucker conditions
Solving these equations, the possible points for the solution are obtained. If it is a convex optimization problem, these equations‚Äô solutions provide the global minimum. If it is a maximization problem or Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•) ‚â• 0, the equation ŒªÌ†µÌ±ó ‚â• 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö becomes ŒªÌ†µÌ±ó ‚â§ 0, Ì†µÌ±ó = 1, 2, ‚Ä¶ , Ì†µÌ±ö.

6.3.5.3.2. Interior point method
The method adds the restrictions to the objective function; the new objective function can be optimized using whichever unconstrained method. The objective function is modified as:

Ì†µÌ±ö
Œ¶(x, Ì†µÌ±üÌ†µÌ±ò) = Ì†µÌ±ì(Ì†µÌ±•) + Ì†µÌ±üÌ†µÌ±ò ‚àë Ì†µÌ∞∫Ì†µÌ±ó (Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•))
Ì†µÌ±ó=1

Equation 35: Interior point method The most common way to express Ì†µÌ∞∫Ì†µÌ±ó(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)) is as in Equation 36.
1 Ì†µÌ∞∫Ì†µÌ±ó(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)) = ‚àí Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)

Equation 36: Ì†µÌ∞∫Ì†µÌ±ó(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)) definition using the interior point method Equation 37 results from the combination of Equation 35 and Equation 36.

Ì†µÌ±ö 1

Œ¶(x,

Ì†µÌ±üÌ†µÌ±ò)

=

Ì†µÌ±ì(Ì†µÌ±•)

‚àí

Ì†µÌ±üÌ†µÌ±ò

‚àë
Ì†µÌ±ó=1

Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)

Equation 37: Interior point method including Ì†µÌ∞∫Ì†µÌ±ó(Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)) The process follow is:

- Selection of the initial Ì†µÌ±•0 and Ì†µÌ±ü0.

-

Creation

of

the

function

Œ¶(x,

Ì†µÌ±üÌ†µÌ±ò )

=

Ì†µÌ±ì(Ì†µÌ±•)

‚àí

Ì†µÌ±üÌ†µÌ±ò

‚àëÌ†µÌ†µÌ±óÌ±ö=1

1 Ì†µÌ±îÌ†µÌ±ó(Ì†µÌ±•)

- Minimize Œ¶(x, Ì†µÌ±üÌ†µÌ±ò)

- If the convergence condition is satisfied over the solution of minimizing Œ¶(x, Ì†µÌ±üÌ†µÌ±ò), the

iteration is finished.

- If the convergence condition is not satisfied, Ì†µÌ±üÌ†µÌ±ò+1 = Ì†µÌ±êÌ†µÌ±üÌ†µÌ±ò (where c is typically 0.5, 0.2 or

0.1), k=k+1 and the process is repeated. [26]

Comparison with other optimization methodologies used in Matlab
Matlab provides more algorithms than patternsearch. In section 6.4.1 to 6.4.5, other algorithms have been analysed.
6.4.1. fminsearch The function ‚Äòfminsearch‚Äô minimizes unconstrained functions, and therefore, is not applicable in this case. [56] It has been tested what the result of using fminsearch would be to find the optimal position. After 159 iterations, the procedure has been automatically stopped before it finishes because the maximum number of function evaluations has been exceeded, which means that the obtained value is not an optimal one (55.7013¬∫, 13.1952¬∫). The algorithm used in this type of optimization is Nelder-Mead simplex direct search.
6.4.2. fseminf ‚Äòfseminf‚Äô is focused on semi-infinitely constraints. [57]
min Ì†µÌ±ì(Ì†µÌ±•)
Ì†µÌ±•

Ì†µÌ±†Ì†µÌ±¢Ì†µÌ±ê‚Ñé Ì†µÌ±°‚ÑéÌ†µÌ±éÌ†µÌ±° Ì†µÌ∞æ(Ì†µÌ±•, Ì†µÌ±§) ‚â§ 0 Ì†µÌ±ìÌ†µÌ±úÌ†µÌ±ü Ì†µÌ±éÌ†µÌ±ôÌ†µÌ±ô Ì†µÌ±§, Ì†µÌ±ê(Ì†µÌ±•) ‚â§ 0, Ì†µÌ±êÌ†µÌ±íÌ†µÌ±û(Ì†µÌ±•) = 0, Ì†µÌ∞¥Ì†µÌ±• ‚â§ Ì†µÌ±è, Ì†µÌ∞¥Ì†µÌ±íÌ†µÌ±û ‚àó Ì†µÌ±• = Ì†µÌ±èÌ†µÌ±íÌ†µÌ±û, Ì†µÌ±ôÌ†µÌ±è ‚â§ Ì†µÌ±• ‚â§ Ì†µÌ±¢Ì†µÌ±è
Equation 38: fseminf optimization problem formulation It results in failure when trying to test this methodology because there is no semi-constraints in the problems treated in this thesis.
6.4.3. fsolve This function solves non-linear equations applying levenberg marquardt algorithm. [58] When it has been tested with the objective function, it has not found a solution for it. It has only reached a non-minimum solution with 12 iterations, 55.7012¬∫, 13.1958¬∫. It can be seen that the minimum value obtained from the optimization function is 1.43002*1079,which is higher than with other methodologies.
6.4.4. fmincon This function is used for constrained optimizations considering the interior point optimization method. As the other methodologies, it does not allow to consider a large measurements‚Äô number. [59]

Table 33 shows all the techniques used and their results considering 40 measurements to compare the results.

Function fmincon fminsearch
fsolve patternsearch

Latitude 55.7012¬∫ 55.7013¬∫
55.7012¬∫ 55.7018¬∫

Longitude 13.1971¬∫ 13.1952¬∫
13.1958¬∫ 13.1952¬∫

Function value 1.775713*1098 2.24755*1022
1.43002*1079 9.5173*1079

Observations Higher function value. It cannot consider all the measurements at the same time. It only minimizes unconstrained problems. The maximum number of function evaluations has been exceeded: the solution is not a global optimum. Not a real optimum. Higher function value.

Table 33: Comparison between optimization techniques

6.4.5. Kuhn-Tucker equations
Previously, two methods for constrained optimization have been explained: Kuhn-Tucker and Interior Point. The second method is used in ‚Äòfmincon‚Äô, but if Kuhn-Tucker is to be deployed, the equations have to be manually programmed to implement this procedure. Due to their complexity, this alternative has been discarded.

7. REFERENCES
[1] LoRa Alliance, https://www.lora-alliance.org/technology. [2] US National Library of Medicine, National Institutes of Health, https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5038744/.
[3] A. Hrovat, T. Javornik. ‚ÄúRadio Channel Models for Wireless Sensor Networks in Smart City Applications‚Äù, the 2013 International Conference on Electronics, Signal Processing and Communication Systems, 2003. [4] CVX Research, http://cvxr.com/cvx/.
[5] J. Pet√§j√§j√§rvi, K. Mikhaylov, A. Roivainen, T. H√§nninen, M. Pettissalo. ‚ÄúOn the Coverage of LPWANs: Range Evaluation and Channel Attenuation Model for LoRa Technology‚Äù, 14th International Conference on ITS Telecommunications (ITST), December 2015. [6] P. J√∂rke, S. B√∂cker, F. Liedmann, C. Wietfeld. ‚ÄúUrban Channel Models for Smart City IoTNetworks Based on Empirical Measurements of LoRa-links at 433 and 868MHz‚Äù. [7] A. Cenedese, F. Zanella. ‚ÄúChannel Model Identification in Wireless Sensor Networks Using a Fully Distributed Quantized Consensus Algorithm‚Äù. [8] A. Mart√≠nez-Sala, J.M. Molina-Garc√≠a-Pardo, E. Egea-L√≥pez, J. Vales-Alonso, L. Juan-Llacer, J. Garc√≠a-Haro. ‚ÄúAn Accurate Radio Channel Model for Wireless Sensor Networks Simulation‚Äù, JOURNAL OF COMMUNICATIONS AND NETWORKS, VOL. 7, NO. 4, DECEMBER 2005.
[9] Link labs, https://www.link-labs.com/blog/nb-iot-vs-lora-vs-sigfox.
[10] S. Ibrahim, J.H. Cui, R. Ammar. ‚ÄúEfficient Surface Gateway Deployment for Underwater Sensor Networks‚Äù, IEEE Synopsium on Computers and Communications, September 2008.
[11] J. L. Wong, R. Jafari, M. Potkonjak. ‚ÄúGateway Placement for Latency and Energy Efficient Data Aggregation‚Äù, 29th Annual IEEE International Conference on Local Computer Networks, December 2004.
[12] B. Aoun, R. Boutaba, Y. Iraqi, G. Kenward. ‚ÄúGateway Placement Optimization in Wireless Mesh Networks with QoS Constraints‚Äù, IEEE Journal on Selected Areas in Communications, vol. 24, No. 11, November 2006.
[13] F. Li, Y. Wang, X.Y. Li. ‚ÄúGateway Placement for Throughput Optimization in Wireless Mesh Networks‚Äù, IEEE International Conference on Communications, June 2007.
[14] A. Capone, M. Cesana, D. De Donno, and I. Filippini, ‚ÄúOptimal Placement of Multiple Interconnected Gateways in Heterogeneous Wireless Sensor Networks,‚Äù NETWORKING 2009, Lecture Notes in Computer Science (LNCS), vol. 5550, pp. 442-455, 2009.
[15] W. Youssef, M. Younis. ‚ÄúIntelligent Gateways Placement for Reduced Data Latency in Wireless Sensor Networks‚Äù, IEEE International Conference on Communications, June 2007.
[16] LoRa Alliance Technical Marketing Workgroup. (2015). LoRaWAN What is it? A technical overview of LoRa and LoRaWAN.
[17] The things network, https://www.thethingsnetwork.org/wiki/LoRaWAN/Home.

[18] F. Adelantado, X. Vilajosana, P. Tuset-Peiro, B. Martinez, J. Meli√†-Segu√≠, T. Watteyne. ‚ÄúUnderstanding the limits of LoRaWAN‚Äù, IEEE Communications Magazine, January 2017.

[19] Semtech, https://www.semtech.com/technology/lora/lora-applications.

[20] D. Bankov, E. Khorov, A. Lyakhov. ‚ÄúOn the Limits of LoRaWAN Channel Access‚Äù, 2016 International Conference on Engineering and Telecommunication, November 2016.

[21] LoRa Alliance. LoRaWAN 101 A Technical Introduction. (https://docs.wixstatic.com/ugd/eccc1a_20fe760334f84a9788c5b11820281bd0.pdf).

[22] LoRa Alliance. (2017). LoRaWAN‚Ñ¢ 1.1 Regional Parameters.

[23] J. de Carvalho Silva, J. Rodrigues, A. Alberti, P. Solic, A. Aquino. ‚ÄúLoRaWAN - A Low Power WAN Protocol for Internet of Things: a Review and Opportunities‚Äù, 2017 2nd International Multidisciplinary Conference on Computer and Energy Science (SpliTech), July 2017.

[24] zTrack, http://ztrackmap.com/2017/03/16/can-determine-battery-lifetime-lorawandevices/.

[25] Semtech, https://www.semtech.com/technology/lora/what-is-lora.

[26] Boyd, S., Vandenberghe, L., ‚ÄúConvex Optimization‚Äù, Cambridge University Press, 2004.

[27] Kerlink, https://www.kerlink.com/product/wirnet-station/.

[28] Movable type, https://www.movable-type.co.uk/scripts/latlong.html.

[29] J. Lamberts, ‚ÄúLecture 17‚Äù, Math USM, Fall Semester 2009-2010, http://www.math.usm.edu/lambers/mat169/fall09/lecture17.pdf.

[30] Wikipedia, https://en.wikipedia.org/wiki/Decimal_degrees.

[31] W. Afric, B. Zovko-Cihlar, S. Grgic. ‚ÄúMethodology of Path Loss Calculation using Measurement Results‚Äù, 2007 ad 6th EURASIP Conference focused on Speech and Image Processing Multimedia Communications and Services, June 2007.

[32]

CTBUH,

http://www.ctbuh.org/TallBuildings/HeightStatistics/HeightCalculator/OnLineCalculator/tabid/

1068/language/en-GB/Default.aspx.

[33] https://sv.wikipedia.org/wiki/Kyrkobyggnader_och_vattentorn_i_Lunds_kommun.

[34] M. Torlak, ‚ÄúPath Loss‚Äù, Telecom. Switching & Transmission, The University of Texas at Dallas.

[35] Math works, https://se.mathworks.com/help/gads/patternsearch.html.

[36]

Council

on

Tall

Buildings

and

Urban

Habitat,

http://www.ctbuh.org/TallBuildings/HeightStatistics/HeightCalculator/OnLineCalculator/tabid/

1068/language/en-GB/Default.aspx

[37] Quora, https://www.quora.com/What-is-the-meaning-of-mesh-size-in-pattern-search-inMatlab.
[38] Math works, https://se.mathworks.com/help/gads/how-pattern-search-pollingworks.html.
[39] Science buddies, https://www.sciencebuddies.org/science-fair-projects/sciencefair/variance-and-standard-deviation
[40] Adeunis, https://www.adeunis.com/en/produit/ftd-868-915-2/.
[41] N. Zumel, J. Mount. ‚ÄúPractical Data Science with R‚Äù, Manning, 2014.
[42] D. Dobrilovic, M. Malic, D. Malic, S. Sladojevic. ‚ÄúAnalyses and optimization of Lee propagation model for LoRa 868 MHz network deployments in urban areas‚Äù, Journal of Engineering Management and Competitiveness, Vol. 7, No. 1, 2017.
[43] Wikipedia, https://en.wikipedia.org/wiki/Lund.
[44] Wikipedia, https://es.wikipedia.org/wiki/Oulu.
[45] Wikipedia, https://es.wikipedia.org/wiki/Dortmund.
[46] E. Greenberg, A. Sheinberg. ‚ÄúStatistical channel model for wireless sensor networks deployment in suburban environment‚Äù, 2015 9th European Conference on Antennas and Propagation (EuCAP), April 2015.
[47] J.M. Molina-Garcia-Pardo, A. Martinez-Sala, M.V. Bueno-Delgado, E. Egea-Lopez, L. JuanLlacer, J. Garc√≠a-Haro. ‚ÄúChannel Model at 868 MHz for Wireless Sensor Networks in Outdoor Scenarios‚Äù, Journal of Communications and Networks, December 2005.
[48] M. Cheffena, M. Mohamed. ‚ÄúEmpirical Path Loss Models for Wireless Sensor Network Deployment in Snowy Environments‚Äù, IEEE Antennas and Wireless Propagation Letters, September 2017.
[49] D. Wang, L. Song, X. Kong, Z. Zhang. ‚ÄúNear-Ground Path Loss Measurements and Modeling for Wireless Sensor Networks at 2.4 GHz‚Äù, International Journal of Distributed Sensor Networks, June 2012.
[50] K. K. Sharma, I. Kaur. ‚ÄúImplementation of Genetic Algorithm for Optimization of Network Route‚Äù.
[51] D. Karaboga, B. Basturk. ‚ÄúA powerful and efficient algorithm for numerical function optimization: artificial bee colony (ABC) algorithm‚Äù. 2007.
[52] D. E. Goldberg. ‚ÄúGenetic Algorithms in Search, Optimization, and Machine Learning‚Äù, Reading MA: Addison-Wesley, 1989.
[53] R. C. Eberhart, Y. Shi. ‚ÄúComparison between Genetic Algorithms and Particle Swarm Optimization‚Äù.

[54] J. Kennedy, R. Eberhart. ‚ÄúParticle Swarm Optimization‚Äù. [55] A. Guinard, A. McGibney, D. Pesch. ‚ÄúA wireless sensor network design tool to support building energy management‚Äù. November 2009. [56] Math works, https://se.mathworks.com/help/matlab/ref/fminsearch.html. [57] Math works, https://se.mathworks.com/help/optim/ug/fseminf.html. [58] Math works, https://se.mathworks.com/help/optim/ug/fsolve.html. [59] Math works, https://se.mathworks.com/help/optim/ug/fmincon.html.

64

