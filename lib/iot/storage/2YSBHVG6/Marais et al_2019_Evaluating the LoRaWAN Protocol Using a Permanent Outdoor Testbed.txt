This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

1

Evaluating the LoRaWAN Protocol Using a Permanent Outdoor Testbed
Jaco Morne¬¥ Marais, Student Member, IEEE, Reza Malekian, Senior Member, IEEE, and Adnan M. Abu-Mahfouz, Senior Member, IEEE

Abstract‚ÄîLow Power Wide Area Network (LPWAN) protocols such as Long Range Wide Area Network (LoRaWAN) are key to ensuring scalable wireless communication for Internet of Things (IoT) devices. In this paper, an analysis of this protocol through a performance evaluation of a permanent outdoor LoRaWAN tested is presented. To ensure accurate results, tests lasted at least 17 hours and required 1000 packets per node. The evaluation focused on the impact that the Adaptive Data Rate (ADR) scheme, payload length, link checks and acknowledgements had on the packet delivery ratio (PDR) of the testbed. The collected data showed that enabling the ADR scheme reduced the PDR. The ADR scheme had six data rates, which consist of a spreading factor (SF) and bandwidth (BW) combination, to choose from. Analysis revealed that the scheme primarily assigning either the fastest data rate (SF7BW250) or the slowest (SF12BW125) to nodes, regardless of distance. Furthermore, the scheme‚Äôs assignments show signs of oscillation, with nodes being instructed to abruptly change between SFs. The impact of payload length and link checks on the PDR was not pronounced but enabling acknowledgements did show signiÔ¨Åcant improvements.
Index Terms‚ÄîIoT, LPWAN, long range (LoRa), LoRa wide area network (LoRaWAN).
I. INTRODUCTION
T HE Internet of Things (IoT) aims to improve several aspects of society through the deployment of low-cost and always-connected devices. By deploying these devices, many sectors can operate at higher efÔ¨Åciency levels whilst saving costs [1].
The large scale deployment of IoT devices requires new wireless technologies which can support them. As a result, several Low Power Wide Area Network (LPWAN) technologies have been developed with competitors battling it out for market share [2]. Long Range Wide Area Network (LoRaWAN) is one of these technologies and is the focus of this paper.
Our previous literature review (J. Marais et al. in [3]), revealed that existing empirical LoRaWAN performance evaluations were mainly performed over short time periods and with only a few nodes. Additionally, communication was only evaluated over short distances in urban areas and long distance evaluations were mainly performed in rural environments. A research gap, therefore, existed for the evaluation of this technology over long and short distances and over long time periods in an urban environment.
The authors are with the Department of Electrical, Electronic and Computer Engineering, University of Pretoria, Pretoria, 0002, South Africa (e-mail: u11024063@tuks.co.za; reza.malekian@ieee.org; a.abumahfouz@ieee.org).
Adnan M. Abu-Mahfouz is also with Modelling and Digital Science, Council for ScientiÔ¨Åc and Industrial Research, Pretoria 0184, South Africa

In this paper, we present the results of a performance evaluation performed using an outdoor permanent testbed consisting of 18 Long Range (LoRa) devices spread over a large distance, thereby forming a more realistic LoRaWAN. Experiments consisted of tests and each test was conducted until each node had sent 1000 packets, one every 60 seconds, to ensure sufÔ¨Åcient data for the evaluation. Each test in an experiment, therefore, represents at least 17 hours worth of captured data. The objective of this evaluation was to determine how the Adaptive Data Rate (ADR) scheme and several other LoRaWAN parameters impact the performance of a LoRaWAN. The main Ô¨Åndings are that the ADR scheme negatively impacted the PDR and did not make use of all available data rates, and that payload length and link checks, unlike Acknowledgements (ACKs), did not have a pronounced effect on the Packet Delivery Ratio (PDR).
The rest of this paper is organised as follows. Section II provides background on the LoRaWAN protocol and Section III presents the related works. Our approach is described in Section IV, with the results presented in Section V. A discussion on the Ô¨Åndings can be found in Section VI. Finally, the conclusion is presented in Section VII.
II. BACKGROUND
In a LoRaWAN, LoRa serves as the physical layer and was developed by Semtech and remains proprietary. The LoRaWAN standard is open and is under active development by commercial and industrial partners [4].
LoRa uses Chirp Spread Spectrum (CSS) modulation and Forward Error Correction (FEC) to mitigate interference [5]. A key conÔ¨Åguration parameter is the Spreading Factor (SF), which is the ratio between the symbol rate and chip rate [6], [7]. The choice of spreading factor between SF6 up to SF12 provides a trade-off between range and throughput. Increasing the spreading factor increases the number of chips per symbol, which reduces the SNR required for successful demodulation, but increases a transmission‚Äôs duration. Lower spreading factors increase the data transmission rate, allowing for more data to be transmitted before the ISM band‚Äôs duty cycle limits are reached [5], [8].
The LoRaWAN standard uses LoRa as a base and adds additional features required by LPWAN technologies [9]. LoRaWAN‚Äôs ADR scheme aims to maximise battery life and throughput by adjusting the data rate and RF output for every device in a LoRaWAN [10]. This has an additional beneÔ¨Åt of increasing network capacity, as messages sent with different

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

2

SFs are orthogonal and can thus be received simultaneously. The ADR scheme was developed for static nodes (Ô¨Åxed locations) and for environments in which the radio channel attenuation remains stable [10].
The ADR scheme uses the LinkADRReq MAC command to request a node to perform an adjustment. A node will answer using the LinkADRAns command to indicate if it accepted or rejected the new settings [10]. The ADR scheme contains an ACK system designed to allow nodes to periodically conÔ¨Årm that the network received their uplink packets. A node will proceed with attempting to regain connectivity by switching to lower and lower data rates if an ACK is not received [10].
Up to now, there has been no mention of how the ADR scheme determines the contents of the LinkADRReq commands it sends to each node. The LoRaWAN speciÔ¨Åcation does not specify how ADR should be implemented, instead, it is left to the Network Manager (NM). In the testbed‚Äôs case, a Multitech gateway is used and thus Multitech‚Äôs NM is responsible for the assignments. A superior ADR algorithm can be a competitive advantage and, as a result, vendors keep their implementations private [11]. The Things Network, a global collaborative network, uses an open source NM whose ADR algorithm is publicly available [12]. This implementation uses SNR values from the most recent 20 uplinks and will send an adjustment request if a Ô¨Åxed threshold is exceeded [11]. Multitech‚Äôs implementation differs and is described as follows: ‚ÄúThe network server samples the SNR from each packet and computes a possible datarate based on each sample. Six packets must be received by the network server before it will adjust the datarate of a device. Samples for the last 11 packets are maintained and when LinkADRAns is sent, the max datarate that has met a threshold of packets will be sent for the device to change to‚Äù [13]. Additional information and the threshold value is not supplied.

of nodes per SF and aims to increase the number of devices using low SFs in order to maximise the network‚Äôs throughput.
In [18], the inÔ¨Çuence of variation in payload length was tested and a deÔ¨Ånite PDR improvement was observed, which was however not consistent over the range of data rates evaluated. The payload length experiments conducted in [14] found similar inconsistencies, with similar PDRs for 10 and 100 bytes but a decrease for 50 bytes.
Performance evaluations in urban, suburban and rural environments resulted in coverage of around 6 km in urban and suburban areas with over 18 km in the rural scenario [18]. The urban evaluation, which enabled ACKs, showed a PDR of 100 % for DR0 to DR5 for distances below 3 km, although over how many packets this was calculated was not speciÔ¨Åed. Even at distances between 5 km and 6 km, a 100 % PDR achieved when DR0 was used, however, other data rates resulted in lower PDRs of between 30 % and 50 %.
Tests on ACK requests by nodes in an evaluation of a three gateway LoRaWAN, found that in 2.5 % of cases the data arrived but the device did not receive an ACK which could result in unnecessary retries [24].
To investigate the impact of downlink trafÔ¨Åc in which ACKs materially inÔ¨Çuence performance, the popular LoRaSim simulator was extended into LoRaWANSim [25]. Evaluation of the effects of increased network size showed that a gateway will reach its duty cycle limits when attempting to transmit all of the required ACKs. The use of ACKs has a major impact on performance in large networks and greatly reduce their capacity [25].
Tests on a single gateway network found that ACKs only improved the PDR for a low number of devices (100, 500 and 1000) and only when data was sent every sixty thousand seconds [8].

III. RELATED WORK
Performance evaluations of the LoRaWAN protocol frequently consist of a network with a single gateway and one or two nodes with which measurements are taken at several identiÔ¨Åed points [3], [14], [15], [16]. These provide valuable insights but can produce results impacted by device speciÔ¨Åc characteristics. Experiments on nodes in motion showed that at speeds higher than 40 km/h, the communication performance worsens due to the Doppler effect [17], [18].
Extensive research regarding the ADR scheme has resulted in additions and modiÔ¨Åcations targeting network performance metrics such as scalability [19], throughput [20], PDR [21], and contention [22]. As an example, congestion estimation is achieved through evaluation of network throughput, RSSI and the number of connections at a gateway before nodes are sent LinkADRReq messages [19]. Fair Adaptive Data Rate (FADR) uses Received Signal Strength Indicator (RSSI) values in its calculations when determining SF and Transmit Power (Tx) assignments [23]. In [11], additions such as adjusting data rates before incrementing Tx, the averaging of SNR history and accounting for hysteresis is recommended. A contentionaware ADR approach, proposed by [22], tracks the number

IV. APPROACH
By deploying nodes at Ô¨Åxed distances, one can provide insights into the impact of range on performance, without requiring that node(s) be constantly relocated. Additionally, permanently deploying multiple nodes allows for continuous simultaneous data collection.
A. Design and layout
The testbed consists of 18 nodes and 1 gateway and operates in the 868 MHz band. Each node consists of a Multitech mDot, a solar panel, a Lithium Polymer battery and a 3.0 dBi antenna. Firmware, using mdot-library version 3.0.0, was developed to allow experiments to be remotely conÔ¨Ågured. The gateway is a Multitech MultiConnect Conduit running version 3.3.9 of mLinux, an open source embedded Linux distribution, and uses Multitech‚Äôs network server version 1.0.36-r1.0. Firmware executing on the mDots communicates with the gateway which in turn relays packets to a web server. On the web server, the packets are Ô¨Årst processed by a Node-RED application before being stored in an InÔ¨ÇuxDB database. The Node-RED application also provides a dashboard to control the testbed. Collected data was viewed and monitored with a Grafana

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

3

Fig. 1. Example of a node deployed at the CSIR.

TABLE I BASELINE NODE CONFIGURATION DEFINED.

Item AC0 LC45
TX11 AN3 AD1 WT60 PS5 DR0

Purpose Requesting packet acknowledgements are disabled Link connectivity is checked every 4 packets and
5 checks must fail Transmission power is set to 11 dBm
Antenna gain is set to 3 dBm ADR is enabled
waiting time between packets is 60 seconds application payload length is 5 bytes data rate is set to DR0 (a SF of 12)

Fig. 2. Map displaying location of nodes.
dashboard running on the web server. The developed node on its own and deployed outside is shown in Fig. 1.
The testbed is geographically spread over 3 locations. The majority (13) of the nodes are dispersed over the Pretoria campus of the Council for ScientiÔ¨Åc and Industrial Research (CSIR). Two nodes are located nearly 2 km away at a residence and three nodes were placed on rooftops approximately 5 km away at the University of Pretoria (UP). Two nodes are located inside whilst the rest are outside. Fig. 2 shows node locations.
The nodes were grouped into three groups based on distance. The ‚ÄúNear‚Äù group consists of the 6 closest nodes, all within 0.5 km of the gateway. The ‚ÄúFar‚Äù group consists of the next 7 nodes with distances between 0.54 km and 1.25 km. Finally, the ‚ÄúFurthest‚Äù group consists of 5 nodes with distances from 1.98 km to 5.19 km.
B. Experimental methodology
The testbed, and by extension the protocol, can be evaluated using several performance metrics. While scalability and energy consumption are important metrics, PDR was chosen as the evaluation metric, as the main function of a sensor network would be the relay of sensor data.
Each experiment required several tests and these were conducted until every node had sent 1000 packets, and nodes were conÔ¨Ågured to send one packet every 60 seconds. Therefore, the minimum duration of an test was ‚âà 17 hours and an experiment required several of these tests. In practice, tests took slightly longer as nodes would occasionally disconnect from the network, and their packets would only be recorded again upon successful reconnection.
1) Baseline conÔ¨Åguration: A performance baseline is required, with which experiments that modiÔ¨Åed parameters could

be compared with. A baseline node conÔ¨Åguration, serving as the default settings, was developed. The baseline node conÔ¨Åguration consists of several items and their purpose is described in Table I. Note that, if the ADR scheme is enabled, the data rate set with the ‚ÄúDR‚Äù element will be ignored as the ADR scheme is in control.
With this baseline node conÔ¨Åguration, a set of experiments was executed in which each experiment changed one conÔ¨Åguration element from this baseline. Each experiment had its own dataset which contained the data of several tests, each stored in a measurement, which is an InÔ¨ÇuxDB data structure. A naming convention was followed and thus each measurement‚Äôs name reÔ¨Çects what test was conducted. Measurements starting with ‚ÄúPS‚Äù refers to payload lengths, ‚ÄúACK‚Äù refers to acknowledgements, ‚ÄúLC‚Äù refers to link checks and ‚ÄúWT‚Äù refers to waiting time. A measurement, named ‚ÄùBaseline‚Äù, in which each node sent 1000 packets, using the baseline conÔ¨Åguration, was created to serve as a performance baseline for comparison.
V. RESULTS
Several experiments and an exploration of node RSSI and SNR values were performed with the testbed. Experiments to determine the impact of the ADR scheme, payload length, link checks and acknowledgements on the PDR were performed. As detailed in Section IV-B, the meta-data of 1000 sent packets per node was used, with the exception of Fig. 3, 4, 5 and 8 in which the meta-data of received packets were used.
A. RSSI and SNR
To better understand the radio environment, an exploration of captured RSSI and SNR values were performed. Fig. 3 and 4 shows box-and-whisker plots for captured RSSI and SNR values from the Baseline measurement. Each group‚Äôs coloured box is drawn using the lower, middle and upper quartiles with the lower and upper whiskers showing the values outside the interquartile range (IQR). The lowest recorded RSSI and SNR value were respectively -125 dBm and -19.2 dB, with the best values being -78 dBm and 12.8 dB. The big difference between the best and worst conditions in which packets were successfully received showcases LoRa‚Äôs high sensitivity and suitability for long range communication.

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

4

 

566,G%P



 
1HDU

)DU

)XUWKHVW

*URXS

Fig. 3. Captured RSSI values for 1000 received packets per node.

615G%

      
1HDU

)DU

)XUWKHVW

*URXS

Fig. 4. Captured SNR values for 1000 received packets per node.

3'5

    
1HDU

$'5'LVDEOHG $'5(QDEOHG
)DU )XUWKHVW
*URXS

Fig. 5. The PDR per group when ADR is enabled versus all nodes using SF12.

3DFNHWVVHQWQRUPDOLVHG

     
1HDU

)DU )XUWKHVW *URXS

6)XVHG 6)%: 6)%: 6) 6)

Fig. 6. Spreading factors chosen by the ADR scheme.

Fig. 3 shows the impact of distance on the received signal; the upper, middle and lower quartile values all decrease from one group to the next. The long whiskers of all the box plots show the wide spread of recorded values outside the IQR. The Far group‚Äôs boxplot shows a much smaller IQR then the others, but the length of its whiskers show that, while 50 % of recorded values were densely grouped, there were still values recorded over a much wider RSSI range. There is a large overlap between the whisker ranges of the groups, and nearly any recorded RSSI value could belong to any of the groups, making determining a node‚Äôs group based on RSSI highly inaccurate.
Similar to Fig. 3, the SNR boxplots shown in Fig. 4 have a constant decrease in all quartiles values between one group to the next. The Near group IQR indicates that at least 50 % of the packets were recorded with a positive SNR with this group‚Äôs whisker showing that some values were recorded far below 0 dB. The Furthest group‚Äôs box plot shows the wide range of values captured for this group and that more than half of packets received had a negative SNR. As with the RSSI values, determining a node‚Äôs group based on SNR values would be highly inaccurate.
B. ADR scheme
LoRaWAN‚Äôs adaptive data rate feature aims to optimise the data rates and Tx used by individual nodes by allowing the network to control these through MAC commands [10]. In Fig. 5, 1000 received packets from every node are used to show the impact of enabling ADR versus all nodes using SF12. The Ô¨Ågure shows that the averaged PDR for each group is consistently worse when ADR is enabled, with the Furthest

group showing the biggest difference. The PDR drops by 3.6, 8.6 and 12.5 percentage points respectively for the Near, Far and Furthest groups.
Fig. 6 shows a percent stacked barchart of which spreading factors were assigned by the ADR scheme to the nodes in each group. All three groups have a signiÔ¨Åcant percentage of the SF7BW250 conÔ¨Åguration, with the Furthest group having the largest variation in assigned conÔ¨Ågurations. The Near and Far groups only had SF7BW250 and SF12 assigned to their nodes. The Furthest group had a small percentage of SF7BW125 and SF8 conÔ¨Ågurations. In this group, the two dominant conÔ¨Ågurations (SF7BW250 or SF12) were approximately equally assigned.
The non-assignment of spreading factors 9, 10 and 11 and the strong preference for either SF7BW250 or SF12 seems unusual. Fig. 7 shows how node e5-42 (part of the Furthest group) varies between SF7, SF8 and SF12. It should be noted that Grafana‚Äôs graph does not distinguish between SF7BW250 and SF7BW125 and plots both as a SF of 7. The graph shows that the ADR scheme did not gradually choose lower and lower spreading factors, but instead the assignment abruptly changes between the three options. Table II, which was created using 1000 data points per node, shows that this dramatic change occurs for all nodes in the Furthest group, and how drastically the difference in the assignment of either SF7BW250, SF12 or SF8 are between these nodes. Particularly, eb-99 has a 60/40 split between SF7BW250 and SF12 whilst e5-42 (170 m away, and with a lower SNR) heavily favours SF12 with almost no packets sent using SF7BW250. With these long distance nodes, SF12 was likely a good choice to help deal with interference and signal strength loss.
This measurement‚Äôs data shows that the ADR scheme

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

5

TABLE III SF ASSIGNMENT BY THE ADR SCHEME FOR LESS UTILISED SFS.

SF
SF7BW125 SF9 SF10 SF11

Found in how many measurements 15 11 3 2

Highest assignment (%)
8.43 2.28 1.29 0.98

Fig. 7. Spreading factors used by e5-42.

TABLE II SFS ASSIGNED TO THE FURTHEST GROUP.

Node SF7BW250 SF7BW125 SF8 SF12 Distance (km)

e5-40

596

23

0 381

1.98

eb-97

50

70

0 880

1.98

e5-4a

981

0

0

19

4.90

eb-99

595

0

0 405

5.02

e5-42

6

45

119 830

5.19

3HUFHQWDJHRISDFNHWVHQW %DV$$$/////333333333::HO&&&L&&&&&77666666666Q...H



6)XVHG



6) 6)



6)

6)%:



6)%:



6) 6)

0HDVXUHPHQW
Fig. 8. SFs used in a selection of 20 measurements (meta-data of 574 packets per node).

prefers certain SFs over others, so the question was asked if the ADR continues to act consistently in its pattern of choices over multiple measurements? Fig. 8, created with the meta-data of 574 packets per node, shows that the choices are consistent in terms of the previous pattern of SF and BW assignments. There is variation in the ratio between the SF7 and SF12, but it is fairly small.
Table III details in how many of the measurements used in Fig. 8 the ADR scheme selected less utilised SFs. Only in ACK3 did the ADR use all of the available SFs, with SF11 being the least used, that is, 0.98 % of the received packets. Whilst all spreading factors were used in multiple measurements, their assignment percentages were very small. The experiment examining the enablement of acknowledgements is represented in measurements ACK1 to ACK3. The results for ACK1 and ACK2 follow the overall trend. In the AKC3 measurement, three acknowledgement attempts are allowed before the node stops transmission of a packet. It is uncertain why ACK3 is the only measurement showcasing a larger selection of SF assignments. Environmental conditions may be a potential cause, but a comparison between the RSSI and SNR data for the testbed shows no signiÔ¨Åcant change in the RSSI and SNR values when this test was performed.
The ADR scheme can modify a node‚Äôs data rate and transmit

power. Whilst the testbed‚Äôs software was able to record the data rate choices of the scheme, the transmit power with which each packet was sent was not recorded. The transmit power is not part of a packet‚Äôs meta-data provided by the gateway and would require that the node monitor its own transmit power and transmit any changes as part of the application payload. Due to time constraints on the project, this was not performed.
C. Impact of payload length on PDR
The LoRaWAN protocol has maximum application payload length limits and these depend on the SF/BW combination used and whether MAC commands are to be transmitted with the payload [26]. The protocol allows for up to 15 bytes of MAC commands to be sent, which will reduce the allowable length of the application payload. The maximum payload lengths, with no MAC commands, are either 51, 115 or 242 bytes depending on the SF/BW combination used [26]. As a result, not all of the testbed‚Äôs nodes can participate in tests of lengths longer than 51 bytes due to their SF/BW combinations.
Several tests have been completed in which the application payload length was varied between 5 bytes to 50 bytes in 5 byte increments, and 100, 150, 200 and 241 bytes were tested as well. All 18 nodes were used in the tests ranging from 5 to 50 bytes, while a selection of 9 nodes was used in the tests above 50 bytes. The selection was based on the SF/BW combination assigned by the ADR scheme and consists of nodes close to the gateway. The other 9 nodes were set to send payload lengths of 50 bytes, but were not monitored, and the tests stopped once the chosen 9 nodes each sent 1000 packets.
Fig. 9 shows the impact of various application payload lengths on the PDR, with the Baseline measurement representing 5 bytes. For all three groups, the inÔ¨Çuence of payload length on the PDR is not pronounced. The graph does show that the Furthest group has a consistently lower PDR than the other groups, due to the impact of distance and the ADR scheme‚Äôs choices for these nodes. Whilst the Near and Far group‚Äôs PDR did improve noticeably during PS200 and PS241, the PDR was only calculated over the subset of 9 nodes participating in these tests and is thus not a reÔ¨Çection on the entire Near and Far group‚Äôs performance.
D. Impact of link check on PDR
To ensure scalability, the LoRaWAN nodes are normally set to minimise the use of ACKs. Nodes can, however, perform periodic network link checks to conÔ¨Årm that they are still connected to a LoRaWAN. The node requests a link check and a gateway will respond indicating that the node is still

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

6

3'5

*URXS





1HDU )DU



*URXS



)XUWKHVW

3'5

1HDU



)DU )XUWKHVW



 

%DV33HOL66QH 3366 3366 3366 3366 3366 36

/& /& %DVHOLQH /&

0HDVXUHPHQW

Fig. 9. PDR over several application payload lengths (Baseline serves as PS5).
connected [10]. The mDot allows this to be automated. The user application must specify how often these checks should be performed, for example, every third packet, and the number of link check failures that must occur before the network connection is considered to be lost.
The impact of link checks was investigated by changing both the link check interval and the number of failed checks before the node is considered disconnected. The Baseline measurement used the default values of checking every 4 packets and considered the node disconnected if 5 of these checks failed. The check interval changed as follows: every single packet, every third packet, and every Ô¨Åfth packet. The data for these tests were saved in ‚ÄúLC15‚Äù, ‚ÄúLC35‚Äù and ‚ÄúLC55‚Äù.
The check threshold was kept constant at the value used in the Baseline. In addition, the inÔ¨Çuence of setting the number of checks for failure to 3, 5 and 9 was investigated, with the checking interval kept constant at every Ô¨Åfth packet. The data for these tests were saved in ‚ÄúLC53‚Äù, ‚ÄúLC55‚Äù and ‚ÄúLC59‚Äù.
Fig. 10 and 11 shows the impact of changing either the checking interval or the threshold on the PDR. In Fig. 10, the PDR stays fairly stable for the Near group, with the other groups showing larger deviations from their Baseline performance. In Fig. 11, the PDR again stays similar for the Near group, and the Far group showed a 10 percentage points drop, which was the largest deviation. The Furthest group showed a slightly smaller deviation.

0HDVXUHPHQW
Fig. 10. PDR for various link check interval options.

*URXS



1HDU )DU

)XUWKHVW



3'5





%DVHOLQH /& /& /&

0HDVXUHPHQW
Fig. 11. PDR for various link check threshold options.

3'5


*URXS



1HDU

)DU



)XUWKHVW



'LVDEOHG    1XPEHURIUHWULHV

E. Impact of Acknowledgements on PDR
Fig. 12 shows the PDR improvements achieved when ACKs were enabled. The zero option for the number of retries allows the node to request an ACK, but if it is not received, the packet is not automatically retransmitted and the send functions indicate failure. The user application running on the mDot can then decide to resend the application payload or not to resend the payload. The PDR improved for all three groups, with the Furthest group showing the biggest improvement. This group‚Äôs PDR increased by almost 30 percentage points for 2 retries when compared to disabling ACKs. The improvement in PDR comes at a cost: the gateway must transmit an ACK for every incoming packet and during this time it is unable to

Fig. 12. PDR for several acknowledgement options.
receive packets. A packet may also be received but the node did not receive the gateway‚Äôs ACK, causing it to retransmit unnecessarily. The testbed is a small scale experiment relative to the actual use scenario of a LoRaWAN gateway which will likely support thousands of devices. This high load of nodes makes enabling ACKs difÔ¨Åcult in practice. The amount of time it takes for all nodes in a group to send 1000 packets increases when the number of retries is increased. For the Near group, the number of retries had little effect on the time duration of the tests, whilst for the Furthest group, a large impact on test duration was observed.

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

7

VI. DISCUSSION
Whilst the data showed a reduction in PDR when ADR is enabled, it remains a useful feature. When ADR is disabled and long range nodes are incorrectly set up with a high data rate, which is not designed for long range, a situation occurs in which a node can join the network but cannot effectively communicate. The joining procedure will adjust the SF used during the joining process [10], but once the node is joined, it will revert back to the user deÔ¨Åned SF. With this high data rate, it experiences very high packet loss and will attempt to rejoin the network. This cycle repeats with the node being able to join the network but not being able to reliably send data.
The algorithm used by The Things Network was studied in detail in [11]. One addition proposed to this publicly available algorithm is to add a component to help combat hysteresis. It was noted that when the link margin estimate is marginal between two assignment decisions oscillations can occur as ADR requests are repeatedly sent instructing the node between different conÔ¨Ågurations. This oscillation was observed in the testbed; Fig. 7 shows how node e5-42 abruptly varies between SF7, SF8 and SF12. Their identiÔ¨Åed weakness appears to be also present in Multitech‚Äôs implementation of ADR.
In addition to the ADR scheme, the performance impact of the following LoRaWAN parameters was also investigated: payload length, link checks and ACKs. The effect of payload length and link checks on the PDR was not very pronounced. Enabling ACKs did improve the PDR for all three groups but has some caveats around scalability.
The payload length experiment showed no signiÔ¨Åcant PDR changes between different payload lengths. Increasing the payload length would increase a node‚Äôs transmission time, which can be reduced by using a faster data rate. When the impact of two payload lengths was evaluated in [18], a deÔ¨Ånite PDR improvement was observed. This improvement was, however, not consistent over the range of data rates evaluated and the payload lengths experiments conducted in [14] noted similar PDRs for 10 and 100 bytes but a decrease for 50 bytes. The increased transmission time of longer payloads increases the chances of collisions, which also have a higher chance of occurring in networks with large numbers of nodes.
The LoRaWAN protocol allows nodes to validate their connectivity using link check commands. Several values for the frequency and how many must fail were tested and showed no signiÔ¨Åcant changes in PDR. There is a trade-off between immediately identifying connection issues and being too strict with the disconnectivity threshold value. Too strict criteria would cause nearly any packet loss to be identiÔ¨Åed as connectivity loss. There is a possibility that the link check requests to the gateway or its response are not successfully received by their intended recipient, causing additional timeconsuming reconnection attempts. The reconnection procedure takes a lot of time and energy, not only reducing the time available to sent packets but also wasting energy.
ACKs were the last LoRaWAN parameter examined and it did show that a small network, such as the testbed, can improve node PDRs using ACKs. To ensure scalability, nodes normally send all uplinks without requiring that the network

acknowledge reception (unconÔ¨Årmed). ACKs can, however, be requested (conÔ¨Årmed uplinks). The mDot library supplied by Multitech allows the number of retries if an ACK was not received to be set, and increasing this improved the PDR. Power consumption would have increased as nodes increased retransmission attempts. This improvement matches the simulation results presented in [8], and conÔ¨Årms the researcher‚Äôs comment that this improvement will be present in small networks which send data infrequently.
A LoRaWAN gateway can receive multiple transmissions simultaneously (if on different SFs) but can only transmit on one channel at a time and cannot receive any transmission whilst doing so. Thus, acknowledgement requests will negatively impact the PDR of the network as a whole if the gateway must frequently enter transmission mode while serving a large number of nodes. Transmitting an ACK to one node would cause the gateway to miss transmissions from other nodes, resulting in a runaway scenario in which retransmission attempts skyrocket.
The performance evaluation presented here are not without limitations. For example, the payload length experiment presented in Section V-C could not use data from all 18 nodes for payload lengths bigger than 50 bytes. The testbed consisted of only 18 nodes, and thus the PDR improvement of enabling acknowledgements was seen without the downside of enabling acknowledgements. The research evaluated performance by calculating the PDR for uplink trafÔ¨Åc (packets sent from the nodes to the gateway). However, a LoRaWAN will also have downlink trafÔ¨Åc in the form of acknowledgements, Ô¨Årmware updates and the gateway sending MAC commands to nodes. The testbed will exhibit link asymmetry (a difference in connectivity between the uplink and downlink), the results are thus indicative of uplink trafÔ¨Åc and not downlink trafÔ¨Åc.
VII. CONCLUSION
This work set out to examine LoRaWANs through a performance evaluation of a LoRaWAN outdoor urban testbed. Long term experiments consisting of several tests, in which each test lasted at least 17 hours, were performed to ensure that each test‚Äôs criteria of 1000 data points per node can be met. When the ADR scheme was evaluated, it was found that enabling the scheme had a negative impact on the PDR. The ADR scheme aims to optimise throughput and, in the case of the testbed, dominantly assigned either SF12 or SF7BW250. Node PDRs decreased as a result, since there is a trade off between throughput and range with long range nodes being the most affected. When the data was further examined, an oscillating behaviour was found in which nodes rapidly switched between SF7, SF8 and SF12.
Experiments found that the impact of payload length and link checks on the PDR to be insigniÔ¨Åcant. Enabling ACKs did show a signiÔ¨Åcant improvement in the PDR but this was a result of the small size of the testbed (18 nodes) as congestion was not an issue. For future work, the PDR for downlink trafÔ¨Åc can be examined as well as other performance metrics such as energy consumption. Additionally, the performed work revealed that the PDR impact of the ADR scheme is an important area in which further research would be beneÔ¨Åcial.

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

This article has been accepted for publication in a future issue of this journal, but has not been fully edited. Content may change prior to final publication. Citation information: DOI 10.1109/JSEN.2019.2900735, IEEE Sensors Journal

JOURNAL OF LATEX CLASS FILES, VOL. 14, NO. 8, AUGUST 2015

8

ACKNOWLEDGMENT
The authors thank Mla Vilakazi from the CSIR for his help.
REFERENCES
[1] R. Sanchez-Iborra and M.-D. Cano, ‚ÄúState of the Art in LP-WAN Solutions for Industrial IoT Services,‚Äù Sensors, vol. 16, no. 5, 2016.
[2] O. C. Khutsoane, A. M. Abu-Mahfouz, and B. Isong, ‚ÄúIoT Devices and Applications based on LoRa/LoRaWAN,‚Äù in IECON 2017- 43rd Annual Conf. of the IEEE Industrial Electronics Society, Beijing, China, November 2017, pp. 6107‚Äì6112.
[3] J. M. Marais, R. Malekian, and A. M. Abu-Mahfouz, ‚ÄúLoRa and LoRaWAN Testbeds : a Review,‚Äù in 2017 IEEE AFRICON, Cape Town, South Africa, 2017, pp. 1544‚Äì1549.
[4] U. Raza, P. Kulkarni, and M. Sooriyabandara, ‚ÄúLow Power Wide Area Networks: An Overview,‚Äù IEEE Communications Surveys and Tutorials, vol. 19, no. 2, pp. 855‚Äì873, 2017.
[5] M. Bor, J. Vidler, and U. Roedig, ‚ÄúLoRa for the Internet of Things,‚Äù in Proceedings of the 2016 International Conference on Embedded Wireless Systems and Networks, Graz, Austria, February 2016, pp. 361‚Äì 366.
[6] M. Bor and U. Roedig, ‚ÄúLoRa transmission parameter selection,‚Äù in Proceedings - 2017 13th International Conference on Distributed Computing in Sensor Systems, DCOSS 2017, Ottawa, ON, Canada, 2018, pp. 27‚Äì34.
[7] A. Po¬®tsch, F. Haslhofer, P. Albert, and F. Haslhofer, ‚ÄúPractical Limitations for Deployment of LoRa Gateways,‚Äù in 2017 IEEE International Workshop on Measurement and Networking (M&N), Naples, Italy, 2017, pp. 1‚Äì6.
[8] F. Van Den Abeele, J. Haxhibeqiri, I. Moerman, and J. Hoebeke, ‚ÄúScalability Analysis of Large-Scale LoRaWAN Networks in ns-3,‚Äù IEEE Internet of Things Journal, vol. 4, no. 6, pp. 2186‚Äì2198, 2017.
[9] J. Kim and J. Song, ‚ÄúA Secure Device-To-Device Link Establishment Scheme for LoRaWAN,‚Äù IEEE Sensors Journal, vol. 18, no. 5, pp. 2153‚Äì 2160, 2018.
[10] LoRa Alliance, ‚ÄúLoRaWAN SpeciÔ¨Åcation V1.1,‚Äù pp. 1‚Äì101, October 2017.
[11] V. Hauser and T. Hegr, ‚ÄúProposal of Adaptive Data Rate Algorithm for LoRaWAN-Based Infrastructure,‚Äù in 2017 IEEE 5th International Conference on Future Internet of Things and Cloud (FiCloud), Prague, Czech Republic, 2017, pp. 85‚Äì90.
[12] The Things Network. ‚ÄùLoRaWAN Adaptive Data Rate‚Äù. [Online]. Available: https://www.thethingsnetwork.org/docs/lorawan/adr.html. [Accessed 04 October 2018].
[13] Multi-Tech Systems Inc. ‚ÄùIntroduction to LoRa‚Äù. [Online]. Available: http://www.multitech.net/developer/software/lora/introduction-to-lora/. [Accessed 04 October 2018].
[14] M. Aref and A. Sikora, ‚ÄúFree space range measurements with Semtech LoRaTM technology,‚Äù in 2014 2nd International Symposium on Wireless Systems within the Conferences on Intelligent Data Acquisition and Advanced Computing Systems, IDAACS-SWS 2014, Offenburg, Germany, September 2014, pp. 19‚Äì23.
[15] J. Peta¬®ja¬®ja¬®rvi, K. Mikhaylov, A. Roivainen, T. Ha¬®nninen, and M. Pettissalo, ‚ÄúOn the coverage of LPWANs: Range evaluation and channel attenuation model for LoRa technology,‚Äù in 2015 14th International Conference on ITS Telecommunications, ITST 2015, Copenhagen, Denmark, December 2016, pp. 55‚Äì59.
[16] A. Augustin, J. Yi, T. Clausen, and W. Townsley, ‚ÄúA Study of LoRa: Long Range & Low Power Networks for the Internet of Things,‚Äù Sensors, vol. 16, no. 9, 2016.
[17] J. Peta¬®ja¬®ja¬®rvi, K. Mikhaylov, M. Pettissalo, J. Janhunen, and J. Iinatti, ‚ÄúPerformance of a low-power wide-area network based on LoRa technology: Doppler robustness, scalability, and coverage,‚Äù International Journal of Distributed Sensor Networks, vol. 13, no. 3, pp. 1‚Äì16, 2017.
[18] R. Sanchez-Iborra, J. Sanchez-Gomez, J. Ballesta-VinÀúas, M.-D. Cano, and A. Skarmeta, ‚ÄúPerformance evaluation of LoRa considering scenario conditions,‚Äù Sensors, vol. 18, no. 3, 2018.
[19] D.-Y. Kim, S. Kim, H. Hassan, and J. H. Park, ‚ÄúAdaptive data rate control in low power wide area networks for long range IoT services,‚Äù Journal of Computational Science, vol. 22, pp. 171‚Äì178, 2017.
[20] F. Cuomo, M. Campo, A. Caponi, G. Bianchi, G. Rossini, and P. Pisani, ‚ÄúEXPLoRa: Extending the performance of LoRa by suitable spreading factor allocations,‚Äù in IEEE 13th International Conference on Wireless and Mobile Computing, Networking and Communications, Rome, Italy, 2017.

[21] B. Reynders, W. Meert, and S. Pollin, ‚ÄúPower and Spreading Factor Control in Low Power Wide Area Networks,‚Äù in Communications (ICC), 2017 IEEE International Conference on, Paris, France, 2017, pp. 1‚Äì5.
[22] S. Kim and Y. Yoo, ‚ÄúContention-Aware Adaptive Data Rate for Throughput Optimization in LoRaWAN,‚Äù Sensors, vol. 18, no. 6, 2018.
[23] K. Q. Abdelfadeel, V. Cionca, and D. Pesch, ‚ÄúPoster: A Fair Adaptive Data Rate Algorithm for LoRaWAN,‚Äù in Proceedings of the 2018 International Conference on Embedded Wireless Systems and Networks, Madrid, Spain, 2018, pp. 169‚Äì170.
[24] A. Wixted, P. Kinnaird, A. Tait, A. Ahmadinia, and N. Strachan, ‚ÄúEvaluation of LoRa and LoRaWAN for Wireless Sensor Networks,‚Äù in 2016 IEEE SENSORS, October 2016, pp. 1‚Äì3.
[25] A. I. Pop, U. Raza, P. Kulkarni, and M. Sooriyabandara, ‚ÄúDoes Bidirectional TrafÔ¨Åc Do More Harm Than Good in LoRaWAN Based LPWA Networks?‚Äù in GLOBECOM 2017 - 2017 IEEE Global Communications Conference, Singapore, Singapore, 2017, pp. 1‚Äì6.
[26] LoRa Alliance, ‚ÄúLoRaWAN 1.0.2 Regional Parameters,‚Äù 2017.
Jaco Morne¬¥ Marais received his BEng from the University of Pretoria in 2015 and is currently completing his MEng at the University of Pretoria. His research interests include IoT use cases, low power wide area networks and embedded systems.
Reza Malekian is currently an Associate Professor and the Head of the Advanced Sensor Network Research Group, Department of Electrical, Electronic, and Computer Engineering, University of Pretoria, Pretoria, South Africa. His current research interests include advanced sensor networks, Internet of Things, and mobile communication. He is the JointChapter Chair of the IEEE Signal Processing and Communications Societies, South Africa Section. He is also a Chartered Engineer and a Professional Member of the British Computer Society. He is an Associate Editor of IEEE INTERNET OF THINGS JOURNAL and IEEE TRANSACTIONS ON INTELLIGENT TRANSPORTATION SYSTEMS.
Adnan M. Abu-Mahfouz (M12SM17) received the M.Eng. and Ph.D. degrees in computer engineering from the University of Pretoria. He is currently a Principal Researcher with the Council for ScientiÔ¨Åc and Industrial Research, Research and Innovation Associate, Tshwane University of Technology, and also an extraordinary Faculty Member with the University of Pretoria. He participated in the formulation of many large and multidisciplinary R&D successful proposals (as a Principal Investigator or main author/contributor). His research interests are wireless sensor and actuator network, low power wide area networks, software deÔ¨Åned wireless sensor network, cognitive radio, network security, network management, and sensor/actuator node development. He is a member of many IEEE Technical Communities. He is an Associate Editor at the IEEE Access, the IEEE Internet of Things, and the IEEE Transactions on Industrial Informatics. He is the Founder of the Smart Networks collaboration initiative that aims to develop efÔ¨Åcient and secure networks for the future smart systems, such as smart cities, smart grid, and smart water grid.

1558-1748 (c) 2018 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission. See http://www.ieee.org/publications_standards/publications/rights/index.html for more information.

