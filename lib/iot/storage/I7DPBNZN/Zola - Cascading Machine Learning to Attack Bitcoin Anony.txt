2019 IEEE International Conference on Blockchain (Blockchain)

Cascading Machine Learning to Attack Bitcoin Anonymity
Francesco Zola‚àó, Maria Eguimendia‚àó, Jan Lukas Bruse‚àó, Raul Orduna Urrutia‚àó ‚àó Dept. Data Intelligence for Energy and Industrial Processes, Vicomtech Paseo Mikeletegi 57, 20009 Donostia/San Sebastian, Spain {fzola, meguimendia, jbruse, rorduna}@vicomtech.org

Abstract‚Äî Bitcoin is a decentralized, pseudonymous cryptocurrency that is one of the most used digital assets to date. Its unregulated nature and inherent anonymity of users have led to a dramatic increase in its use for illicit activities. This calls for the development of novel methods capable of characterizing different entities in the Bitcoin network.
In this paper, a method to attack Bitcoin anonymity is presented, leveraging a novel cascading machine learning approach that requires only a few features directly extracted from Bitcoin blockchain data. Cascading, used to enrich entities information with data from previous classiÔ¨Åcations, led to considerably improved multi-class classiÔ¨Åcation performance with excellent values of Precision close to 1.0 for each considered class. Final models were implemented and compared using different machine learning models and showed signiÔ¨Åcantly higher accuracy compared to their baseline implementation. Our approach can contribute to the development of effective tools for Bitcoin entity characterization, which may assist in uncovering illegal activities.
Index Terms‚Äî Bitcoin analysis, Bitcoin anonymity, cascading classiÔ¨Åers, entities classiÔ¨Åcation, graph model, blockchain
I. INTRODUCTION
Bitcoin was born in 2009 and since then its value and popularity has been rapidly increasing until its current state, in which it is the most used, assessed and priced cryptocurrency of all. Bitcoin is a pure peer-to-peer cryptocurrency [25] where all transactions are stored in a public shared ledger called blockchain that cannot be manipulated or changed [6]. Bitcoin is decentralized, which means that it is not controlled by any Ô¨Ånancial institution but it is regulated by everyone in the Bitcoin network: its blockchain architecture maintains the system without ambiguity [26].
While transactions within the Bitcoin network are openly available, Bitcoin user identity is non-transparent and protected by anonymity. This circumstance, combined with the unregulated nature of the Bitcoin market, has brought a lot of new actors to the Bitcoin network using cryptocurrency for illicit operations. Approximately one-quarter of Bitcoin users and half of all Bitcoin transactions are associated with illegal activity [9], accounting for an annual amount of around $72 billion (report 2018).
Conventional law-enforcement strategies tackling illegal Ô¨Ånancial operations such as money laundering or transactions funding criminal operations are typically based on complete knowledge of each actor‚Äôs identity, while details about Ô¨Ånancial transactions are controlled by banks and thus unknown [24]. Within the Bitcoin network, these circumstances are

reversed - incomplete knowledge of identities restricts traceability and transparency of operations, in turn promoting further increase of illegal activities. This calls for novel methods to attack anonymity within the Bitcoin network, aiming to uncover Bitcoin entity categories.
Among the most active categories of entities is the exchange, which represents a digital marketplace where traders can buy and sell cryptocurrencies using different Ô¨Åat (money made legal tender by a government decree) or other digital currencies. Exchanges thus constitute the ‚Äùfront and exit doors‚Äù to the cryptocurrency world and are ideal to hide illicit operations, as documented in [22]. Another category is the darknet market. These markets are e-commerce platforms where users can Ô¨Ånd drugs, weapons and any kind of goods or services that are illegal in most countries. These cryptomarkets use electronic currencies to facilitate licit and illicit transactions among their users [5]. Further, so-called mixers represent services that allow users to obscure operations, as presented in [23]. At the same time mixed transactions increase the privacy of the users, and they can be used for money laundering of illegal funds.
Being able to classify anonymous Bitcoin entities according to such categories would increase transparency and would facilitate linking blockchain information with real actors to uncover illegal activities. Current techniques attacking anonymity often try to cluster addresses and apply heuristic assumptions combined with labelled data from external sources like markets, forums or social media in order to determine address owners in the real world [20]. However, gathering external data and combining them with Bitcoin information is tedious and could be limited due to privacy restrictions. This motivates the implementation of a model able to characterize different behaviours in the Bitcoin network by analyzing the pure blockchain information only by extracting transactions and by recognizing patterns using machine learning approaches.
In this paper, we present a novel approach to decrease Bitcoin anonymity based on a cascading machine learning model, using entity, address and motifs data as inputs. We apply a ‚Äùcascade‚Äù of classiÔ¨Åers, performing a Ô¨Årst entity classiÔ¨Åcation based on address, 1 motif and 2 motif data, which is then used as input for a second classiÔ¨Åcation step, which combines those classiÔ¨Åcation results with entity information from the blockchain. Notably, our approach only requires a few features that can be directly extracted from Bitcoin blockchain data.

978-1-7281-4693-5/19/$31.00 ¬©2019 IEEE

10

DOI 10.1109/Blockchain.2019.00011

In order to compare beneÔ¨Åts and limits of the proposed approach, two experiments are presented: Ô¨Årstly, a simple classiÔ¨Åer is trained based on pure entity information gathered from the blockchain. In the second experiment, a Ô¨Ånal classiÔ¨Åer is trained using the enriched data set generated by our cascading approach. We aimed to detect six different types of Bitcoin entity behaviours. Overall, three classiÔ¨Åer models are tested and compared: Adaboost, Random Forest and Gradient Boosting.
The rest of the paper is organized as follows. Section II describes the related work. After that, Section III presents the graph model used and Section IV shows an overview of the used data sets. Section V describes the implemented machine learning models and Section VI presents the obtained results. Finally, in Section VII, we draw conclusions and provide guidelines for future work.
II. RELATED WORK
User anonymity has probably been the key factor for the success of cryptocurrencies and has promoted illegal activities within the Bitcoin network. Yet, several studies determine that current measures adopted by the Bitcoin protocol are not sufÔ¨Åcient to protect the privacy of its users [19], [1], opening up possibilities to attack Bitcoin anonymity. One of the Ô¨Årst transaction analysis is documented in [30] where typical behavior of Bitcoin users are detected based on how they spend cryptocurrencies, how they keep the balance in their accounts, and how they move Bitcoins between their various accounts. Herrera-Joancomart¬¥ƒ± [12] presents a review on Bitcoin anonymity, concluding that anonymity can be reduced by address clustering or by gathering information from various peer-to-peer networks. This technique is also advocated in [15], where conservative constraints (patterns) are applied for address clustering, and in [17] where information gathered from online forums is used to characterize the CryptoLocker, a family of ransomware. Similarly, in [8], information scraped from online forums and social media is determinant to simulate an attacker and to summarize activity of both known and unknown Bitcoin users. In [3], a generic method to deanonymize a signiÔ¨Åcant fraction of Bitcoin users by correlating their pseudonyms with public IP addresses is described. Reid et al. [29] demonstrates how it is possible to associate many public-keys with each other, using a map of the topological network and external identifying information in order to investigate a large theft of Bitcoins.
Several recent studies have exploited machine learning algorithms for Bitcoin analysis. In [13], an unsupervised learning model is presented with the aim to identify atypical transactions related to money laundering. Monamo et al. [21] introduce a k-means classiÔ¨Åer for object clustering and fraudulent activity detection in Bitcoin transactions. Another study on detection of anomalous behavior, suspicious users and transactions is presented in [27], where three unsupervised learning methods are applied to two graphs generated by the Bitcoin transaction network. Further, a supervised machine learning algorithm is used by [11] to uncover Bitcoin

anonymity using a method for predicting the type of yetunidentiÔ¨Åed entities. In [2], data mining techniques are used to implement and train a classiÔ¨Åer to identify Ponzi schemes in the Bitcoin blockchain and in [18] a Bayesian optimized recurrent neural network (RNN) and a Long Short Term Memory (LSTM) are implemented to predict the direction of Bitcoin price in USD.
Recently, an interesting approach is given in [28], where the concept of motifs is introduced to blockchain analysis. Authors performed an analysis of the transaction directed hypergraph in order to identify several distinct statistical properties of exchange addresses. They were able to predict if an address is owned by an exchange with > 80% accuracy. The introduction of hypergraphs (or dirhypergraphs) proved beneÔ¨Åcial due to their signiÔ¨Åcant advantages over a complex graph structure typically derived from Bitcoin networks. In [14], the motif concept is further developed and is combined with multiple features (entity, address, temporal, centrality) to obtain a comprehensive entity classiÔ¨Åcation into Ô¨Åve categories: Exchange, Service, Gambling, Mining Pool and DarkNet marketplace. Using a total of 315 features, a global accuracy of 0.92 could be achieved.
Inspired by the good classiÔ¨Åcation results presented in [14], we present here a novel machine-learning-based approach to attack Bitcoin anonymity, making use of motifs as introduced by Ranshous et al. and allowing for multi-class classiÔ¨Åcation of Bitcoin entities as in [14], yet aiming to provide a straightforward methodology that relies on fewer, well-deÔ¨Åned features. To achieve this, we introduce a novel cascading machine learning model for Bitcoin data analysis. The main idea is to implement a cascade of classiÔ¨Åers, so that outgoing classiÔ¨Åcation results can be joined and can be used to enrich a Ô¨Ånal classiÔ¨Åcation.
III. GRAPH MODEL
A. Blockchain Graph Model
Bitcoin transactions have a natural graph structure, with a fundamental example being the address-transaction graph (Figure 1). This graph is directly obtained by using the information gathered from the blockchain and provides an estimation of the Ô¨Çow of Bitcoins linking public key addresses over time. The vertices represent the addresses (Ì†µÌ±é1, Ì†µÌ±é2, ..., Ì†µÌ±éN) and the transactions (Ì†µÌ±°Ì†µÌ±•1, Ì†µÌ±°Ì†µÌ±•2, ..., Ì†µÌ±°Ì†µÌ±•M). The directed edges (arrows) between entities and transactions indicate the incoming relations, while directed edges between transactions and entities correspond to outgoing relations. Each directed edge can also include additional features such as values, time-stamps, etc.
To improve anonymity in the network, users are encouraged to generate a new Bitcoin address for each new transaction, which is a common advice for the correct usage of Bitcoin1. Due to this procedure, several addresses belong to the same logical user, so that a simpliÔ¨Åcation is possible by introducing the concept of entities. An entity is deÔ¨Åned as a person or organization that controls or can control
1https://bitcoin.org/en/protect-your-privacy

11

Fig. 1: Example of address-transaction graph
multiple public key addresses. This deÔ¨Ånition allows us to transform the address-transaction graph into the entitytransaction graph (Figure 2).

DeÔ¨Ånition 1: A Ì†µÌ±Å Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì is a path from the entitytransaction graph with length 2Ì†µÌ±Å that starts and ends with an entity. Let (Ì†µÌ±í1, .., Ì†µÌ±íM) ‚àà Ì†µÌ∞∏ be a class of entities and (Ì†µÌ±°1, .., Ì†µÌ±°N) ‚àà Ì†µÌ±á be a class of transactions, with Ì†µÌ±Ä ‚â§ Ì†µÌ±Å + 1, then:
Ì†µÌ±Å Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì = (Ì†µÌ±í1, Ì†µÌ±°1, ..., Ì†µÌ±°N, Ì†µÌ±íM)
in which at least one output from each transaction must be an input to the next transaction.
The term branch is used here to refer to a path in the motif graph that begins and ends with an entity passing through exactly one transaction. If a single branch of the graph has the same entity as input and output (Ì†µÌ±íj = Ì†µÌ±íj+1), the branch is called Direct Loop, otherwise it is called Direct Distinct, as shown in Figure 3.

Fig. 2: Example of entity-transaction graph obtained by address clustering
The new graph is obtained by grouping addresses belonging to the same user into entities (address clustering). This operation is not intuitive, however several heuristic properties have already been presented with the aim to help the clusterization process, for example in [1], [15] and [7]. In the obtained graph, vertices represent the entities (Ì†µÌ±í1, Ì†µÌ±í2, ..., Ì†µÌ±íK) and the transactions (Ì†µÌ±°Ì†µÌ±•1, Ì†µÌ±°Ì†µÌ±•2, ..., Ì†µÌ±°Ì†µÌ±•M). Similar to the address-transaction graph, directed edges between entities and transactions indicate the incoming relations, while directed edges between transactions and entities correspond to outgoing relations. The entity-transaction graph (Figure 2) summarizes the network well and constitutes an easily understandable representation of the money Ô¨Çow within the network.
B. Motif Graph Model
Motif graphs were introduced in [16] and were motivated by applications in bioinformatics, speciÔ¨Åcally in metabolic network analysis. However, as shown in Section II, prior studies such as [28] have introduced the concept of motifs to Bitcoin analysis. In this paper, a deÔ¨Ånition of Ì†µÌ±Å Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì is used, starting from the generalized concept introduced in [14].

Fig. 3: 2 motif graph with Direct Loop and Direct Distinct path deÔ¨Ånition
From the motif deÔ¨Ånition it is clear that all transactions are ordered in time, which means that Ì†µÌºè (Ì†µÌ±°1) < Ì†µÌºè (Ì†µÌ±°2) < .. < Ì†µÌºè (Ì†µÌ±°N), where Ì†µÌºè represents a transaction time.
Here, we use the 1 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì and 2 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì concepts. The 1 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì represents the relation between two entities (at least one distinct), while the 2 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì is the relation between three entities (at least one distinct) involved in two consecutive transactions.
IV. DATA OVERVIEW
We considered the whole Bitcoin blockchain data created until February 5th 2019, 08:13:31 AM, corresponding to 561,620 blocks, which contain about 380,000,000 transactions and involve more than 1,000,000,000 addresses. This data was then combined with information available on the WalletExplorer2, a benchmark platform for entities detection, which represents a collection of information about different known entities that have been detected until today. The data set is thus composed of 311 different samples, divided into six classes (see Table I):
‚àô Exchange: entities that allow their customers to trade Ô¨Åat currencies for Bitcoins (or vice versa)
‚àô Service: entities that offer Bitcoin payment methods as solutions to their business (Ô¨Ånancial services, trading, lending, etc.)
‚àô Gambling: entities that offer gambling services (casino, betting, roulette, etc.)
‚àô Mining Pool: entities composed of a group of miners that work together sharing their resources in order to reduce the volatility of their returns
‚àô Mixer: entities that offer a service to obscure the traceability of their clients‚Äô transactions
2https://www.walletexplorer.com/

12

‚àô Marketplace: entities allowing to buy any kind of goods or services that are illegal in most countries paying with Bitcoin

Class Exchange Gambling Marketplace Mining Pool Mixer Service Total

Abbreviation Ex Gmb Mrk Pool Mxr Serv

# Entities 137 76 20 25 37 16 311

# Address 9,943,512 3,054,238 2,349,210
76,104 475,714 235,629 16,134,407

% Address 61.63 18.93 14.56 0.47 2.95 1.46 100

TABLE I: Overview of WalletExplorer data used for this study

ered transactions, number of similar sent transactions between the entities in the Ô¨Årst and second branch, Direct Loop or Direct Distinct path for the Ô¨Årst and the second branch and Direct Loop or Direct Distinct path considering the whole 2 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì path, see Figure 4. (This dataframe was composed of 83,443,055 samples and 18 features)

As shown in Table I, the Exchange is the top class represented by more than 60% of samples, while the Mining Pool class is the least represented with just 0.47% (even though it has more distinct entities than the Marketplace and the Service).
Cross-references between Bitcoin blockchain data and labelled data from the WalletExplorer allow us to re-size the original data set by removing all the unlabelled and unusable data. As such, we focus our analysis on known entities only. From this new data set, four dataframes (2dimensional labelled data structure or data table with samples as rows and extracted features as columns) were extracted for the proposed analysis:
‚àô Entity dataframe contains all features related to an entity that can be directly extracted from the blockchain. They are: the amount of BTC received/sent, the balance of the entity, the number of transactions in which this entity is the receiver/sender, and the number of addresses belonging to this entity used for receiving/sending money. (This dataframe was composed of 311 samples and 7 features)
‚àô Address dataframe contains all features related to Bitcoin addresses. Features are: the number of transactions in which a certain address is detected such as receiver/sender, the amount of BTC received/sent from/to this address, the balance, uniqueness (if this address is just used in one transaction) and siblings. (This dataframe was composed of 16,134,407 samples and 7 features)
‚àô 1 motif dataframe contains the information directly extracted from the 1 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì graph. In this case, each row contains: the amount received/sent in the transaction, number of distinct addresses used for receiving/sending money, number of similar received/sent transactions between the entities in the branch, the fee, and if the branch realizes a Direct Loop or Direct Distinct path. (This dataframe was composed of 58,076,963 samples and 9 features)
‚àô 2 motif dataframe contains information gathered from the 2 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì graph. The features analyzed are: the number of addresses as input/output for the Ô¨Årst and second path in 2 Ì†µÌ±öÌ†µÌ±úÌ†µÌ±°Ì†µÌ±ñÌ†µÌ±ì graph, the amount received/sent in the Ô¨Årst and second branch, the fee of both consid-

Fig. 4: 2 motif representation with extracted features highlighted
V. MACHINE LEARNING A. ClassiÔ¨Åer Models
To demonstrate beneÔ¨Åts and limits of our approach, we conducted two different experiments. Firstly, we created a simple classiÔ¨Åer, called C entity (Figure 5), merely based on the samples stored in the entity dataframe, containing (seven) entity-related features that can be directly extracted from the blockchain. This classiÔ¨Åer was evaluated via a crossvalidation process (see Section V-B). Results from crossvalidation were considered as our baseline classiÔ¨Åcation. The simple classiÔ¨Åer was implemented in three versions applying Adaboost, Random Forest and Gradient Boosting models as those previously yielded good classiÔ¨Åcation results for Bitcoin data [28].
Fig. 5: First experiment: simple entities classiÔ¨Åer
In the second experiment, prior to entity classiÔ¨Åcation according to the six classes (Table I), we built three separate classiÔ¨Åers, based on the additionally available address, 1 motif and 2 motif dataframes and their respective features (7 + 9 + 18 = 34 features). Outgoing information from these classiÔ¨Åcations was processed, as shown in Figure 7, in order to create a set of six new features for each classiÔ¨Åer, which were then used to enrich (extend) the entity dataframe. Finally, a new classiÔ¨Åer C Ô¨Ånal was generated to obtain Ô¨Ånal entity classiÔ¨Åcation based on this enriched entity dataframe and its 25 features (7 belonged to the entity dataframe and 6x3 were generated from the three classiÔ¨Åers C address, C motif1, C motif2). With this cascading approach, new entity-related characteristics were added to

13

the entity dataframe, ultimately improving the classiÔ¨Åcation as demonstrated in the following sections.
The Ô¨Årst step was to split the address, 1 motif and 2 motif dataframes into two parts called A-data set (for training) and B-data set (for testing) with a proportion of 70/30. The Adata set was used to compute cross-validation of the three C address, C motif1, C motif2 classiÔ¨Åer models (Figure 6). After that, the B-data set was used as input for the trained classiÔ¨Åers C address, C motif1, C motif2 in order to obtain classiÔ¨Åcation results based on completely new, unseen data.

Fig. 6: Second experiment: cascading entities classiÔ¨Åers

ClassiÔ¨Åcation results essentially assign one of the six possible output classes to each entry in the input dataframe. As each entry has its original (ground truth) label obtained from the WalletExplorer, we can join input label and computed output class and perform a group-by and count operation as illustrated in Figure 7: we count how many times a sample belonging to a particular entity has been detected in each of the considered classes. This value is then normalized as indicated in the following formula:

‚àÄÌ†µÌºâ ‚àà Ì†µÌ∞∏

‚àëÌ†µÌ†µÌ±ñ=‚à•Ì±Å 1Ì†µÌ±É‚à•Ì†µÌºâ‚à£Ì†µjÌ±É

‚à•
Ì†µÌºâ‚à£

i

‚à•

‚àó

100

Ì†µÌ±§Ì†µÌ±ñÌ†µÌ±°‚Ñé Ì†µÌ±ó ‚àà Ì†µÌ±Å

where Ì†µÌ∞∏ is the entities set and Ì†µÌ±Å represents the number of

considered classes (Ì†µÌ±Å = 6 in this study). The term ‚à• Ì†µÌ±É Ì†µÌºâ‚à£ j ‚à• represents how many times a sample originally labelled with

ethnetittyerÌ†µmÌºâ g‚àëenÌ†µÌ†µeÌ±ñ=Ì±Åra1te‚à•sÌ†µaÌ±É

prediction belonging to the class j, while Ì†µÌºâ‚à£ i ‚à• counts all the predictions generated

from samples with labelled input belonging to entity Ì†µÌºâ.

These normalized values form a dataframe containing

311 samples (one for each known entity as in the entity

dataframe) and six new features, representing the percentage

of being classiÔ¨Åed as belonging to one of the six classes.

These features were added to the entity dataframe for data

enrichment, constituting our cascading machine learning

system. The elements of the enriched entity dataframe were

used to implement and evaluate the Ô¨Ånal classiÔ¨Åer, called

C Ô¨Ånal, and a cross-validation process (Section V-B) was

applied to compute its performance.

To allow a better comparison between experiments, we

implemented all classiÔ¨Åer models C address, C motif1,

C motif2 and C Ô¨Ånal with Adaboost, Random Forest and

Gradient Boosting models. SpeciÔ¨Åcally, all Adaboost clas-

siÔ¨Åers were generated with the number of estimators set to

50 and the learning rate set to 1. All Random Forest models

1. Extract Dataframe # distinct entities = 311 # of features M = 7 # of samples N = 16,134,407

2. Classification
# distinct output classes = 6 [Exchange, Gambling, Mixer, Pool, Market, Service]

WalletExplorer entity name Address 1 2 ‚Ä¶ M

1 Bittrex.com

a1 ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

2 SilkRoad2Market a2 ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

3

BTCCPool

a3 ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

4 Kraken.com

a4 ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

5 BitcoinFog

a5 ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

6 Bittrex.com

a6 ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

‚Ä¶

‚Ä¶

‚Ä¶ ‚Ä¶‚Ä¶‚Ä¶‚Ä¶

N Bittrex.com

aN ‚Ä¶ ‚Ä¶ ‚Ä¶ ‚Ä¶

C_Address
1. Adaboost 2. Random Forest 3. Gradient Boosting

Output

Class

1

Ex

2 Gmb

3

Pool

4

Ex

5

Mxr

6

Mxr

‚Ä¶

‚Ä¶

N

Ex

3. Join Input data are joined with output data (classification results)

WalletExplorer Output

entity name Class

1 Bittrex.com

Ex

2 SilkRoad2Market Gmb

3

BTCCPool

Pool

4 Kraken.com

Ex

5 BitcoinFog

Mxr

6 Bittrex.com

Mxr

‚Ä¶

‚Ä¶

‚Ä¶

N Bittrex.com

Ex

4. GroupBy & Count Data are grouped by WalletExplorer entity name and output classes generating 311 elements

WalletExplorer entity name

Ex

Gmb Mrk Pool Mxr Serv

1

Kraken.com 6333 44 25 12 3

1

2

BitcoinFog 225 60 7 1 2351 7

‚Ä¶

‚Ä¶

‚Ä¶ ‚Ä¶‚Ä¶‚Ä¶ ‚Ä¶ ‚Ä¶

j-1 Bittrex.com 9980 13 5 1

1

0

j SilkRoad2Market 6

1 994 0

0

0

‚Ä¶

‚Ä¶

‚Ä¶ ‚Ä¶‚Ä¶‚Ä¶ ‚Ä¶ ‚Ä¶

311 BTCCPool 915 84 14 4842 5 2

5. Normalization & Join Elements are normalized and added to the entity dataframe

WalletExplorer Ex Gmb Mrk Pool Mxr Serv

entity name % % % % % %

1 Kraken.com 98.64 0.69 0.39 0.19 0.05 0.03

2

BitcoinFog 8.49 2.25 0.25 0.03 88.71 0.27

‚Ä¶

‚Ä¶

‚Ä¶ ‚Ä¶ ‚Ä¶‚Ä¶‚Ä¶‚Ä¶

j-1 Bittrex.com 99.80 0.13 0.05 0.01 0.01 0

j SilkRoad2Market 0.59 0.07 99.34 0 0 0

‚Ä¶

‚Ä¶

‚Ä¶ ‚Ä¶ ‚Ä¶‚Ä¶‚Ä¶‚Ä¶

311 BTCCPool 15.61 1.44 0.24 82.6 0.08 0.03

U
Entity Dataframe

Fig. 7: Steps to create the enriched entity dataframe applied to an example address dataframe

were implemented with the number of estimators set to 10, a Gini function to measure the quality of the split and without a maximum depth of the tree. All Gradient Boosting models were implemented with the number of estimators set to 100, the learning rate set to 0.1 and the maximum depth for limiting the number of nodes set to 3.
B. Evaluation Metrics
All classiÔ¨Åcation models were evaluated by extracting and comparing classiÔ¨Åcation metrics via a cross-validation process. The goal of cross-validation is to analyze the prediction capabilities of the model in order to detect problems such as over-Ô¨Åtting or selection bias [4]. Here, we used stratiÔ¨Åed K-fold cross-validation, with a value of K equal to 5. This method involves dividing the whole data set into K equal partitions or folds.
Each fold is composed of data ensuring a good representative sample of the whole population by keeping the same proportion of classes present in the original data set (stratiÔ¨Åcation). Then, K-1 folds are used to train the model and the one left-out fold is used to evaluate the predictions obtained by the trained model. The entire process is repeated K times, until each fold has been left out once, testing all possible combinations. During this process, the following metrics were computed:
‚àô Accuracy or Score is deÔ¨Åned as the number of correct predictions divided by the total number of predictions and is given as percentage
‚àô Precision is the number of positive predictions divided by the total number of the positive class values predicted. It represents a measure of a classiÔ¨Åer‚Äôs exactness

14

given as a value between 0 and 1, with 1 relating to high precision ‚àô Recall represents a measure of a classiÔ¨Åer‚Äôs completeness given as a value between 0 and 1 ‚àô F1-score is the harmonic mean of Precision and Recall. It takes values between 0 and 1, with 1 relating to perfect Precision and Recall

Ì†µÌ∞π 1Ì†µÌ±†Ì†µÌ±êÌ†µÌ±úÌ†µÌ±üÌ†µÌ±í

=

2

‚àó

Ì†µÌ±É Ì†µÌ±üÌ†µÌ±íÌ†µÌ±êÌ†µÌ±ñÌ†µÌ±†Ì†µÌ±ñÌ†µÌ±úÌ†µÌ±õ ‚àó Ì†µÌ±ÖÌ†µÌ±íÌ†µÌ±êÌ†µÌ±éÌ†µÌ±ôÌ†µÌ±ô Ì†µÌ±É Ì†µÌ±üÌ†µÌ±íÌ†µÌ±êÌ†µÌ±ñÌ†µÌ±†Ì†µÌ±ñÌ†µÌ±úÌ†µÌ±õ + Ì†µÌ±ÖÌ†µÌ±íÌ†µÌ±êÌ†µÌ±éÌ†µÌ±ôÌ†µÌ±ô

‚àô Matthews Correlation CoefÔ¨Åcient (MCC) is a metric

yielding easy comparison with respect to a random

baseline, suitable for unbalanced classes. It takes values

between ‚àí1 and +1. A coefÔ¨Åcient of +1 represents a

perfect prediction, 0 an average random prediction and

‚àí1 an inverse prediction. As shown in [10], let Ì†µÌ∞æ be

the number of classes and Ì†µÌ∞∂ be a confusion matrix with

dims Ì†µÌ∞æ √ó Ì†µÌ∞æ, the Ì†µÌ±Ä Ì†µÌ∞∂Ì†µÌ∞∂ can be calculated as:

‚àö‚àë ‚àë

‚àë

Ì†µÌ±Ä Ì†µÌ∞∂Ì†µÌ∞∂ Ì†µÌ±ùÌ†µÌ±éÌ†µÌ±üÌ†µÌ±°1 =

( Ì†µÌ∞∂kl)(

Ì†µÌ∞∂ gf )

Ì†µÌ±ò Ì†µÌ±ô

Ì†µÌ±ì,Ì†µÌ±î‚à£Ì†µÌ±ì ‚àï=Ì†µÌ±î

‚àö‚àë ‚àë

‚àë

Ì†µÌ±Ä Ì†µÌ∞∂Ì†µÌ∞∂ Ì†µÌ±ùÌ†µÌ±éÌ†µÌ±üÌ†µÌ±°2 =

( Ì†µÌ∞∂lk)(

Ì†µÌ∞∂ fg )

Ì†µÌ±ò Ì†µÌ±ô

Ì†µÌ±ì,Ì†µÌ±î‚à£Ì†µÌ±ì ‚àï=Ì†µÌ±î

‚àë ‚àë‚àë

Ì†µÌ±Ä Ì†µÌ∞∂Ì†µÌ∞∂ =

Ì†µÌ±ò Ì†µÌ±ô Ì†µÌ±ö Ì†µÌ∞∂kkÌ†µÌ∞∂lm ‚àí Ì†µÌ∞∂klÌ†µÌ∞∂mk Ì†µÌ±Ä Ì†µÌ∞∂Ì†µÌ∞∂ Ì†µÌ±ùÌ†µÌ±éÌ†µÌ±üÌ†µÌ±°1 ‚àó Ì†µÌ±Ä Ì†µÌ∞∂Ì†µÌ∞∂ Ì†µÌ±ùÌ†µÌ±éÌ†µÌ±üÌ†µÌ±°2

In Section VI results for the baseline model (C entity) and for the Ô¨Ånal model (C Ô¨Ånal) obtained after cross-validation using the enriched dataframe are presented and compared. We report global metric values for Accuracy/Score and MCC averaged over the K=5 cross-validation runs and per-class values for Precision, Recall and F1-score when evaluating the Ô¨Ånal models.

C. Hardware and Software ConÔ¨Åguration
All analyses were run on a cluster of three virtual machines, each one with 16 CPUs Intel(R) Xeon(R) Silver 4114 CPU @ 2.20 GHz, 64 GB RAM DDR4 memory with 2, 666 MHz, and 500 GB of Hard Disk SATA. Apache Spark3 v2.4.0, set in cluster mode was used to manage stored data using Apache Hadoop4. The various classiÔ¨Åer
models were implemented and evaluated using Python‚Äôs Scikit-learn5 library. All scripts were executed within the Jupyter-notebook6 environment.

VI. RESULTS
Considering the simple classiÔ¨Åer C entity from the Ô¨Årst experiment, the Gradient Boosting model yielded a better average score (61.90% accuracy) and MCC (0.44) than Random Forest and Adaboost classiÔ¨Åers, as shown in Table II (upper section). However, with overall low MCC for all classiÔ¨Åers (between 0.22 and 0.44), these scores were not

3https://spark.apache.org/ 4https://hadoop.apache.org/ 5https://scikit-learn.org/ 6https://jupyter.org/

sufÔ¨Åcient to achieve reliable entities characterization. This led to introducing our cascading machine learning approach, enriching the initial entity dataframe with information gathered from prior classiÔ¨Åcations in the second experiment.

Model Adaboost Random Forest Gradient Boosting Adaboost Random Forest Gradient Boosting

ClassiÔ¨Åer C entity C entity C entity C Ô¨Ånal C Ô¨Ånal C Ô¨Ånal

Score % 45.63 59.71 61.90 78.84 98.04 99.68

Std % 6.34 1.82 1.36 1.76 1.22 0.63

MCC 0.22 0.41 0.44 0.76 0.97 0.99

TABLE II: Average performance of classiÔ¨Åers over Ô¨Åve cross-validation repetitions for simple C entity model (above) and for Ô¨Ånal model after data enrichment via cascading machine learning C Ô¨Ånal

Analyzing the C address, C motif1 and C motif2 classiÔ¨Åers separately for entity characterization, Table III shows that outgoing information from the Random Forest classiÔ¨Åer resulted to be more accurate than information from Gradient Boosting and Adaboost classiÔ¨Åers (accuracy scores >90% for Random Forest). Notably, only using information from the address dataframe, the Random Forest classiÔ¨Åer C address could already achieve an average global accuracy of ‚àº 96%. Due to these results, we only used results obtained from Random Forest classiÔ¨Åers for the subsequent entities dataframe enrichment. Random Forest classiÔ¨Åers not only proved to be the best in terms of accuracy, but also performed with highest speed among the considered classiÔ¨Åcation models.

Model Adaboost Random Forest Gradient Boosting

C address % 61.54 95.73 83.23

C motif1 % 72.69 94.14 83.52

C motif2 % 78.27 90.88 83.54

TABLE III: Average global C address, C motif1 and C motif2 classiÔ¨Åer accuracy calculated via 5-fold crossvalidation

The Ô¨Ånal classiÔ¨Åers C Ô¨Ånal were fed with the enriched entity dataframe, which comprised the original features from the entity dataframe and included as new features the class predictions obtained from C address, C motif1 and C motif2 for the respective test data sets. From Table II (lower section) it is obvious that the average score result improved signiÔ¨Åcantly by exploiting the information obtained via our cascading approach. Random Forest and Gradient Boosting classiÔ¨Åers again performed better than the Adaboost model, reaching a score of more than 98% (respectively ‚àº 39% and ‚àº 38% percentage points higher than the baseline accuracy from C entity). Furthermore, classiÔ¨Åcation results were more stable during cross-validation, generating low standard deviations between 0.63% and 1.76% and the MCC reached values close to 1.0, relating to close-to-perfect class prediction.
In Table IV, we present per-class Precision, Recall and F1-scores calculated for C entity (baseline) and C Ô¨Ånal (enriched) classiÔ¨Åers for each classiÔ¨Åcation model. Results

15

Class Exchange Gambling Market Mining Pool Mixer Service Exchange Gambling Market Mining Pool Mixer Service Exchange Gambling Market Mining Pool Mixer Service

Model Adaboost Adaboost Adaboost Adaboost Adaboost Adaboost Random Forest Random Forest Random Forest Random Forest Random Forest Random Forest Gradient Boosting Gradient Boosting Gradient Boosting Gradient Boosting Gradient Boosting Gradient Boosting

C entity model

Precision Recall F1-score

0.51

0.68

0.57

0.22

0.14

0.17

0.05

0.15

0.08

0.20

0.16

0.17

0.69

0.78

0.71

0.20

0.10

0.13

0.60

0.77

0.67

0.54

0.50

0.51

0

0

0

0.68

0.50

0.56

0.89

0.78

0.82

0

0

0

0.61

0.80

0.69

0.59

0.53

0.55

0.10

0.05

0.06

0.38

0.40

0.38

0.92

0.84

0.87

0

0

0

C Ô¨Ånal model

Precision Recall F1-score

0.77

0.78

0.77

0.75

1.00

0.85

0.40

0.30

0.33

0.11

0.2

0.14

1.00

0.98

0.99

0.95

0.95

0.95

0.96

1.00

0.98

1.00

1.00

1.00

1.00

0.85

0.91

1.00

0.92

0.96

1.00

1.00

1.00

1.00

0.93

0.96

1.00

1.00

1.00

0.99

1.00

0.99

1.00

1.00

1.00

1.00

1.00

1.00

1.00

1.00

1.00

1.00

0.93

0.96

TABLE IV: Average Precision, Recall and F1-score calculated in each model implementation for each class

demonstrate that the simple classiÔ¨Åer C entity - independently of the classiÔ¨Åcation model used - had problems detecting Service and Market entities (calculated metrics are 0 or have very low values). However, it is to be noted that these two classes are least represented in terms of distinct entities in the original data set. Random Forest and Gradient Boosting classiÔ¨Åers showed overall good performance in detecting Mixer entities for the C entity approach (F1-scores >0.8).
By exploiting the cascading machine learning implementation however, all classiÔ¨Åers improved their classiÔ¨Åcation performance for each class, with most values being close to 1.0. Only the Adaboost model kept having problems with the classiÔ¨Åcation of Mining Pool and Market entities. Random Forest and the Gradient Boosting models instead yielded excellent values for Precision, Recall and F1-score for each class.
Overall best classiÔ¨Åcation scores were achieved by the C Ô¨Ånal implementation with Gradient Boosting models. Data enrichment through prior classiÔ¨Åcation and cascading thus clearly had a highly beneÔ¨Åcial impact on classiÔ¨Åcation ability of Gradient Boosting, motivating a further analysis of the importance of individual features from the enriched entity dataframe. We therefore calculated in a next step a feature importance score for the enriched entity dataframe.
Generally, the feature importance score provides a score that indicates how useful or valuable each feature was in the construction of the model. The more often an attribute is used to make key decisions, the greater will be its relative importance score. Importance was explicitly calculated through Python‚Äôs Scikit-learn library for each attribute in the data set, allowing features to be ranked and compared to each other.
Figure 8 shows a list of the top Ô¨Åfteen features for the C Ô¨Ånal Gradient Boosting classiÔ¨Åer. All Ô¨Åfteen important features were created during the prior classiÔ¨Åcations taking into account C address, C motif1 and C motif2. These features represent how address, 1 motif, or 2 motif data,

Fig. 8: Top 15 important features from the GB classiÔ¨Åer
related to a certain entity, were previously classiÔ¨Åed. This highlights again that the information brought in from prior classiÔ¨Åcations (Ô¨Årst step of the cascade) clearly contributes to much improved entities characterization.
VII. CONCLUSION AND FUTURE WORK
In this paper, we present a novel approach of how to attack Bitcoin anonymity through entity characterization. Specifically, we demonstrate how a cascading machine learning model combined with an adequate set of input features directly derived from Bitcoin blockchain data (entity and address data) as well as derived via 1 motif and 2 motif concepts introduced by Ranshous et al. [28] can lead to impressive classiÔ¨Åcation performance for a number of relevant Bitcoin entity classes. In fact, we were able to obtain an average global accuracy score of 99.68% with low standard deviation of 0.63% and a Matthews Correlation CoefÔ¨Åcient (MCC) of 0.99 over 5-fold cross validation for a Gradient Boosting model using our cascading approach.
These Ô¨Ånal models were indeed able to predict each of the six entity classes used (Exchange, Gambling, Market, Mining Pool, Mixer, Service) with Precision, Recall and

16

F1-score values close to 1.0. Ranshous et al. [28] obtained similar results using Random Forest and Adaboost classiÔ¨Åers, however their study was limited to exchange address classiÔ¨Åcation. Jourdan et al. [14] generally obtained lower values for per-class F1-score and Precision ranging between 0.67 and 1.0 using Gradient Boosting and their approach involved a complex step of model hyper-parameter calibration and required a total number of 315 input features.
Our approach applies one more classiÔ¨Åcation step in the ‚ÄùclassiÔ¨Åcation cascade‚Äù generating a set of new entity-related features used for the Ô¨Ånal classiÔ¨Åcation, but we do not require extensive parameter tuning. Most importantly, we only use 34 features for the initial classiÔ¨Åcation step (involving address, 1 motif and 2 motif) and Ô¨Ånally 7 features from the entities data set plus 3 x 6 = 18 new features obtained as outgoing information from the initial classiÔ¨Åcation step. The Ô¨Ånal classiÔ¨Åcation is thus based on only 25 features, which equals to less than 10% of features compared to Jourdan et al. Our future work will focus on investigating deeper the matter of feature importance, in order to further reduce the number of relevant features required for obtaining high entity classiÔ¨Åcation performance. This will facilitate the process of attacking Bitcoin anonymity further.
One major drawback of our approach is that we were not able to characterize entities behaving as normal users as this information is not currently available as ground truth data in the WalletExplorer. We had to remove all entities that have not yet been classiÔ¨Åed in the WalletExplorer from our analysis. Nevertheless, we were able to detect six classes of key Bitcoin services that have previously been associated with illicit Ô¨Ånancial operations with very high classiÔ¨Åcation scores. We therefore believe that our study can contribute to improving crime investigation and may form a base for developing effective tools assisting law enforcement agencies in uncovering illegal activities within the Bitcoin network.
ACKNOWLEDGMENT
This work was partially funded by the European Commission through the Horizon 2020 research and innovation program, as part of the ‚ÄúTITANIUM‚Äù project (grant agreement No 740558).
REFERENCES
[1] Androulaki, E., Karame, G.O., Roeschlin, M., Scherer, T., Capkun, S.: Evaluating user privacy in bitcoin. In: International Conference on Financial Cryptography and Data Security. pp. 34‚Äì51. Springer (2013)
[2] Bartoletti, M., Pes, B., Serusi, S.: Data mining for detecting bitcoin ponzi schemes. In: 2018 Crypto Valley Conference on Blockchain Technology (CVCBT). pp. 75‚Äì84. IEEE (2018)
[3] Biryukov, A., Khovratovich, D., Pustogarov, I.: Deanonymisation of clients in bitcoin p2p network. In: Proceedings of the 2014 ACM SIGSAC Conference on Computer and Communications Security. pp. 15‚Äì29. ACM (2014)
[4] Cawley, G.C., Talbot, N.L.: On over-Ô¨Åtting in model selection and subsequent selection bias in performance evaluation. Journal of Machine Learning Research 11(Jul), 2079‚Äì2107 (2010)
[5] Christin, N.: Traveling the silk road: A measurement analysis of a large anonymous online marketplace. In: Proceedings of the 22nd international conference on World Wide Web. pp. 213‚Äì224. ACM (2013)

[6] Crosby, M., Pattanayak, P., Verma, S., Kalyanaraman, V., et al.: Blockchain technology: Beyond bitcoin. Applied Innovation 2(6-10), 71 (2016)
[7] Ermilov, D., Panov, M., Yanovich, Y.: Automatic bitcoin address clustering. In: 2017 16th IEEE International Conference on Machine Learning and Applications (ICMLA). pp. 461‚Äì466. IEEE (2017)
[8] Fleder, M., Kester, M.S., Pillai, S.: Bitcoin transaction graph analysis. arXiv preprint arXiv:1502.01657 (2015)
[9] Foley, S., Karlsen, J., Putnin¬∏sÀá, T.J.: Sex, drugs, and bitcoin: How much illegal activity is Ô¨Ånanced through cryptocurrencies? (2018)
[10] Gorodkin, J.: Comparing two k-category assignments by a k-category correlation coefÔ¨Åcient. Computational biology and chemistry 28(5-6), 367‚Äì374 (2004)
[11] Harlev, M.A., Sun Yin, H., Langenheldt, K.C., Mukkamala, R., Vatrapu, R.: Breaking bad: De-anonymising entity types on the bitcoin blockchain using supervised machine learning. In: Proceedings of the 51st Hawaii International Conference on System Sciences (2018)
[12] Herrera-Joancomarti, J.: Research and challenges on bitcoin anonymity. In: Data Privacy Management, Autonomous Spontaneous Security, and Security Assurance, pp. 3‚Äì16. Springer (2015)
[13] Hirshman, J., Huang, Y., Macke, S.: Unsupervised approaches to detecting anomalous behavior in the bitcoin transaction network. 3rd ed. Technical report, Stanford University (2013)
[14] Jourdan, M., Blandin, S., Wynter, L., Deshpande, P.: Characterizing entities in the bitcoin blockchain. arXiv preprint arXiv:1810.11956 (2018)
[15] Koshy, P., Koshy, D., McDaniel, P.: An analysis of anonymity in bitcoin using p2p network trafÔ¨Åc. In: International Conference on Financial Cryptography and Data Security. pp. 469‚Äì485. Springer (2014)
[16] Lacroix, V., Fernandes, C.G., Sagot, M.F.: Motif search in graphs: application to metabolic networks. IEEE/ACM Transactions on Computational Biology and Bioinformatics (TCBB) 3(4), 360‚Äì368 (2006)
[17] Liao, K., Zhao, Z., Doupe¬¥, A., Ahn, G.J.: Behind closed doors: measurement and analysis of cryptolocker ransoms in bitcoin. In: 2016 APWG Symposium on Electronic Crime Research (eCrime). pp. 1‚Äì13. IEEE (2016)
[18] McNally, S., Roche, J., Caton, S.: Predicting the price of bitcoin using machine learning. In: 2018 26th Euromicro International Conference on Parallel, Distributed and Network-based Processing (PDP). pp. 339‚Äì343. IEEE (2018)
[19] Meiklejohn, S., Orlandi, C.: Privacy-enhancing overlays in bitcoin. In: International Conference on Financial Cryptography and Data Security. pp. 127‚Äì141. Springer (2015)
[20] Meiklejohn, S., Pomarole, M., Jordan, G., Levchenko, K., McCoy, D., Voelker, G.M., Savage, S.: A Ô¨Åstful of bitcoins: characterizing payments among men with no names. In: Proceedings of the 2013 conference on Internet measurement conference. pp. 127‚Äì140. ACM (2013)
[21] Monamo, P., Marivate, V., Twala, B.: Unsupervised learning for robust bitcoin fraud detection. In: 2016 Information Security for South Africa (ISSA). pp. 129‚Äì134. IEEE (2016)
[22] Moore, T., Christin, N.: Beware the middleman: Empirical analysis of bitcoin-exchange risk. In: International Conference on Financial Cryptography and Data Security. pp. 25‚Äì33. Springer (2013)
[23] Moser, M.: Anonymity of bitcoin transactions (2013) [24] Mo¬®ser, M., Bo¬®hme, R., Breuker, D.: Towards risk scoring of bitcoin
transactions. In: International Conference on Financial Cryptography and Data Security. pp. 16‚Äì32. Springer (2014) [25] Nakamoto, S., et al.: Bitcoin: A peer-to-peer electronic cash system (2008) [26] Narayanan, A., Bonneau, J., Felten, E., Miller, A., Goldfeder, S.: Bitcoin and cryptocurrency technologies (2016) [27] Pham, T., Lee, S.: Anomaly detection in bitcoin network using unsupervised learning methods. arXiv preprint arXiv:1611.03941 (2016) [28] Ranshous, S., Joslyn, C.A., Kreyling, S., Nowak, K., Samatova, N.F., West, C.L., Winters, S.: Exchange pattern mining in the bitcoin transaction directed hypergraph. In: International Conference on Financial Cryptography and Data Security. pp. 248‚Äì263. Springer (2017) [29] Reid, F., Harrigan, M.: An analysis of anonymity in the bitcoin system. In: Security and privacy in social networks, pp. 197‚Äì223. Springer (2013) [30] Ron, D., Shamir, A.: Quantitative analysis of the full bitcoin transaction graph. In: International Conference on Financial Cryptography and Data Security. pp. 6‚Äì24. Springer (2013)

17

